<template>
    <div class="qfr-form-container">
        <lightning-progress-indicator 
            current-step={currentStep} 
            type="path"
            variant="base"
            has-error={hasErrors}>
            <template for:each={steps} for:item="step">
                <lightning-progress-step 
                    key={step.label}
                    label={step.label}
                    value={step.value}>
                </lightning-progress-step>
            </template>
        </lightning-progress-indicator>

        <div class="form-section">
            <!-- Page 1: Residential Viability -->
            <template if:true={isPage1}>
                <lightning-accordion 
                    allow-multiple-sections-open="true"
                    active-section-name={activeSections}>
                    <lightning-accordion-section name="info" label="About this section">
                        <p>This section collects information about financial health and viability.</p>
                    </lightning-accordion-section>
                </lightning-accordion>

                <div class="slds-p-around_medium">
                    <lightning-radio-group
                        name="solvencyConcern"
                        label="Are you currently concerned about the solvency of your organisation?"
                        options={yesNoOptions}
                        value={solvencyConcern}
                        required
                        onchange={handleSolvencyChange}>
                    </lightning-radio-group>

                    <lightning-radio-group
                        name="futureSolvency"
                        label="Do you envisage any solvency issues arising in the next six months?"
                        options={yesNoOptions}
                        value={futureSolvency}
                        required
                        onchange={handleFutureSolvencyChange}>
                    </lightning-radio-group>

                    <lightning-radio-group
                        name="operationalLoss"
                        label="Do you forecast an operational loss for the current year?"
                        options={yesNoOptions}
                        value={operationalLoss}
                        required
                        onchange={handleOperationalLossChange}>
                    </lightning-radio-group>
                </div>
            </template>

            <!-- Labour Costs Data Table -->
            <template if:true={isLabourCostsPage}>
                <div class="table-controls slds-p-around_medium">
                    <lightning-combobox
                        name="viewFilter"
                        label="View"
                        value={selectedView}
                        options={viewOptions}
                        onchange={handleViewChange}>
                    </lightning-combobox>

                    <lightning-combobox
                        name="jumpSection"
                        label="Jump to Section"
                        value={selectedSection}
                        options={sectionOptions}
                        onchange={handleSectionJump}>
                    </lightning-combobox>
                </div>

                <lightning-datatable
                    key-field="id"
                    data={labourCostsData}
                    columns={labourColumns}
                    hide-checkbox-column
                    oncellchange={handleCellChange}>
                </lightning-datatable>
            </template>
        </div>

        <!-- Navigation Buttons -->
        <div class="button-container slds-p-around_medium">
            <lightning-button 
                label="Previous"
                onclick={handlePrevious}
                disabled={isFirstPage}>
            </lightning-button>
            <lightning-button 
                label={nextButtonLabel}
                variant="brand"
                onclick={handleNext}
                disabled={isNextDisabled}>
            </lightning-button>
        </div>
    </div>
</template>
