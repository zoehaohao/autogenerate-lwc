<template>
    <div class="slds-card">
        <!-- Header -->
        <div class="slds-card__header slds-border_bottom">
            <div class="slds-media slds-media_center">
                <div class="slds-media__body">
                    <h1 class="slds-card__header-title slds-text-heading_large">
                        Application for Approval to Provide Aged Care - New Applicant
                    </h1>
                    <p class="slds-text-body_regular slds-text-color_weak">
                        Before completing this application form, you must understand what it means to be an approved provider.
                    </p>
                </div>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="slds-card__body slds-card__body_inner">
            <lightning-progress-indicator 
                current-step={currentPageString}
                type="path"
                variant="base">
                <lightning-progress-step 
                    label="Key Personnel Declaration" 
                    value="1">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="About the Applicant" 
                    value="2">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Key Personnel Details" 
                    value="3">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Suitability Assessment" 
                    value="4">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Care Type Specific" 
                    value="5">
                </lightning-progress-step>
            </lightning-progress-indicator>
        </div>

        <!-- Page Content -->
        <div class="slds-card__body slds-card__body_inner">
            
            <!-- Page 1: Key Personnel Declaration -->
            <template if:true={isPage1}>
                <div class="slds-section slds-is-open">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Key Personnel Declaration</h2>
                    
                    <div class="slds-notify slds-notify_alert slds-theme_warning slds-theme_alert-texture slds-m-bottom_medium" role="alert">
                        <h3 class="slds-text-heading_small">Important Information</h3>
                        <p>Giving false and misleading information is a serious offence. There are offences established by the Commission Act and the Criminal Code Act 1995 (Cth) relating to providing false and misleading information.</p>
                    </div>

                    <div class="slds-box slds-theme_shade slds-m-bottom_medium">
                        <h3 class="slds-text-heading_small slds-m-bottom_small">Key Personnel Declaration</h3>
                        <p class="slds-text-body_regular slds-m-bottom_small">I/we declare that I/we:</p>
                        
                        <ol class="slds-list_ordered slds-text-body_small">
                            <li>are aware that, under section 63J(1)(c) of the Commission Act, if the Commissioner is satisfied that the application contained information that was false or misleading in a material particular, any approval as an approved provider must be revoked.</li>
                            <li>understand that Chapter 2 and section 137.1 of the Criminal Code applies to offences against the Commission Act. Providing false or misleading information in this application is a serious offence.</li>
                            <li>have provided true and accurate information in this application form.</li>
                            <li>understand that the application form must be signed by persons lawfully authorised to act on behalf of/represent the organisation.</li>
                            <li>consent to the Commissioner obtaining information and documents from other persons or organisations.</li>
                            <li>understand that information I/we give to the Commission may be disclosed where permitted or required by law.</li>
                            <li>understand that the corporation name shown on the Certificate of Registration provided with this application will be used in any communications.</li>
                            <li>declare that all of our/my organisation's key personnel are individuals suitable to be involved in the provision of aged care.</li>
                            <li>have read the Aged Care Approved Provider Applicant Guide and understand the responsibilities and obligations of approved providers.</li>
                            <li>understand that the Commission will examine its own records in relation to this application.</li>
                            <li>understand that if a consultant or external party is engaged to assist in preparing this application, our/my organisation is ultimately responsible for the information provided.</li>
                        </ol>
                    </div>

                    <div class="slds-grid slds-wrap slds-gutters">
                        <div class="slds-col slds-size_1-of-2">
                            <h4 class="slds-text-heading_small slds-m-bottom_small">Declaring Officer 1 - Key Personnel</h4>
                            <lightning-input
                                label="Name"
                                value={declaringOfficer1Name}
                                onchange={handleDeclaringOfficer1NameChange}
                                required>
                            </lightning-input>
                            <lightning-input
                                label="Position"
                                value={declaringOfficer1Position}
                                onchange={handleDeclaringOfficer1PositionChange}
                                required>
                            </lightning-input>
                            <lightning-input
                                label="Date"
                                type="date"
                                value={declaringOfficer1Date}
                                onchange={handleDeclaringOfficer1DateChange}
                                required>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <h4 class="slds-text-heading_small slds-m-bottom_small">Declaring Officer 2 - Key Personnel</h4>
                            <lightning-input
                                label="Name"
                                value={declaringOfficer2Name}
                                onchange={handleDeclaringOfficer2NameChange}
                                required>
                            </lightning-input>
                            <lightning-input
                                label="Position"
                                value={declaringOfficer2Position}
                                onchange={handleDeclaringOfficer2PositionChange}
                                required>
                            </lightning-input>
                            <lightning-input
                                label="Date"
                                type="date"
                                value={declaringOfficer2Date}
                                onchange={handleDeclaringOfficer2DateChange}
                                required>
                            </lightning-input>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Page 2: About the Applicant -->
            <template if:true={isPage2}>
                <div class="slds-section slds-is-open">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">About the Applicant</h2>
                    
                    <div class="slds-section slds-is-open slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Organisation Details</h3>
                        
                        <div class="slds-grid slds-wrap slds-gutters">
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-input
                                    label="Applicant's (Company) Legal Name"
                                    value={legalName}
                                    onchange={handleLegalNameChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input
                                    label="Applicant's (Company) ACN, IAN or ICN"
                                    value={acnNumber}
                                    onchange={handleAcnNumberChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input
                                    label="Applicant's (Company) ABN"
                                    value={abnNumber}
                                    onchange={handleAbnNumberChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-input
                                    label="Business Name (if applicable)"
                                    value={businessName}
                                    onchange={handleBusinessNameChange}>
                                </lightning-input>
                            </div>
                        </div>

                        <div class="slds-text-body_small slds-text-color_weak slds-m-top_small">
                            <p><strong>Certificate of registration:</strong> You must attach a copy of your registration.</p>
                            <p><strong>Trust Deed and Company Constitution:</strong> If your organisation's ABN is associated with a Trust, you must attach a copy of the Trust Deed and Company Constitution.</p>
                        </div>
                    </div>

                    <div class="slds-section slds-is-open slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Registered Business Address</h3>
                        <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">Street number and name (must be the registered physical address of the organisation)</p>
                        
                        <div class="slds-grid slds-wrap slds-gutters">
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-textarea
                                    label="Street Address"
                                    value={registeredStreetAddress}
                                    onchange={handleRegisteredStreetAddressChange}
                                    required>
                                </lightning-textarea>
                            </div>
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-input
                                    label="Suburb/Town"
                                    value={registeredSuburb}
                                    onchange={handleRegisteredSuburbChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-combobox
                                    label="State/Territory"
                                    value={registeredState}
                                    placeholder="Select State/Territory"
                                    options={stateOptions}
                                    onchange={handleRegisteredStateChange}
                                    required>
                                </lightning-combobox>
                            </div>
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-input
                                    label="Postcode"
                                    value={registeredPostcode}
                                    onchange={handleRegisteredPostcodeChange}
                                    required>
                                </lightning-input>
                            </div>
                        </div>
                    </div>

                    <div class="slds-section slds-is-open slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Postal Address</h3>
                        
                        <lightning-input
                            type="checkbox"
                            label="Same as registered business address"
                            checked={postalSameAsRegistered}
                            onchange={handlePostalSameAsRegisteredChange}>
                        </lightning-input>

                        <template if:false={postalSameAsRegistered}>
                            <div class="slds-grid slds-wrap slds-gutters slds-m-top_small">
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-input
                                        label="Street number and name/PO Box"
                                        value={postalStreetAddress}
                                        onchange={handlePostalStreetAddressChange}>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-input
                                        label="Suburb/Town"
                                        value={postalSuburb}
                                        onchange={handlePostalSuburbChange}>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-combobox
                                        label="State/Territory"
                                        value={postalState}
                                        placeholder="Select State/Territory"
                                        options={stateOptions}
                                        onchange={handlePostalStateChange}>
                                    </lightning-combobox>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-input
                                        label="Postcode"
                                        value={postalPostcode}
                                        onchange={handlePostalPostcodeChange}>
                                    </lightning-input>
                                </div>
                            </div>
                        </template>
                    </div>

                    <div class="slds-section slds-is-open slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Care Type You Are Applying For</h3>
                        <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">Select the type(s) of care for which approval is sought.</p>
                        
                        <lightning-checkbox-group
                            label="Care Types"
                            options={careTypeOptions}
                            value={selectedCareTypes}
                            onchange={handleCareTypeChange}
                            required>
                        </lightning-checkbox-group>

                        <template if:true={showFlexibleCareOptions}>
                            <div class="slds-m-top_small">
                                <lightning-radio-group
                                    label="Flexible Care Setting"
                                    options={flexibleCareSettingOptions}
                                    value={selectedFlexibleCareSetting}
                                    onchange={handleFlexibleCareSettingChange}
                                    required>
                                </lightning-radio-group>
                            </div>
                        </template>
                    </div>

                    <div class="slds-section slds-is-open">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Organisation Type</h3>
                        <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">You must provide a response to the two questions below which are used for statistical purposes and do not affect the assessment of this application.</p>
                        
                        <div class="slds-m-bottom_medium">
                            <lightning-radio-group
                                label="What is your organisation type?"
                                options={organisationTypeOptions}
                                value={selectedOrganisationType}
                                onchange={handleOrganisationTypeChange}
                                required>
                            </lightning-radio-group>

                            <template if:true={showNotForProfitOptions}>
                                <div class="slds-m-top_small">
                                    <lightning-radio-group
                                        label="Not-For-Profit Type"
                                        options={notForProfitOptions}
                                        value={selectedNotForProfitType}
                                        onchange={handleNotForProfitTypeChange}
                                        required>
                                    </lightning-radio-group>
                                </div>
                            </template>
                        </div>

                        <lightning-radio-group
                            label="Is your organisation or its parent body listed on the Australian Stock Exchange?"
                            options={yesNoOptions```html
                            options={yesNoOptions}
                            value={stockExchangeListed}
                            onchange={handleStockExchangeListedChange}
                            required>
                        </lightning-radio-group>
                    </div>
                </div>
            </template>

            <!-- Page 3: Key Personnel Details -->
            <template if:true={isPage3}>
                <div class="slds-section slds-is-open">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Your Key Personnel</h2>
                    
                    <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-bottom_medium" role="alert">
                        <h3 class="slds-text-heading_small">Key Personnel Requirements</h3>
                        <p class="slds-text-body_small">Under Part 7A, subsection 63D(2)(c) of the Commission Act, the Commissioner must not approve a person as a provider of aged care unless the Commissioner is satisfied that each individual who is one of the key personnel of the person is suitable to be involved in the provision of aged care.</p>
                    </div>

                    <div class="slds-box slds-theme_shade slds-m-bottom_medium">
                        <h3 class="slds-text-heading_small slds-m-bottom_small">Key Personnel Include:</h3>
                        <ul class="slds-list_dotted slds-text-body_small">
                            <li>Persons who may have authority, responsibility for and/or significant influence over decision making</li>
                            <li>Any persons who are responsible for the nursing services and hold a recognised nursing qualification</li>
                            <li>Any person responsible for the day-to-day operations of the aged care service</li>
                            <li>Directors, shareholders, or secretaries of the company registered with ASIC</li>
                            <li>Persons listed as responsible persons with the Australian Charities and Not-for-Profit Commission</li>
                        </ul>
                    </div>

                    <template for:each={keyPersonnelList} for:item="person" for:index="index">
                        <div key={person.id} class="slds-card slds-m-bottom_medium">
                            <div class="slds-card__header">
                                <h3 class="slds-text-heading_small">Key Personnel {person.displayIndex}</h3>
                            </div>
                            <div class="slds-card__body slds-card__body_inner">
                                <div class="slds-grid slds-wrap slds-gutters">
                                    <div class="slds-col slds-size_1-of-6">
                                        <lightning-combobox
                                            label="Title"
                                            value={person.title}
                                            placeholder="Select Title"
                                            options={titleOptions}
                                            data-id={person.id}
                                            data-field="title"
                                            onchange={handleKeyPersonnelChange}>
                                        </lightning-combobox>
                                    </div>
                                    <div class="slds-col slds-size_5-of-6">
                                        <lightning-input
                                            label="First and Last Name"
                                            value={person.fullName}
                                            data-id={person.id}
                                            data-field="fullName"
                                            onchange={handleKeyPersonnelChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Former Name (as applicable)"
                                            value={person.formerName}
                                            data-id={person.id}
                                            data-field="formerName"
                                            onchange={handleKeyPersonnelChange}>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Preferred Name"
                                            value={person.preferredName}
                                            data-id={person.id}
                                            data-field="preferredName"
                                            onchange={handleKeyPersonnelChange}>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Date of Birth"
                                            type="date"
                                            value={person.dateOfBirth}
                                            data-id={person.id}
                                            data-field="dateOfBirth"
                                            onchange={handleKeyPersonnelChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Position Title"
                                            value={person.positionTitle}
                                            data-id={person.id}
                                            data-field="positionTitle"
                                            onchange={handleKeyPersonnelChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Contact Email Address"
                                            type="email"
                                            value={person.email}
                                            data-id={person.id}
                                            data-field="email"
                                            onchange={handleKeyPersonnelChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Contact Phone Number - Mobile"
                                            type="tel"
                                            value={person.mobilePhone}
                                            data-id={person.id}
                                            data-field="mobilePhone"
                                            onchange={handleKeyPersonnelChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="Principal Duties of Position"
                                            value={person.principalDuties}
                                            data-id={person.id}
                                            data-field="principalDuties"
                                            onchange={handleKeyPersonnelChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                </div>

                                <div class="slds-section slds-is-open slds-m-top_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">Qualifications</h4>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">You must show why you are suitable for the role you have detailed, including relevant qualifications for that role and to the delivery of aged care.</p>
                                    
                                    <template for:each={person.qualifications} for:item="qual" for:index="qualIndex">
                                        <div key={qual.id} class="slds-grid slds-wrap slds-gutters slds-m-bottom_small">
                                            <div class="slds-col slds-size_2-of-3">
                                                <lightning-input
                                                    label="Qualification Title and Educational Facility"
                                                    value={qual.title}
                                                    data-person-id={person.id}
                                                    data-qual-id={qual.id}
                                                    data-field="title"
                                                    onchange={handleQualificationChange}>
                                                </lightning-input>
                                            </div>
                                            <div class="slds-col slds-size_1-of-3">
                                                <lightning-input
                                                    label="Date Obtained"
                                                    type="date"
                                                    value={qual.dateObtained}
                                                    data-person-id={person.id}
                                                    data-qual-id={qual.id}
                                                    data-field="dateObtained"
                                                    onchange={handleQualificationChange}>
                                                </lightning-input>
                                            </div>
                                        </div>
                                    </template>
                                </div>

                                <div class="slds-section slds-is-open slds-m-top_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">Experience</h4>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">List your previous experience that is relevant to providing aged care.</p>
                                    
                                    <template for:each={person.experience} for:item="exp" for:index="expIndex">
                                        <div key={exp.id} class="slds-box slds-theme_shade slds-m-bottom_small">
                                            <div class="slds-grid slds-wrap slds-gutters">
                                                <div class="slds-col slds-size_1-of-1">
                                                    <lightning-textarea
                                                        label="Employer Name and Address"
                                                        value={exp.employerName}
                                                        data-person-id={person.id}
                                                        data-exp-id={exp.id}
                                                        data-field="employerName"
                                                        onchange={handleExperienceChange}>
                                                    </lightning-textarea>
                                                </div>
                                                <div class="slds-col slds-size_1-of-2">
                                                    <lightning-input
                                                        label="Period From"
                                                        type="date"
                                                        value={exp.periodFrom}
                                                        data-person-id={person.id}
                                                        data-exp-id={exp.id}
                                                        data-field="periodFrom"
                                                        onchange={handleExperienceChange}>
                                                    </lightning-input>
                                                </div>
                                                <div class="slds-col slds-size_1-of-2">
                                                    <lightning-input
                                                        label="Period To"
                                                        type="date"
                                                        value={exp.periodTo}
                                                        data-person-id={person.id}
                                                        data-exp-id={exp.id}
                                                        data-field="periodTo"
                                                        onchange={handleExperienceChange}>
                                                    </lightning-input>
                                                </div>
                                                <div class="slds-col slds-size_1-of-1">
                                                    <lightning-textarea
                                                        label="Role Description (including how it is relevant to providing aged care)"
                                                        value={exp.roleDescription}
                                                        data-person-id={person.id}
                                                        data-exp-id={exp.id}
                                                        data-field="roleDescription"
                                                        onchange={handleExperienceChange}>
                                                    </lightning-textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>

                                <div class="slds-section slds-is-open slds-m-top_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">Required Attachments</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-3">
                                            <lightning-input
                                                type="checkbox"
                                                label="NPC or NCHC or NDIS worker screening check attached"
                                                checked={person.policeCheckAttached}
                                                data-id={person.id}
                                                data-field="policeCheckAttached"
                                                onchange={handleKeyPersonnelChange}>
                                            </lightning-input>
                                        </div>
                                        <div class="slds-col slds-size_1-of-3">
                                            <lightning-input
                                                type="checkbox"
                                                label="Insolvency check attached"
                                                checked={person.insolvencyCheckAttached}
                                                data-id={person.id}
                                                data-field="insolvencyCheckAttached"
                                                onchange={handleKeyPersonnelChange}>
                                            </lightning-input>
                                        </div>
                                        <div class="slds-col slds-size_1-of-3">
                                            <lightning-input
                                                type="checkbox"
                                                label="Statutory declaration attached"
                                                checked={person.statutoryDeclarationAttached}
                                                data-id={person.id}
                                                data-field="statutoryDeclarationAttached"
                                                onchange={handleKeyPersonnelChange}>
                                            </lightning-input>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>

                    <div class="slds-text-align_center slds-m-bottom_medium">
                        <lightning-button
                            label="Add Key Personnel"
                            variant="neutral"
                            onclick={addKeyPersonnel}>
                        </lightning-button>
                    </div>
                </div>
            </template>

            <!-- Page 4: Suitability Assessment -->
            <template if:true={isPage4}>
                <div class="slds-section slds-is-open">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Your Suitability to be an Approved Provider</h2>
                    
                    <div class="slds-section slds-is-open slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Experience, Conduct and Compliance</h3>
                        
                        <div class="slds-m-bottom_medium">
                            <lightning-textarea
                                label="Describe your organisation's current experience in the delivery of aged care, or if you have no aged care experience, describe your experience delivering other care relevant to the care type you are applying for."
                                value={experienceDescription}
                                onchange={handleExperienceDescriptionChange}
                                required>
                            </lightning-textarea>
                            <div class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                <p>Things for you to consider when writing your response:</p>
                                <ul class="slds-list_dotted">
                                    <li>Relevant care may include delivery of care under the CHSP, NDIS, sub-contract or private fee for service care</li>
                                    <li>Your response must directly reflect the experience of the organisation applying</li>
                                </ul>
                            </div>
                        </div>

                        <div class="slds-m-bottom_medium">
                            <h4 class="slds-text-heading_small slds-m-bottom_small">Services Provided</h4>
                            <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">Provide details of the services you provide or have provided. Each item must clearly identify the date commenced, number of people served, and current service numbers.</p>
                            
                            <lightning-datatable
                                key-field="id"
                                data={servicesProvided}
                                columns={servicesColumns}
                                onrowaction={handleServicesRowActiononrowaction={handleServicesRowAction}
                                hide-checkbox-column>
                            </lightning-datatable>
                            
                            <div class="slds-text-align_center slds-m-top_small">
                                <lightning-button
                                    label="Add Service"
                                    variant="neutral"
                                    onclick={addService}>
                                </lightning-button>
                            </div>
                        </div>

                        <div class="slds-m-bottom_medium">
                            <lightning-textarea
                                label="Explain how your organisation's board members and/or senior management's experience and expertise is relevant to having oversight and responsibility for decisions about the delivery of aged care on a day-to-day basis."
                                value={managementExperience}
                                onchange={handleManagementExperienceChange}
                                required>
                            </lightning-textarea>
                        </div>

                        <div class="slds-m-bottom_medium">
                            <lightning-radio-group
                                label="Have any of your key personnel/senior management owned or co-owned, or held a company Director/Secretary role with, any company that has been de-registered by ASIC?"
                                options={yesNoOptions}
                                value={asicDeregistered}
                                onchange={handleAsicDeregisteredChange}
                                required>
                            </lightning-radio-group>

                            <template if:true={showAsicDetails}>
                                <lightning-textarea
                                    label="Please provide details including an explanation about why the company was de-registered"
                                    value={asicDeregisteredDetails}
                                    onchange={handleAsicDeregisteredDetailsChange}
                                    class="slds-m-top_small"
                                    required>
                                </lightning-textarea>
                            </template>
                        </div>
                    </div>

                    <div class="slds-section slds-is-open slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Governance Systems</h3>
                        
                        <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-bottom_medium" role="alert">
                            <p class="slds-text-body_small">Your governance systems are the foundation of your organisation and should be appropriately planned for, managed, and monitored. The responses you give below must adequately describe your organisational governance systems.</p>
                        </div>

                        <lightning-accordion allow-multiple-sections-open>
                            <lightning-accordion-section name="information-management" label="Information Management">
                                <div class="slds-grid slds-wrap slds-gutters">
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="Detail your current or proposed information management systems, including electronic and off-line systems."
                                            value={informationManagementSystems}
                                            onchange={handleInformationManagementSystemsChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="Provide an overview of supporting policies, procedures and forms/tools that underpin your systems."
                                            value={informationManagementPolicies}
                                            onchange={handleInformationManagementPoliciesChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="What specific aged care regulatory requirements does this comply with and why is it compliant?"
                                            value={informationManagementCompliance}
                                            onchange={handleInformationManagementComplianceChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="Who in the organisation is/will be responsible for the development, implementation, and maintenance of the systems?"
                                            value={informationManagementResponsible}
                                            onchange={handleInformationManagementResponsibleChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                </div>
                            </lightning-accordion-section>

                            <lightning-accordion-section name="continuous-improvement" label="Continuous Improvement">
                                <div class="slds-grid slds-wrap slds-gutters">
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="Detail your current or proposed continuous improvement system."
                                            value={continuousImprovementSystems}
                                            onchange={handleContinuousImprovementSystemsChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="Provide an overview of supporting policies, procedures and forms/tools that underpin your systems."
                                            value={continuousImprovementPolicies}
                                            onchange={handleContinuousImprovementPoliciesChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="What specific aged care regulatory requirements does this comply with and why is it compliant?"
                                            value={continuousImprovementCompliance}
                                            onchange={handleContinuousImprovementComplianceChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="Who in the organisation is/will be responsible for the development, implementation, and maintenance of the system?"
                                            value={continuousImprovementResponsible}
                                            onchange={handleContinuousImprovementResponsibleChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                </div>
                            </lightning-accordion-section>

                            <lightning-accordion-section name="financial-governance" label="Financial Governance">
                                <div class="slds-grid slds-wrap slds-gutters">
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="Detail your current or proposed financial governance system, including electronic or off-line systems."
                                            value={financialGovernanceSystems}
                                            onchange={handleFinancialGovernanceSystemsChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="Provide an overview of supporting policies, procedures and forms that underpin your system."
                                            value={financialGovernancePolicies}
                                            onchange={handleFinancialGovernancePoliciesChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="What specific aged care regulatory requirements does this comply with and why is it compliant?"
                                            value={financialGovernanceCompliance}
                                            onchange={handleFinancialGovernanceComplianceChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="Who in the organisation is/will be responsible for the development, implementation, and maintenance of the system?"
                                            value={financialGovernanceResponsible}
                                            onchange={handleFinancialGovernanceResponsibleChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                </div>
                            </lightning-accordion-section>
                        </lightning-accordion>
                    </div>

                    <div class="slds-section slds-is-open">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Financial Management</h3>
                        
                        <div class="slds-m-bottom_medium">
                            <lightning-textarea
                                label="Provide a detailed description of the policies and procedures you have in place or will develop, implement, and monitor to ensure sound financial management in accordance with the Aged Care Act and associated Principles."
                                value={financialManagementDescription}
                                onchange={handleFinancialManagementDescriptionChange}
                                required>
                            </lightning-textarea>
                        </div>

                        <div class="slds-m-bottom_medium">
                            <lightning-textarea
                                label="Describe your financial management strategy and detail how you plan to become and remain financially viable."
                                value={financialStrategy}
                                onchange={handleFinancialStrategyChange}
                                required>
                            </lightning-textarea>
                        </div>

                        <div class="slds-m-bottom_medium">
                            <h4 class="slds-text-heading_small slds-m-bottom_small">Financial Capacity</h4>
                            <lightning-textarea
                                label="The actual financial capital of your organisation  this means the funds your company has available at its disposal to commence operating as an approved provider."
                                value={financialCapital}
                                onchange={handleFinancialCapitalChange}
                                required>
                            </lightning-textarea>
                        </div>

                        <div class="slds-m-bottom_medium">
                            <lightning-textarea
                                label="The proportion of your financial capital that is available to you solely for the purpose of meeting the start-up costs associated with the delivery of aged care."
                                value={startupCosts}
                                onchange={handleStartupCostsChange}
                                required>
                            </lightning-textarea>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Page 5: Care Type Specific -->
            <template if:true={isPage5}>
                <div class="slds-section slds-is-open">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Your Ability to Meet Care Type Specific Matters</h2>
                    
                    <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-bottom_medium" role="alert">
                        <p class="slds-text-body_small">When seeking approval to provide a certain type of care, the applicant must demonstrate how it will meet the requirements that relate to the delivery of that type of care. Only complete the questions that relate to the care type(s) you are applying for.</p>
                    </div>

                    <!-- Residential Care Section -->
                    <template if:true={showResidentialCare}>
                        <div class="slds-section slds-is-open slds-m-bottom_large">
                            <h3 class="slds-text-heading_small slds-m-bottom_medium">Residential Care</h3>
                            
                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe what systems, policies, or procedures you have/will develop, implement, and monitor to ensure you comply with the Prudential Standards as described in Part 5 of the Fees and Payments Principles 2014 (No.2)."
                                    value={prudentialStandards}
                                    onchange={handlePrudentialStandardsChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe what reporting procedures and mechanisms you have or will implement to ensure key personnel responsible for executive decisions can effectively manage, monitor, and control the use of refundable deposits."
                                    value={refundableDeposits}
                                    onchange={handleRefundableDepositsChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe how you will finance the purchase, construction and/or lease of a residential aged care facility and describe the associated risks."
                                    value={facilityFinancing}
                                    onchange={handleFacilityFinancingChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe the responsibilities of an approved provider of residential care under section 54-1(1)(f) of the Aged Care Act and the Aged Care Quality of Care Principles as it relates to the use of restrictive practices."
                                    value={restrictivePracticesResponsibilities}
                                    onchange={handleRestrictivePracticesResponsibilitiesChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Explain in detail the steps you will take to ensure compliance with restrictive practices requirements."
                                    value={restrictivePracticesSteps}
                                    onchange={handleRestrictivePracticesStepsChange}
                                    required>
                                </lightning-textarea>
                            </div>
                        </div>
                    </template>

                    <!-- Home Care Section -->
                    <template if:true={showHomeCare}>
                        <div class="slds-section slds-is-open slds-m-bottom_large">
                            <h3 class="slds-text-heading_small slds-m-bottom_medium">Home Care</h3>
                            
                            <div class="slds-notify slds-notify_alert slds-theme_warning slds-theme_alert-texture slds-m-bottom_medium" role="alert">
                                <p class="slds-text-body_small">When an organisation is approved to provide home care, the approval is effective from the date of the approval and it can start receiving referrals and delivering home care packages within a short period of time.</p>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Detail the systems, policies, or procedures you have/will develop, implement and monitor to deliver home care from referral to delivery."
                                    value={homeCareDeliverySystem}
                                    onchange={handleHomeCareDeliverySystemChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="What tools or methods will you implement to accurately capture care recipient current and future health status?"
                                    value={healthStatusTools}
                                    onchange={handleHealthStatusToolsChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe the system that you will use to operationalise the delivery of care and services to care recipients in their home on a day-to-day basis."
                                    value={dailyCareSystem}
                                    onchange={handleDailyCareSystemChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Detail the systems, policies, or procedures you have/will develop, implement, and monitor to managemedication correctly and safely as set out in Standard 3 of the Aged Care Quality Standards."
                                    value={medicationManagement}
                                    onchange={handleMedicationManagementChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe how you will provide choice and flexibility of care to care recipients in their home care package, in accordance with the Charter of Aged Care Rights."
                                    value={careChoiceFlexibility}
                                    onchange={handleCareChoiceFlexibilityChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe how you will meet your obligations and responsibilities to ensure the portability of the care recipient's home care package."
                                    value={packagePortability}
                                    onchange={handlePackagePortabilityChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Detail the systems, policies, or procedures you have/will develop, implement, and monitor, to manage individual care recipients' fees, individualised budgets, monthly statements, invoicing and subsidies received."
                                    value={feeManagementSystem}
                                    onchange={handleFeeManagementSystemChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe the obligations and responsibilities to ensure pricing information about the cost of providing the care and services to care recipients including notification requirements."
                                    value={pricingInformation}
                                    onchange={handlePricingInformationChange}
                                    required>
                                </lightning-textarea>
                            </div>
                        </div>
                    </template>

                    <!-- Flexible Care Section -->
                    <template if:true={showFlexibleCare}>
                        <div class="slds-section slds-is-open">
                            <h3 class="slds-text-heading_small slds-m-bottom_medium">Flexible Care</h3>
                            
                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe from an experience perspective, how is flexible care to be provided: Restorative care that would meet the objectives of delivering flexible care in the form of short-term restorative care; and/or Other kinds of flexible care."
                                    value={flexibleCareExperience}
                                    onchange={handleFlexibleCareExperienceChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe what policies, procedures, or forms you have or will develop, implement and monitor to effectively deliver short-term restorative care in compliance with the responsibilities of an approved provider."
                                    value={restorativeCareDelivery}
                                    onchange={handleRestorativeCareDeliveryChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe what you will do to provide statements to care recipients for the services you will deliver through the program."
                                    value={careRecipientStatements}
                                    onchange={handleCareRecipientStatementsChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_medium">
                                <lightning-textarea
                                    label="Describe the responsibilities of an approved provider in relation to the concept of multi-disciplinary teams in the delivery of flexible care."
                                    value={multiDisciplinaryTeams}
                                    onchange={handleMultiDisciplinaryTeamsChange}
                                    required>
                                </lightning-textarea>
                            </div>
                        </div>
                    </template>
                </div>
            </template>

            <!-- Error Messages -->
            <template if:true={showErrors}>
                <div class="slds-notify slds-notify_alert slds-theme_error slds-theme_alert-texture slds-m-bottom_medium" role="alert">
                    <h3 class="slds-text-heading_small">Please correct the following errors:</h3>
                    <ul class="slds-list_dotted">
                        <template for:each={errorMessages} for:item="error">
                            <li key={error}>{error}</li>
                        </template>
                    </ul>
                </div>
            </template>

            <!-- Navigation Buttons -->
            <div class="slds-card__footer">
                <div class="slds-grid slds-grid_align-spread">
                    <div class="slds-col">
                        <template if:false={isFirstPage}>
                            <lightning-button
                                label="Previous"
                                variant="neutral"
                                onclick={handlePrevious}>
                            </lightning-button>
                        </template>
                        <template if:true={isFirstPage}>
                            <lightning-button
                                label="Cancel"
                                variant="neutral"
                                onclick={handleCancel}>
                            </lightning-button>
                        </template>
                    </div>
                    <div class="slds-col">
                        <template if:false={isLastPage}>
                            <lightning-button
                                label="Next"
                                variant="brand"
                                onclick={handleNext}>
                            </lightning-button>
                        </template>
                        <template if:true={isLastPage}>
                            <lightning-button
                                label="Submit Application"
                                variant="brand"
                                onclick={handleSubmit}
                                disabled={isSubmitting}>
                            </lightning-button>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <template if:true={isLoading}>
            <lightning-spinner
                alternative-text="Loading"
                size="medium">
            </lightning-spinner>
        </template>
    </div>
</template>
