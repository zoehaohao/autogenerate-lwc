<template>
    <div class="slds-card">
        <div class="slds-card__header slds-grid">
            <header class="slds-media slds-media_center slds-has-flexi-truncate">
                <div class="slds-media__body">
                    <h2 class="slds-card__header-title">
                        <span class="slds-text-heading_medium">Provider Application Form</span>
                    </h2>
                </div>
            </header>
        </div>
        
        <div class="slds-card__body slds-card__body_inner">
            <!-- Progress Indicator -->
            <div class="slds-m-bottom_large">
                <lightning-progress-indicator 
                    current-step={currentPageString}
                    type="path"
                    variant="base">
                    <lightning-progress-step 
                        label="Personal Information" 
                        value="1">
                    </lightning-progress-step>
                    <lightning-progress-step 
                        label="Contact Details" 
                        value="2">
                    </lightning-progress-step>
                    <lightning-progress-step 
                        label="Additional Information" 
                        value="3">
                    </lightning-progress-step>
                </lightning-progress-indicator>
            </div>

            <!-- Page 1: Personal Information -->
            <template if:true={isPage1}>
                <div class="form-page">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Personal Information</h2>
                    <p class="slds-text-body_regular slds-m-bottom_large">
                        Please provide your personal details. All fields marked with * are required.
                    </p>

                    <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-bottom_medium" role="alert">
                        <h2 class="slds-text-heading_small">Important: All information must be accurate and up-to-date</h2>
                    </div>

                    <div class="slds-grid slds-gutters slds-wrap">
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="First Name"
                                type="text"
                                value={firstName}
                                onchange={handleInputChange}
                                data-field="firstName"
                                required
                                class={firstNameClass}>
                            </lightning-input>
                            <template if:true={errors.firstName}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.firstName}</div>
                            </template>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Last Name"
                                type="text"
                                value={lastName}
                                onchange={handleInputChange}
                                data-field="lastName"
                                required
                                class={lastNameClass}>
                            </lightning-input>
                            <template if:true={errors.lastName}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.lastName}</div>
                            </template>
                        </div>
                    </div>

                    <div class="slds-grid slds-gutters slds-wrap slds-m-top_medium">
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Middle Name"
                                type="text"
                                value={middleName}
                                onchange={handleInputChange}
                                data-field="middleName">
                            </lightning-input>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Date of Birth"
                                type="date"
                                value={dateOfBirth}
                                onchange={handleInputChange}
                                data-field="dateOfBirth"
                                required
                                field-level-help="Enter your date of birth in MM/DD/YYYY format"
                                class={dateOfBirthClass}>
                            </lightning-input>
                            <template if:true={errors.dateOfBirth}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.dateOfBirth}</div>
                            </template>
                        </div>
                    </div>

                    <div class="slds-grid slds-gutters slds-wrap slds-m-top_medium">
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Social Security Number"
                                type="text"
                                value={ssn}
                                onchange={handleInputChange}
                                data-field="ssn"
                                required
                                field-level-help="Enter your 9-digit SSN without dashes"
                                class={ssnClass}>
                            </lightning-input>
                            <template if:true={errors.ssn}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.ssn}</div>
                            </template>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-combobox
                                label="Gender"
                                value={gender}
                                options={genderOptions}
                                onchange={handleInputChange}
                                data-field="gender"
                                required
                                class={genderClass}>
                            </lightning-combobox>
                            <template if:true={errors.gender}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.gender}</div>
                            </template>
                        </div>
                    </div>

                    <div class="slds-m-top_medium">
                        <lightning-textarea
                            label="Address"
                            value={address}
                            onchange={handleInputChange}
                            data-field="address"
                            required
                            placeholder="Enter your complete address"
                            class={addressClass}>
                        </lightning-textarea>
                        <template if:true={errors.address}>
                            <div class="slds-text-color_error slds-text-body_small">{errors.address}</div>
                        </template>
                    </div>

                    <div class="slds-grid slds-gutters slds-wrap slds-m-top_medium">
                        <div class="slds-col slds-size_1-of-3">
                            <lightning-input
                                label="City"
                                type="text"
                                value={city}
                                onchange={handleInputChange}
                                data-field="city"
                                required
                                class={cityClass}>
                            </lightning-input>
                            <template if:true={errors.city}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.city}</div>
                            </template>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-3">
                            <lightning-combobox
                                label="State"
                                value={state}
                                options={stateOptions}
                                onchange={handleInputChange}
                                data-field="state"
                                required
                                class={stateClass}>
                            </lightning-combobox>
                            <template if:true={errors.state}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.state}</div>
                            </template>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-3">
                            <lightning-input
                                label="ZIP Code"
                                type="text"
                                value={zipCode}
                                onchange={handleInputChange}
                                data-field="zipCode"
                                required
                                field-level-help="Enter 5-digit ZIP code"
                                class={zipCodeClass}>
                            </lightning-input>
                            <template if:true={errors.zipCode}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.zipCode}</div>
                            </template>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="slds-m-top_large slds-text-align_right">
                        <lightning-button
                            label="Cancel"
                            variant="neutral"
                            onclick={handleCancel}
                            class="slds-m-right_small">
                        </lightning-button>
                        <lightning-button
                            label="Next"
                            variant="brand"
                            onclick={handleNext}>
                        </lightning-button>
                    </div>
                </div>
            </template>

            <!-- Page 2: Contact Details -->
            <template if:true={isPage2}>
                <div class="form-page">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Contact Details</h2>
                    <p class="slds-text-body_regular slds-m-bottom_large">
                        Please provide your contact information. We will use this information to communicate with you regarding your application.
                    </p>

                    <div class="slds-grid slds-gutters slds-wrap">
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Primary Phone"
                                type="tel"
                                value={primaryPhone}
                                onchange={handleInputChange}
                                data-field="primaryPhone"
                                required
                                field-level-help="Enter 10-digit phone number"
                                class={primaryPhoneClass}>
                            </lightning-input>
                            <template if:true={errors.primaryPhone}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.primaryPhone}</div>
                            </template>
                            <div class="slds-text-color_weak slds-m-top_x-small">
                                Note: Phone number should be 10 digits without spaces or special characters
                            </div>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Secondary Phone"
                                type="tel"
                                value={secondaryPhone}
                                onchange={handleInputChange}
                                data-field="secondaryPhone"
                                field-level-help="Optional secondary contact number">
                            </lightning-input>
                        </div>
                    </div>

                    <div class="slds-grid slds-gutters slds-wrap slds-m-top_medium">
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Email Address"
                                type="email"
                                value={email}
                                onchange={handleInputChange}
                                data-field="email"
                                required
                                class={emailClass}>
                            </lightning-input>
                            <template if:true={errors.email}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.email}</div>
                            </template>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Confirm Email Address"
                                type="email"
                                value={confirmEmail}
                                onchange={handleInputChange}
                                data-field="confirmEmail"
                                required
                                class={confirmEmailClass}>
                            </lightning-input>
                            <template if:true={errors.confirmEmail}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.confirmEmail}</div>
                            </template>
                        </div>
                    </div>

                    <div class="slds-m-top_medium">
                        <lightning-radio-group
                            label="Preferred Contact Method"
                            options={contactMethodOptions}
                            value={preferredContactMethod}
                            onchange={handleInputChange}
                            data-field="preferredContactMethod"
                            required
                            type="radio"
                            class={preferredContactMethodClass}>
                        </lightning-radio-group>
                        <template if:true={errors.preferredContactMethod}>
                            <div class="slds-text-color_error slds-text-body_small">{errors.preferredContactMethod}</div>
                        </template>
                    </div>

                    <div class="slds-m-top_medium">
                        <lightning-combobox
                            label="Best Time to Contact"
                            value={bestTimeToContact}
                            options={timeOptions}
                            onchange={handleInputChange}
                            data-field="bestTimeToContact"
                            required
                            class={bestTimeToContactClass}>
                        </lightning-combobox>
                        <template if:true={errors.bestTimeToContact}>
                            <div class="slds-text-color_error slds-text-body_small">{errors.bestTimeToContact}</div>
                        </template>
                    </div>

                    <div class="slds-m-top_medium">
                        <lightning-input
                            label="Emergency Contact Name"
                            type="text"
                            value={emergencyContactName}
                            onchange={handleInputChange}
                            data-field="emergencyContactName"
                            required
                            class={emergencyContactNameClass}>
                        </lightning-input>
                        <template if:true={errors.emergencyContactName}>
                            <div class="slds-text-color_error slds-text-body_small">{errors.emergencyContactName}</div>
                        </template>
                    </div>

                    <div class="slds-grid slds-gutters slds-wrap slds-m-top_medium">
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Emergency Contact Phone"
                                type="tel"
                                value={emergencyContactPhone}
                                onchange={handleInputChange}
                                data-field="emergencyContactPhone"
                                required
                                class={emergencyContactPhoneClass}>
                            </lightning-input>
                            <template if:true={errors.emergencyContactPhone}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.emergencyContactPhone}</div>
                            </template>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Relationship to Emergency Contact"
                                type="text"
                                value={emergencyContactRelationship}
                                onchange={handleInputChange}
                                data-field="emergencyContactRelationship"
                                required
                                class={emergencyContactRelationshipClass}>
                            </lightning-input>
                            <template if:true={errors.emergencyContactRelationship}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.emergencyContactRelationship}</div>
                            </template>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="slds-m-top_large slds-text-align_right">
                        <lightning-button
                            label="Previous"
                            variant="neutral"
                            onclick={handlePrevious}
                            class="slds-m-right_small">
                        </lightning-button>
                        <lightning-button
                            label="Next"
                            variant="brand"
                            onclick={handleNext"
                            variant="brand"
                            onclick={handleNext}>
                        </lightning-button>
                    </div>
                </div>
            </template>

            <!-- Page 3: Additional Information -->
            <template if:true={isPage3}>
                <div class="form-page">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Additional Information</h2>
                    <p class="slds-text-body_regular slds-m-bottom_large">
                        Please provide additional information to complete your provider application. This information helps us better understand your background and qualifications.
                    </p>

                    <div class="slds-m-bottom_medium">
                        <lightning-combobox
                            label="Provider Type"
                            value={providerType}
                            options={providerTypeOptions}
                            onchange={handleInputChange}
                            data-field="providerType"
                            required
                            class={providerTypeClass}>
                        </lightning-combobox>
                        <template if:true={errors.providerType}>
                            <div class="slds-text-color_error slds-text-body_small">{errors.providerType}</div>
                        </template>
                    </div>

                    <div class="slds-grid slds-gutters slds-wrap">
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="License Number"
                                type="text"
                                value={licenseNumber}
                                onchange={handleInputChange}
                                data-field="licenseNumber"
                                required
                                class={licenseNumberClass}>
                            </lightning-input>
                            <template if:true={errors.licenseNumber}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.licenseNumber}</div>
                            </template>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="License Expiration Date"
                                type="date"
                                value={licenseExpirationDate}
                                onchange={handleInputChange}
                                data-field="licenseExpirationDate"
                                required
                                class={licenseExpirationDateClass}>
                            </lightning-input>
                            <template if:true={errors.licenseExpirationDate}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.licenseExpirationDate}</div>
                            </template>
                        </div>
                    </div>

                    <div class="slds-grid slds-gutters slds-wrap slds-m-top_medium">
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Years of Experience"
                                type="number"
                                value={yearsOfExperience}
                                onchange={handleInputChange}
                                data-field="yearsOfExperience"
                                required
                                min="0"
                                max="50"
                                class={yearsOfExperienceClass}>
                            </lightning-input>
                            <template if:true={errors.yearsOfExperience}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.yearsOfExperience}</div>
                            </template>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-combobox
                                label="Education Level"
                                value={educationLevel}
                                options={educationLevelOptions}
                                onchange={handleInputChange}
                                data-field="educationLevel"
                                required
                                class={educationLevelClass}>
                            </lightning-combobox>
                            <template if:true={errors.educationLevel}>
                                <div class="slds-text-color_error slds-text-body_small">{errors.educationLevel}</div>
                            </template>
                        </div>
                    </div>

                    <div class="slds-m-top_medium">
                        <lightning-checkbox-group
                            label="Specializations"
                            options={specializationOptions}
                            value={specializations}
                            onchange={handleInputChange}
                            data-field="specializations"
                            required
                            class={specializationsClass}>
                        </lightning-checkbox-group>
                        <template if:true={errors.specializations}>
                            <div class="slds-text-color_error slds-text-body_small">{errors.specializations}</div>
                        </template>
                        <div class="slds-text-color_weak slds-m-top_x-small">
                            Select all that apply. At least one specialization is required.
                        </div>
                    </div>

                    <div class="slds-m-top_medium">
                        <lightning-textarea
                            label="Professional Summary"
                            value={professionalSummary}
                            onchange={handleInputChange}
                            data-field="professionalSummary"
                            required
                            placeholder="Provide a brief summary of your professional background and qualifications"
                            max-length="500"
                            class={professionalSummaryClass}>
                        </lightning-textarea>
                        <template if:true={errors.professionalSummary}>
                            <div class="slds-text-color_error slds-text-body_small">{errors.professionalSummary}</div>
                        </template>
                    </div>

                    <div class="slds-m-top_medium">
                        <lightning-input
                            label="Previous Employer"
                            type="text"
                            value={previousEmployer}
                            onchange={handleInputChange}
                            data-field="previousEmployer">
                        </lightning-input>
                    </div>

                    <div class="slds-grid slds-gutters slds-wrap slds-m-top_medium">
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Employment Start Date"
                                type="date"
                                value={employmentStartDate}
                                onchange={handleInputChange}
                                data-field="employmentStartDate">
                            </lightning-input>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Employment End Date"
                                type="date"
                                value={employmentEndDate}
                                onchange={handleInputChange}
                                data-field="employmentEndDate">
                            </lightning-input>
                        </div>
                    </div>

                    <div class="slds-m-top_medium">
                        <lightning-input
                            type="checkbox"
                            label="I certify that all information provided is accurate and complete"
                            checked={certificationAgreement}
                            onchange={handleInputChange}
                            data-field="certificationAgreement"
                            required
                            class={certificationAgreementClass}>
                        </lightning-input>
                        <template if:true={errors.certificationAgreement}>
                            <div class="slds-text-color_error slds-text-body_small">{errors.certificationAgreement}</div>
                        </template>
                    </div>

                    <div class="slds-notify slds-notify_alert slds-theme_warning slds-theme_alert-texture slds-m-top_medium" role="alert">
                        <h2 class="slds-text-heading_small">Legal Disclaimer: By submitting this application, you agree to background verification and credential validation processes.</h2>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="slds-m-top_large slds-text-align_right">
                        <lightning-button
                            label="Previous"
                            variant="neutral"
                            onclick={handlePrevious}
                            class="slds-m-right_small">
                        </lightning-button>
                        <lightning-button
                            label="Submit Application"
                            variant="brand"
                            onclick={handleSubmit}
                            disabled={isSubmitting}>
                        </lightning-button>
                    </div>
                </div>
            </template>

            <!-- Loading Spinner -->
            <template if:true={isLoading}>
                <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
            </template>
        </div>
    </div>
</template>
