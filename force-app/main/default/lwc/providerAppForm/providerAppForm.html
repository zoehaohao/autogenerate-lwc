<template>
    <div class="slds-card">
        <!-- Header -->
        <div class="slds-card__header slds-border_bottom">
            <div class="slds-media slds-media_center">
                <div class="slds-media__body">
                    <h1 class="slds-card__header-title slds-text-heading_large">
                        Application for Approval to Provide Aged Care - New Applicant
                    </h1>
                    <p class="slds-text-body_regular slds-m-top_small">
                        Before completing this application form, you must understand what it means to be an approved provider.
                    </p>
                </div>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="slds-card__body slds-p-horizontal_large slds-p-top_medium">
            <lightning-progress-indicator 
                current-step={currentPageString}
                type="path"
                variant="base">
                <lightning-progress-step 
                    label="Key Personnel Declaration" 
                    value="1">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="About the Applicant" 
                    value="2">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Key Personnel Details" 
                    value="3">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Suitability Assessment" 
                    value="4">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Care Type Specific" 
                    value="5">
                </lightning-progress-step>
            </lightning-progress-indicator>
        </div>

        <!-- Page Content -->
        <div class="slds-card__body slds-p-around_large">
            
            <!-- Page 1: Key Personnel Declaration -->
            <template if:true={isPage1}>
                <div class="page-content">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Key Personnel Declaration</h2>
                    
                    <div class="slds-notify slds-notify_alert slds-theme_warning slds-theme_alert-texture slds-m-bottom_large" role="alert">
                        <h3 class="slds-text-heading_small">Important Information</h3>
                        <p>Giving false and misleading information is a serious offence. There are offences established by the Commission Act and the Criminal Code Act 1995 (Cth) relating to providing false and misleading information.</p>
                    </div>

                    <div class="slds-box slds-theme_shade slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Key Personnel Declaration</h3>
                        <p class="slds-text-body_regular slds-m-bottom_small">I/we declare that I/we:</p>
                        
                        <ol class="slds-list_ordered slds-text-body_small">
                            <li class="slds-m-bottom_small">are aware that, under section 63J(1)(c) of the Commission Act, if the Commissioner is satisfied that the application contained information that was false or misleading in a material particular, any approval as an approved provider must be revoked.</li>
                            <li class="slds-m-bottom_small">understand that Chapter 2 and section 137.1 of the Criminal Code applies to offences against the Commission Act. Providing false or misleading information in this application is a serious offence.</li>
                            <li class="slds-m-bottom_small">have provided true and accurate information in this application form.</li>
                            <li class="slds-m-bottom_small">understand that the application form must be signed by persons lawfully authorised to act on behalf of/represent the organisation.</li>
                            <li class="slds-m-bottom_small">consent to the Commissioner obtaining information and documents from other persons or organisations.</li>
                            <li class="slds-m-bottom_small">understand that information I/we give to the Commission may be disclosed where permitted or required by law.</li>
                            <li class="slds-m-bottom_small">understand that the corporation name shown on the Certificate of Registration provided with this application will be used in any communications.</li>
                            <li class="slds-m-bottom_small">declare that all of our/my organisation's key personnel are individuals suitable to be involved in the provision of aged care.</li>
                            <li class="slds-m-bottom_small">have read the Aged Care Approved Provider Applicant Guide and understand the responsibilities and obligations of approved providers.</li>
                            <li class="slds-m-bottom_small">understand that the Commission will examine its own records in relation to this application.</li>
                            <li class="slds-m-bottom_small">understand that if a consultant or external party is engaged to assist in preparing this application, our/my organisation is ultimately responsible for the information provided.</li>
                        </ol>
                    </div>

                    <div class="slds-grid slds-wrap slds-gutters">
                        <div class="slds-col slds-size_1-of-2">
                            <h4 class="slds-text-heading_small slds-m-bottom_medium">Declaring Officer 1 - Key Personnel</h4>
                            <lightning-input
                                label="Name"
                                value={declaringOfficer1Name}
                                onchange={handleDeclaringOfficer1NameChange}
                                required>
                            </lightning-input>
                            <lightning-input
                                label="Position"
                                value={declaringOfficer1Position}
                                onchange={handleDeclaringOfficer1PositionChange}
                                required
                                class="slds-m-top_small">
                            </lightning-input>
                            <lightning-input
                                label="Date"
                                type="date"
                                value={declaringOfficer1Date}
                                onchange={handleDeclaringOfficer1DateChange}
                                required
                                class="slds-m-top_small">
                            </lightning-input>
                            <div class="slds-m-top_medium">
                                <lightning-input
                                    type="checkbox"
                                    label="I acknowledge and agree to the declaration above"
                                    checked={declaringOfficer1Acknowledged}
                                    onchange={handleDeclaringOfficer1AcknowledgeChange}
                                    required>
                                </lightning-input>
                            </div>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-2">
                            <h4 class="slds-text-heading_small slds-m-bottom_medium">Declaring Officer 2 - Key Personnel</h4>
                            <lightning-input
                                label="Name"
                                value={declaringOfficer2Name}
                                onchange={handleDeclaringOfficer2NameChange}
                                required>
                            </lightning-input>
                            <lightning-input
                                label="Position"
                                value={declaringOfficer2Position}
                                onchange={handleDeclaringOfficer2PositionChange}
                                required
                                class="slds-m-top_small">
                            </lightning-input>
                            <lightning-input
                                label="Date"
                                type="date"
                                value={declaringOfficer2Date}
                                onchange={handleDeclaringOfficer2DateChange}
                                required
                                class="slds-m-top_small">
                            </lightning-input>
                            <div class="slds-m-top_medium">
                                <lightning-input
                                    type="checkbox"
                                    label="I acknowledge and agree to the declaration above"
                                    checked={declaringOfficer2Acknowledged}
                                    onchange={handleDeclaringOfficer2AcknowledgeChange}
                                    required>
                                </lightning-input>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Page 2: About the Applicant -->
            <template if:true={isPage2}>
                <div class="page-content">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">About the Applicant</h2>
                    
                    <div class="slds-section slds-is-open">
                        <h3 class="slds-section__title slds-theme_shade">
                            <span class="slds-text-heading_small slds-p-horizontal_small">Organisation Details</span>
                        </h3>
                        <div class="slds-section__content slds-p-around_medium">
                            <div class="slds-grid slds-wrap slds-gutters">
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-input
                                        label="Applicant's (Company) Legal Name"
                                        value={companyLegalName}
                                        onchange={handleCompanyLegalNameChange}
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-input
                                        label="Applicant's (Company) ACN, IAN or ICN"
                                        value={companyACN}
                                        onchange={handleCompanyACNChange}
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-input
                                        label="Applicant's (Company) ABN"
                                        value={companyABN}
                                        onchange={handleCompanyABNChange}
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-input
                                        label="Business Name (if applicable)"
                                        value={businessName}
                                        onchange={handleBusinessNameChange}>
                                    </lightning-input>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="slds-section slds-is-open slds-m-top_large">
                        <h3 class="slds-section__title slds-theme_shade">
                            <span class="slds-text-heading_small slds-p-horizontal_small">Registered Business Address</span>
                        </h3>
                        <div class="slds-section__content slds-p-around_medium">
                            <div class="slds-grid slds-wrap slds-gutters">
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-input
                                        label="Street number and name (must be the registered physical address of the organisation)"
                                        value={registeredStreetAddress}
                                        onchange={handleRegisteredStreetAddressChange}
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-input
                                        label="Suburb/Town"
                                        value={registeredSuburb}
                                        onchange={handleRegisteredSuburbChange}
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-combobox
                                        label="State/Territory"
                                        value={registeredState}
                                        options={stateOptions}
                                        onchange={handleRegisteredStateChange}
                                        required>
                                    </lightning-combobox>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-input
                                        label="Postcode"
                                        value={registeredPostcode}
                                        onchange={handleRegisteredPostcodeChange}
                                        required>
                                    </lightning-input>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="slds-section slds-is-open slds-m-top_large">
                        <h3 class="slds-section__title slds-theme_shade">
                            <span class="slds-text-heading_small slds-p-horizontal_small">Postal Address</span>
                        </h3>
                        <div class="slds-section__content slds-p-around_medium">
                            <div class="slds-m-bottom_medium">
                                <lightning-input
                                    type="checkbox"
                                    label="Same as registered business address"
                                    checked={postalSameAsRegistered}
                                    onchange={handlePostalSameAsRegisteredChange}>
                                </lightning-input>
                            </div>
                            <template if:false={postalSameAsRegistered}>
                                <div class="slds-grid slds-wrap slds-gutters">
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-input
                                            label="Street number and name/PO Box"
                                            value={postalStreetAddress}
                                            onchange={handlePostalStreetAddressChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-3">
                                        <lightning-input
                                            label="Suburb/Town"
                                            value={postalSuburb}
                                            onchange={handlePostalSuburbChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-3">
                                        <lightning-combobox
                                            label="State/Territory"
                                            value={postalState}
                                            options={stateOptions}
                                            onchange={handlePostalStateChange}
                                            required>
                                        </lightning-combobox>
                                    </div>
                                    <div class="slds-col slds-size_1-of-3">
                                        <lightning-input
                                            label="Postcode"
                                            value={postalPostcode}
                                            onchange={handlePostalPostcodeChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="slds-section slds-is-open slds-m-top_large">
                        <h3 class="slds-section__title slds-theme_shade">
                            <span class="slds-text-heading_small slds-p-horizontal_small">Care Type Selection</span>
                        </h3>
                        <div class="slds-section__content slds-p-around_medium">
                            <p class="slds-text-body_regular slds-m-bottom_medium">
                                Select the type(s) of care for which approval is sought. All applicants must complete Sections 2 and 3 of this application form, regardless of the type of care being applied for.
                            </p>
                            <lightning-checkbox-group
                                label="Care Types"
                                options={careTypeOptions}
                                value={selectedCareTypes}
                                onchange={handleCareTypeChange}
                                required>
                            </lightning-checkbox-group>
                            
                            <template if:true={showFlexibleCareSettings}>
                                <div class="slds-m-top_medium">
                                    <p class="slds-text-body_regular slds-m-bottom_small">For Flexible Care, please select the setting:</p>
                                    <lightning-radio-group
                                        label="Flexible Care Setting"
                                        options={flexibleCareSettingOptions}
                                        value={selectedFlexibleCareSetting}
                                        onchange={handleFlexibleCareSettingChange}
                                        required>
                                    </lightning-radio-group>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="slds-section slds-is-open slds-m-top_large">
                        <h3 class="slds-section__title slds-theme_shade">
                            <span class="slds-text-heading_small slds-p-horizontal_small">Organisation Type</span>
                        </h3>
                        <div class="slds-section__content slds-p-around_medium">
                            <p class="slds-text-body_regular slds-m-bottom_medium">
                                You must provide a response to the two questions below which are used for statistical purposes and do not affect the assessment of this application.
                            </p>
                            <div class="slds-m-bottom_medium">
                                <lightning-radio-group
                                    label="What is your organisation type?"
                                    options={organisationTypeOptions}
                                    value={selectedOrganisationType}
                                    onchange={handleOrganisationTypeChange}
                                    required>
                                </lightning-radio-group>
                            </div>
                            
                            <template if:true={showNotForProfitSubTypes}>
                                <div class="slds-m-bottom_medium">
                                    <lightning-radio-group
                                        label="Not-For-Profit Type"
                                        options={notForProfitOptions}
                                        value={selectedNotForProfitType}
                                        onchange={handleNotForProfitTypeChange}
                                        required>
                                    </lightning-radio-group>
                                </div>
                            </template>

                            <div class="slds-m-bottom_medium">
                                <lightning-radio-group
                                    label="Is your organisation or its parent body listed on the Australian Stock Exchange?"
                                    options={yesNoOptions}
                                    value={isListedOnASX}
                                    onchange={handleIsListedOnASXChange}
                                    required>
                                </lightning-radio-group>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Page 3: Key Personnel Details -->
            <template if:true={isPage3}>
                <div class="page-content">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Key Personnel Details</h2>
                    
                    <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-bottom_large" role="alert">
                        <h3 class="slds-text-heading_small">Important Information</h3>
                        <p>Under Part 7A, subsection 63D(2)(c) of the Commission Act, the Commissioner must not approve a person as a provider of aged care unless the Commissioner is satisfied that each individual who is one of the key personnel of the person is suitable to be involved in the provision of aged care.</p>
                    </div>

                    <div class="slds-box slds-theme_shade slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Key Personnel Requirements</h3>
                        <p class="slds-text-body_regular slds-m-bottom_small">Key personnel of your organisation include (but may not be limited to):</p>
                        <ul class="slds-list_dotted slds-text-body_small">
                            <li>Persons who may have authority, responsibility for and/or significant influence over decision making</li>
                            <li>Any persons who are, or are likely to be, responsible for the nursing services</li>
                            <li>Any person who are, or are likely to be, responsible for the day-to-day operations</li>
                            <li>Directors, shareholders, or secretaries of the company</li>
                            <li>Persons listed as responsible persons with the Australian Charities and Not-for-Profit Commission</li>
                            <li>Individuals in a management company employed or contracted to your organisation</li>
                            <li>Contractors, consultants, or volunteers who may have direct control and/or influence over decision making</li>
                        </ul>
                    </div>

                    <div class="slds-grid slds-gutters slds-m-bottom_medium">
                        <div class="slds-col slds-size_1-of-2">
                            <p class="slds-text-body_regular">
                                <strong>Current Key Personnel Count: {keyPersonnelCount}</strong>
                            </p>
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-text-align_right">
                            <lightning-button
                                label="Add Key Personnel"
                                variant="brand"
                                onclick={handleAddKeyPersonnel}>
                            </lightning-button>
                        </div>
                    </div>

                    <template for:each={keyPersonnelList} for:item="personnel" for:index="index">
                        <div key={personnel.id} class="slds-card slds-m-bottom_large">
                            <div class="slds-card__header">
                                <div class="slds-media slds-media_center">
                                    <div class="slds-media__body">
                                        <h3 class="slds-card__header-title">Key Personnel {personnel.displayIndex}</h3>
                                    </div>
                                    <div class="slds-media__figure slds-media__figure_reverse">
                                        <template if:true={personnel.canDelete}>
                                            <lightning-button
                                                label="Remove"
                                                variant="destructive-text"
                                                data-personnel-id={personnel.id}
                                                onclick={handleRemoveKeyPersonnel}>
                                            </lightning-button>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-card__body slds-p-around_medium">
                                <div class="slds-grid slds-wrap slds-gutters">
                                    <div class="slds-col slds-size_1-of-6">
                                        <lightning-combobox
                                            label="Title"
                                            value={personnel.title}
                                            options={titleOptions}
                                            data-personnel-id={personnel.id}
                                            data-field="title"
                                            onchange={handleKeyPersonnelFieldChange}>
                                        </lightning-combobox>
                                    </div>
                                    <div class="slds-col slds-size_5-of-6">
                                        <lightning-input
                                            label="First and Last Name"
                                            value={personnel.fullName}
                                            data-personnel-id={personnel.id}
                                            data-field="fullName"
                                            onchange={handleKeyPersonnelFieldChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Former Name (as applicable)"
                                            value={personnel.formerName}
                                            data-personnel-id={personnel.id}
                                            data-field="formerName"
                                            onchange={handleKeyPersonnelFieldChange}>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Preferred Name"
                                            value={personnel.preferredName}
                                            data-personnel-id={personnel.id}
                                            data-field="preferredName"
                                            onchange={handleKeyPersonnelFieldChange}>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Date of Birth"
                                            type="date"
                                            value={personnel.dateOfBirth}
                                            data-personnel-id={personnel.id}
                                            data-field="dateOfBirth"
                                            onchange={handleKeyPersonnelFieldChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Position Title"
                                            value={personnel.positionTitle}
                                            data-personnel-id={personnel.id}
                                            data-field="positionTitle"
                                            onchange={handleKeyPersonnelFieldChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Contact Email Address"
                                            type="email"
                                            value={personnel.email}
                                            data-personnel-id={personnel.id}
                                            data-field="email"
                                            onchange={handleKeyPersonnelFieldChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input
                                            label="Contact Phone Number - Mobile"
                                            type="tel"
                                            value={personnel.mobile}
                                            data-personnel-id={personnel.id}
                                            data-field="mobile"
                                            onchange={handleKeyPersonnelFieldChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-textarea
                                            label="Principal Duties of Position"
                                            value={personnel.principalDuties}
                                            data-personnel-id={personnel.id}
                                            data-field="principalDuties"
                                            onchange={handleKeyPersonnelFieldChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                </div>

                                <div class="slds-section slds-is-open slds-m-top_large">
                                    <h4 class="slds-section__title">
                                        <span class="slds-text-heading_small">Required Documents</span>
                                    </h4>
                                    <div class="slds-section__content slds-p-top_medium">
                                        <div class="slds-grid slds-wrap slds-gutters">
                                            <div class="slds-col slds-size_1-of-3">
                                                <lightning-input
                                                    type="checkbox"
                                                    label="NPC or NCHC or NDIS worker screening check attached"
                                                    checked={personnel.policeCheckAttached}
                                                    data-personnel-id={personnel.id}
                                                    data-field="policeCheckAttached"
                                                    onchange={handleKeyPersonnelFieldChange}>
                                                </lightning-input>
                                            </div>
                                            <div class="slds-col slds-size_1-of-3">
                                                <lightning-input
                                                    type="checkbox"
                                                    label="Insolvency check attached"
                                                    checked={personnel.insolvencyCheckAttached}
                                                    data-personnel-id={personnel.id}
                                                    data-field="insolvencyCheckAttached"
                                                    onchange={handleKeyPersonnelFieldChange}>
                                                </lightning-input>
                                            </div>
                                            <div class="slds-col slds-size_1-of-3">
                                                <lightning-input
                                                    type="checkbox"
                                                    label="Statutory declaration attached"
                                                    checked={personnel.statutoryDeclarationAttached}
                                                    data-personnel-id={personnel.id}
                                                    data-field="statutoryDeclarationAttached"
                                                    onchange={handleKeyPersonnelFieldChange}>
                                                </lightning-input>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="slds-section slds-is-open slds-m-top_large">
                                    <h4 class="slds-section__title">
                                        <span class="slds-text-heading_small">Key Personnel Declaration</span>
                                    </h4>
                                    <div class="slds-section__content slds-p-top_medium">
                                        <div class="slds-box slds-theme_shade slds-m-bottom_medium">
                                            <p class="slds-text-body_small">I declare that I:</p>
                                            <ol class="slds-list_ordered slds-text-body_small slds-m-top_small">
                                                <li>am aware that any approval as an approved provider must be revoked if false or misleading information is provided</li>
                                                <li>understand that providing false or misleading information is a serious offence</li>
                                                <li>have read and confirm that the information provided about me is true and correct</li>
                                                <li>am aware that this declaration covers all information provided about me and my role as key personnel</li>
                                                <li>consent to the Commissioner obtaining information from other organisations</li>
                                                <li>have read and understood the Commission's Privacy Policy</li>
                                                <li>understand the suitability matters and that the Commission can determine I am unsuitable</li>
                                                <li>understand my responsibilities to notify the approved provider within 14 days of changes</li>
                                                <li>understand that the Commission will examine its own records in relation to this application</li>
                                            </ol>
                                        </div>
                                        <div class="slds-grid slds-gutters">
                                            <div class="slds-col slds-size_1-of-2">
                                                <lightning-input
                                                    type="checkbox"
                                                    label="I acknowledge and agree to the declaration above"
                                                    checked={personnel.declarationAcknowledged}
                                                    data-personnel-id={personnel.id}
                                                    data-field="declarationAcknowledged"
                                                    onchange={handleKeyPersonnelFieldChange}
                                                    required>
                                                </lightning-input>
                                            </div>
                                            <div class="slds-col slds-size_1-of-2">
                                                <lightning-input
                                                    label="Date"
                                                    type="date"
                                                    value={personnel.declarationDate}
                                                    data-personnel-id={personnel.id}
                                                    data-field="declarationDate"
                                                    onchange={handleKeyPersonnelFieldChange}
                                                    required>
                                                </lightning-input>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </template>

            <!-- Page 4: Suitability Assessment -->
            <template if:true={isPage4}>
                <div class="page-content">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Suitability Assessment</h2>
                    
                    <div class="slds-section slds-is-open">
                        <h3 class="slds-section__title slds-theme_shade">
                            <span class="slds-text-heading_small slds-p-horizontal_small">Experience, Conduct and Compliance</span>
                        </h3>
                        <div class="slds-section__content slds-p-around_medium">
                            <div class="slds-m-bottom_large">
                                <lightning-textarea
                                    label="Describe your organisation's current experience in the delivery of aged care, or if you have no aged care experience, describe your experience delivering other care relevant to the care type you are applying for"
                                    value={experienceDescription}
                                    onchange={handleExperienceDescriptionChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_large">
                                <h4 class="slds-text-heading_small slds-m-bottom_medium">Services Provided</h4>
                                <p class="slds-text-body_regular slds-m-bottom_small">
                                    Provide details of the services you provide or have provided. Each item must clearly identify the date commenced/ceased, number of people served, and current service recipients.
                                </p>
                                <div class="slds-grid slds-gutters slds-m-bottom_medium">
                                    <div class="slds-col slds-size_1-of-3">
                                        <lightning-input
                                            label="Service Delivered"
                                            value={serviceDelivered}
                                            onchange={handleServiceDeliveredChange}
                                            placeholder="e.g., transport, personal care">
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-3">
                                        <lightning-input
                                            label="Period of Delivery"
                                            value={servicePeriod}
                                            onchange={handleServicePeriodChange}
                                            placeholder="e.g., 01/01/2021 to current">
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-3">
                                        <lightning-input
                                            label="Number of Care Recipients"
                                            type="number"
                                            value={serviceRecipients}
                                            onchange={handleServiceRecipientsChange}>
                                        </lightning-input>
                                    </div>
                                </div>
                            </div>

                            <div class="slds-m-bottom_large">
                                <lightning-textarea
                                    label="Explain how your organisation's board members and/or senior management's experience and expertise is relevant to having oversight and responsibility for decisions about the delivery of aged care"
                                    value={boardExperienceDescription}
                                    onchange={handleBoardExperienceDescriptionChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_large">
                                <lightning-radio-group
                                    label="Have any of your key personnel/senior management owned or co-owned, or held a company Director/Secretary role with, any company that has been de-registered by ASIC?"
                                    options={yesNoOptions}
                                    value={hasDeregisteredCompany}
                                    onchange={handleHasDeregisteredCompanyChange}
                                    required>
                                </lightning-radio-group>
                                <template if:true={showDeregisteredCompanyDetails}>
                                    <div class="slds-m-top_medium">
                                        <lightning-textarea
                                            label="Please provide details including an explanation about why the company was de-registered"
                                            value={deregisteredCompanyDetails}
                                            onchange={handleDeregisteredCompanyDetailsChange}
                                            required>
                                        </lightning-textarea>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <div class="slds-section slds-is-open slds-m-top_large">
                        <h3 class="slds-section__title slds-theme_shade">
                            <span class="slds-text-heading_small slds-p-horizontal_small">Governance Systems</span>
                        </h3>
                        <div class="slds-section__content slds-p-around_medium">
                            <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-bottom_large" role="alert">
                                <p>Your governance systems are the foundation of your organisation and should be appropriately planned for, managed, and monitored. The responses you give below must adequately describe your organisational governance systems.</p>
                            </div>

                            <lightning-accordion allow-multiple-sections-open>
                                <lightning-accordion-section name="information-management" label="Information Management">
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="Detail your current or proposed information management systems, including electronic and off-line systems"
                                                value={infoManagementSystems}
                                                onchange={handleInfoManagementSystemsChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="Provide an overview of supporting policies, procedures and forms/tools that underpin your systems"
                                                value={infoManagementPolicies}
                                                onchange={handleInfoManagementPoliciesChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="What specific aged care regulatory requirements does this comply with and why is it compliant?"
                                                value={infoManagementCompliance}
                                                onchange={handleInfoManagementComplianceChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="Who in the organisation is/will be responsible for the development, implementation, and maintenance of the systems?"
                                                value={infoManagementResponsible}
                                                onchange={handleInfoManagementResponsibleChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                    </div>
                                </lightning-accordion-section>

                                <lightning-accordion-section name="continuous-improvement" label="Continuous Improvement">
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="Detail your current or proposed continuous improvement system"
                                                value={continuousImprovementSystem}
                                                onchange={handleContinuousImprovementSystemChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="Provide an overview of supporting policies, procedures and forms/tools that underpin your systems"
                                                value={continuousImprovementPolicies}
                                                onchange={handleContinuousImprovementPoliciesChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="What specific aged care regulatory requirements does this comply with and why is it compliant?"
                                                value={continuousImprovementCompliance}
                                                onchange={handleContinuousImprovementComplianceChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="Who in the organisation is/will be responsible for the development, implementation, and maintenance of the system?"
                                                value={continuousImprovementResponsible}
                                                onchange={handleContinuousImprovementResponsibleChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                    </div>
                                </lightning-accordion-section>

                                <lightning-accordion-section name="financial-governance" label="Financial Governance">
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="Detail your current or proposed financial governance system, including electronic or off-line systems"
                                                value={financialGovernanceSystem}
                                                onchange={handleFinancialGovernanceSystemChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="Provide an overview of supporting policies, procedures and forms that underpin your system"
                                                value={financialGovernancePolicies}
                                                onchange={handleFinancialGovernancePoliciesChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="What specific aged care regulatory requirements does this comply with and why is it compliant?"
                                                value={financialGovernanceCompliance}
                                                onchange={handleFinancialGovernanceComplianceChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-textarea
                                                label="Who in the organisation is/will be responsible for the development, implementation, and maintenance of the system?"
                                                value={financialGovernanceResponsible}
                                                onchange={handleFinancialGovernanceResponsibleChange}
                                                required>
                                            </lightning-textarea>
                                        </div>
                                    </div>
                                </lightning-accordion-section>
                            </lightning-accordion>
                        </div>
                    </div>

                    <div class="slds-section slds-is-open slds-m-top_large">
                        <h3 class="slds-section__title slds-theme_shade">
                            <span class="slds-text-heading_small slds-p-horizontal_small">Financial Management</span>
                        </h3>
                        <div class="slds-section__content slds-p-around_medium">
                            <div class="slds-m-bottom_large">
                                <lightning-textarea
                                    label="Provide a detailed description of the policies and procedures you have in place or will develop, implement, and monitor to ensure sound financial management"
                                    value={financialManagementDescription}
                                    onchange={handleFinancialManagementDescriptionChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_large">
                                <lightning-textarea
                                    label="Describe your financial management strategy and detail how you plan to become and remain financially viable"
                                    value={financialStrategy}
                                    onchange={handleFinancialStrategyChange}
                                    required>
                                </lightning-textarea>
                            </div>

                            <div class="slds-m-bottom_large">
                                <h4 class="slds-text-heading_small slds-m-bottom_medium">Financial Management Staff</h4>
                                <p class="slds-text-body_regular slds-m-bottom_small">
                                    List your staff who are/will be responsible for all aspects of financial management.
                                </p>
                                <div class="slds-grid slds-gutters slds-m-bottom_medium">
                                    <div class="slds-col slds-size_2-of-3">
                                        <lightning-input
                                            label="First and Last Name"
                                            value={financialStaffName}
                                            onchange={handleFinancialStaffNameChange}>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-3">
                                        <lightning-radio-group
                                            label="Is this person key personnel?"
                                            options={yesNoOptions}
                                            value={isFinancialStaffKeyPersonnel}
                                            onchange={handleIsFinancialStaffKeyPersonnelChange}>
                                        </lightning-radio-group>
                                    </div>
                                </div>
                            </div>

                            <div class="slds-m-bottom_large">
                                <lightning-textarea
                                    label="To demonstrate your methods of sound financial management and financial capacity, explain the actual financial capital of your organisation"
                                    value={financialCapitalDescription}
                                    onchange={handleFinancialCapitalDescriptionChange}
                                    required>
                                </lightning-textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Page 5: Care Type Specific -->
            <template if:true={isPage5}>
                <div class="page-content">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Care Type Specific Requirements</h2>
                    
                    <template if:true={showResidentialCare}>
                        <div class="slds-section slds-is-open">
                            <h3 class="slds-section__title slds-theme_shade">
                                <span class="slds-text-heading_small slds-p-horizontal_small">Residential Care</span>
                            </h3>
                            <div class="slds-section__content slds-p-around_medium">
                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Describe what systems, policies, or procedures you have/will develop, implement, and monitor to ensure you comply with the Prudential Standards"
                                        value={residentialPrudentialStandards}
                                        onchange={handleResidentialPrudentialStandardsChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Describe what reporting procedures and mechanisms you have or will implement to ensure key personnel responsible for executive decisions can effectively manage, monitor, and control the use of refundable deposits"
                                        value={residentialRefundableDeposits}
                                        onchange={handleResidentialRefundableDepositsChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Describe how you will finance the purchase, construction and/or lease of a residential aged care facility and describe the associated risks"
                                        value={residentialFinancing}
                                        onchange={handleResidentialFinancingChange}
                                        required>
                                    </lightning-textarea></div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Describe the responsibilities of an approved provider of residential care under section 54-1(1)(f) of the Aged Care Act and the Aged Care Quality of Care Principles as it relates to the use of restrictive practices"
                                        value={residentialRestrictivePractices}
                                        onchange={handleResidentialRestrictivePracticesChange}
                                        required>
                                    </lightning-textarea>
                                </div>
                            </div>
                        </div>
                    </template>

                    <template if:true={showHomeCare}>
                        <div class="slds-section slds-is-open">
                            <h3 class="slds-section__title slds-theme_shade">
                                <span class="slds-text-heading_small slds-p-horizontal_small">Home Care</span>
                            </h3>
                            <div class="slds-section__content slds-p-around_medium">
                                <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-bottom_large" role="alert">
                                    <p>When an organisation is approved to provide home care, the approval is effective from the date of the approval and it can start receiving referrals and delivering home care packages within a short period of time.</p>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Detail the systems, policies, or procedures you have/will develop, implement and monitor to deliver home care from referral to delivery"
                                        value={homeCareDeliverySystem}
                                        onchange={handleHomeCareDeliverySystemChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="What tools or methods will you implement to accurately capture care recipient current and future health status and ensure that relevant persons in your workforce are kept informed"
                                        value={homeCareHealthTracking}
                                        onchange={handleHomeCareHealthTrackingChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Describe the system that you will use to operationalise the delivery of care and services to care recipients in their home on a day-to-day basis"
                                        value={homeCareDailyOperations}
                                        onchange={handleHomeCareDailyOperationsChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Detail the systems, policies, or procedures you have/will develop, implement, and monitor to manage medication correctly and safely"
                                        value={homeCareMedicationManagement}
                                        onchange={handleHomeCareMedicationManagementChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Describe how you will provide choice and flexibility of care to care recipients in their home care package"
                                        value={homeCareChoiceFlexibility}
                                        onchange={handleHomeCareChoiceFlexibilityChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Describe how you will meet your obligations and responsibilities to ensure the portability of the care recipient's home care package"
                                        value={homeCarePortability}
                                        onchange={handleHomeCarePortabilityChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Detail the systems, policies, or procedures you have/will develop, implement, and monitor, to manage individual care recipients' fees, individualised budgets, monthly statements, invoicing and subsidies received"
                                        value={homeCareFinancialManagement}
                                        onchange={handleHomeCareFinancialManagementChange}
                                        required>
                                    </lightning-textarea>
                                </div>
                            </div>
                        </div>
                    </template>

                    <template if:true={showFlexibleCare}>
                        <div class="slds-section slds-is-open">
                            <h3 class="slds-section__title slds-theme_shade">
                                <span class="slds-text-heading_small slds-p-horizontal_small">Flexible Care</span>
                            </h3>
                            <div class="slds-section__content slds-p-around_medium">
                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Describe from an experience perspective, how is flexible care to be provided: Restorative care that would meet the objectives of delivering flexible care in the form of short-term restorative care; and/or Other kinds of flexible care"
                                        value={flexibleCareExperience}
                                        onchange={handleFlexibleCareExperienceChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Describe what policies, procedures, or forms you have or will develop, implement and monitor to effectively deliver short-term restorative care"
                                        value={flexibleCareRestorativePolicies}
                                        onchange={handleFlexibleCareRestorativePoliciesChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Describe what you will do to provide statements to care recipients for the services you will deliver through the program"
                                        value={flexibleCareStatements}
                                        onchange={handleFlexibleCareStatementsChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-m-bottom_large">
                                    <lightning-textarea
                                        label="Describe the responsibilities of an approved provider in relation to the concept of multi-disciplinary teams in the delivery of flexible care"
                                        value={flexibleCareMultiDisciplinary}
                                        onchange={handleFlexibleCareMultiDisciplinaryChange}
                                        required>
                                    </lightning-textarea>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </template>

            <!-- Error Messages -->
            <template if:true={hasErrors}>
                <div class="slds-notify slds-notify_alert slds-theme_error slds-theme_alert-texture slds-m-top_medium" role="alert">
                    <h3 class="slds-text-heading_small">Please correct the following errors:</h3>
                    <ul class="slds-list_dotted slds-m-top_small">
                        <template for:each={errorMessages} for:item="error">
                            <li key={error}>{error}</li>
                        </template>
                    </ul>
                </div>
            </template>
        </div>

        <!-- Navigation Footer -->
        <div class="slds-card__footer slds-border_top">
            <div class="slds-grid slds-grid_align-spread">
                <div class="slds-col">
                    <template if:false={isFirstPage}>
                        <lightning-button
                            label="Previous"
                            variant="neutral"
                            onclick={handlePrevious}>
                        </lightning-button>
                    </template>
                    <template if:true={isFirstPage}>
                        <lightning-button
                            label="Cancel"
                            variant="neutral"
                            onclick={handleCancel}>
                        </lightning-button>
                    </template>
                </div>
                <div class="slds-col slds-text-align_right">
                    <lightning-button
                        label="Save Draft"
                        variant="neutral"
                        onclick={handleSaveDraft}
                        class="slds-m-right_small">
                    </lightning-button>
                    <template if:false={isLastPage}>
                        <lightning-button
                            label="Next"
                            variant="brand"
                            onclick={handleNext}>
                        </lightning-button>
                    </template>
                    <template if:true={isLastPage}>
                        <lightning-button
                            label="Submit Application"
                            variant="brand"
                            onclick={handleSubmit}>
                        </lightning-button>
                    </template>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
        </template>
    </div>
</template>
