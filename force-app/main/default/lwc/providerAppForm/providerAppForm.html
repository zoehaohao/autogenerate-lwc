<template>
    <div class="slds-card">
        <div class="slds-card__header">
            <h1 class="slds-text-heading_large slds-m-bottom_medium">Healthcare Provider Application Form</h1>
            <p class="slds-text-body_regular slds-text-color_weak">
                Complete all sections to submit your provider application. All fields marked with * are required.
            </p>
        </div>

        <!-- Progress Indicator -->
        <div class="slds-card__body slds-p-horizontal_large">
            <lightning-progress-indicator 
                current-step={currentPageString}
                type="path"
                variant="base">
                <lightning-progress-step 
                    label="Personal Information" 
                    value="1">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Contact Details" 
                    value="2">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Professional Information" 
                    value="3">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Additional Information" 
                    value="4">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Review & Submit" 
                    value="5">
                </lightning-progress-step>
            </lightning-progress-indicator>

            <!-- Loading Spinner -->
            <template if:true={isLoading}>
                <lightning-spinner 
                    alternative-text="Loading..." 
                    size="medium">
                </lightning-spinner>
            </template>

            <!-- Error Messages -->
            <template if:true={hasErrors}>
                <div class="slds-notify slds-notify_alert slds-theme_error slds-theme_alert-texture slds-m-bottom_medium" role="alert">
                    <h2 class="slds-text-heading_small">Please correct the following errors:</h2>
                    <ul class="slds-list_dotted slds-m-top_small">
                        <template for:each={errorMessages} for:item="error">
                            <li key={error} class="slds-text-body_small">{error}</li>
                        </template>
                    </ul>
                </div>
            </template>

            <!-- Page 1: Personal Information -->
            <template if:true={isPage1}>
                <div class="form-page">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Personal Information</h2>
                    <p class="slds-text-body_regular slds-m-bottom_large slds-text-color_weak">
                        Please provide your personal details exactly as they appear on your government-issued identification.
                    </p>

                    <div class="slds-grid slds-wrap slds-gutters">
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="First Name"
                                value={firstName}
                                onchange={handleInputChange}
                                data-field="firstName"
                                required
                                class={firstNameClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Middle Name"
                                value={middleName}
                                onchange={handleInputChange}
                                data-field="middleName">
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Last Name"
                                value={lastName}
                                onchange={handleInputChange}
                                data-field="lastName"
                                required
                                class={lastNameClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Suffix"
                                value={suffix}
                                onchange={handleInputChange}
                                data-field="suffix"
                                placeholder="Jr., Sr., III, etc.">
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Date of Birth"
                                type="date"
                                value={dateOfBirth}
                                onchange={handleInputChange}
                                data-field="dateOfBirth"
                                required
                                max={maxBirthDate}
                                class={dateOfBirthClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-combobox
                                label="Gender"
                                value={gender}
                                options={genderOptions}
                                onchange={handleInputChange}
                                data-field="gender"
                                required
                                placeholder="Select Gender"
                                class={genderClass}>
                            </lightning-combobox>
                        </div>
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-input
                                label="Social Security Number"
                                type="password"
                                value={ssn}
                                onchange={handleInputChange}
                                data-field="ssn"
                                required
                                field-level-help="Enter your 9-digit SSN. This information is encrypted and secure."
                                maxlength="11"
                                class={ssnClass}>
                            </lightning-input>
                        </div>
                    </div>

                    <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-top_medium" role="alert">
                        <h2 class="slds-text-heading_small">Privacy Notice</h2>
                        <p class="slds-text-body_small">All personal information is protected under HIPAA regulations and will be kept strictly confidential.</p>
                    </div>
                </div>
            </template>

            <!-- Page 2: Contact Details -->
            <template if:true={isPage2}>
                <div class="form-page">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Contact Details</h2>
                    <p class="slds-text-body_regular slds-m-bottom_large slds-text-color_weak">
                        Provide current contact information where you can be reached for application updates and correspondence.
                    </p>

                    <div class="slds-grid slds-wrap slds-gutters">
                        <div class="slds-col slds-size_1-of-1">
                            <h3 class="slds-text-heading_small slds-m-bottom_small">Primary Address</h3>
                        </div>
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-input
                                label="Street Address"
                                value={streetAddress}
                                onchange={handleInputChange}
                                data-field="streetAddress"
                                required
                                class={streetAddressClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="City"
                                value={city}
                                onchange={handleInputChange}
                                data-field="city"
                                required
                                class={cityClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-4">
                            <lightning-combobox
                                label="State"
                                value={state}
                                options={stateOptions}
                                onchange={handleInputChange}
                                data-field="state"
                                required
                                placeholder="Select State"
                                class={stateClass}>
                            </lightning-combobox>
                        </div>
                        <div class="slds-col slds-size_1-of-4">
                            <lightning-input
                                label="ZIP Code"
                                value={zipCode}
                                onchange={handleInputChange}
                                data-field="zipCode"
                                required
                                maxlength="10"
                                class={zipCodeClass}>
                            </lightning-input>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-1 slds-m-top_medium">
                            <h3 class="slds-text-heading_small slds-m-bottom_small">Contact Information</h3>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Primary Phone"
                                type="tel"
                                value={primaryPhone}
                                onchange={handleInputChange}
                                data-field="primaryPhone"
                                required
                                field-level-help="Enter 10-digit phone number"
                                class={primaryPhoneClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Secondary Phone"
                                type="tel"
                                value={secondaryPhone}
                                onchange={handleInputChange}
                                data-field="secondaryPhone">
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Email Address"
                                type="email"
                                value={email}
                                onchange={handleInputChange}
                                data-field="email"
                                required
                                class={emailClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Confirm Email Address"
                                type="email"
                                value={confirmEmail}
                                onchange={handleInputChange}
                                data-field="confirmEmail"
                                required
                                class={confirmEmailClass}>
                            </lightning-input>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Page 3: Professional Information -->
            <template if:true={isPage3}>
                <div class="form-page">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Professional Information</h2>
                    <p class="slds-text-body_regular slds-m-bottom_large slds-text-color_weak">
                        Provide details about your medical education, training, and professional credentials.
                    </p>

                    <div class="slds-grid slds-wrap slds-gutters">
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-combobox
                                label="Provider Type"
                                value={providerType}
                                options={providerTypeOptions}
                                onchange={handleInputChange}
                                data-field="providerType"
                                required
                                placeholder="Select Provider Type"
                                class={providerTypeClass}>
                            </lightning-combobox>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-combobox
                                label="Specialty"
                                value={specialty}
                                options={specialtyOptions}
                                onchange={handleInputChange}
                                data-field="specialty"
                                required
                                placeholder="Select Primary Specialty"
                                class={specialtyClass}>
                            </lightning-combobox>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Medical License Number"
                                value={licenseNumber}
                                onchange={handleInputChange}
                                data-field="licenseNumber"
                                required
                                class={licenseNumberClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-combobox
                                label="License State"
                                value={licenseState}
                                options={stateOptions}
                                onchange={handleInputChange}
                                data-field="licenseState"
                                required
                                placeholder="Select License State"
                                class={licenseStateClass}>
                            </lightning-combobox>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="License Expiration Date"
                                type="date"
                                value={licenseExpiration}
                                onchange={handleInputChange}
                                data-field="licenseExpiration"
                                required
                                min={todayDate}
                                class={licenseExpirationClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="DEA Number"
                                value={deaNumber}
                                onchange={handleInputChange}
                                data-field="deaNumber"
                                field-level-help="Required if prescribing controlled substances">
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="NPI Number"
                                value={npiNumber}
                                onchange={handleInputChange}
                                data-field="npiNumber"
                                required
                                maxlength="10"
                                field-level-help="10-digit National Provider Identifier"
                                class={npiNumberClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Years of Experience"
                                type="number"
                                value={yearsExperience}
                                onchange={handleInputChange}
                                data-field="yearsExperience"
                                required
                                min="0"
                                max="60"
                                class={yearsExperienceClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-input
                                label="Medical School"
                                value={medicalSchool}
                                onchange={handleInputChange}
                                data-field="medicalSchool"
                                required
                                class={medicalSchoolClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Graduation Year"
                                type="number"
                                value={graduationYear}
                                onchange={handleInputChange}
                                data-field="graduationYear"
                                required
                                min="1950"
                                max={currentYear}
                                class={graduationYearClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Residency Program"
                                value={residencyProgram}
                                onchange={handleInputChange}
                                data-field="residencyProgram"
                                required
                                class={residencyProgramClass}>
                            </lightning-input>
                        </div>
                    </div>

                    <div class="slds-notify slds-notify_alert slds-theme_warning slds-theme_alert-texture slds-m-top_medium" role="alert">
                        <h2 class="slds-text-heading_small">Important</h2>
                        <p class="slds-text-body_small">All professional credentials will be verified through primary sources. Ensure all information is accurate and current.</p>
                    </div>
                </div>
            </template>

            <!-- Page 4: Additional Information -->
            <template if:true={isPage4}>
                <div class="form-page">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Additional Information</h2>
                    <p class="slds-text-body_regular slds-m-bottom_large slds-text-color_weak">
                        Please provide additional details about your practice and any relevant background information.
                    </p>

                    <div class="slds-grid slds-wrap slds-gutters">
                        <div class="slds-col slds-size_1-of-1">
                            <h3 class="slds-text-heading_small slds-m-bottom_small">Practice Information</h3>
                        </div>
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-input
                                label="Practice/Hospital Name"
                                value={practiceName}
                                onchange={handleInputChange}
                                data-field="practiceName"
                                required
                                class={practiceNameClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-input
                                label="Practice Address"
                                value={practiceAddress}
                                onchange={handleInputChange}
                                data-field="practiceAddress"
                                required
                                class={practiceAddressClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Practice Phone"
                                type="tel"
                                value={practicePhone}
                                onchange={handleInputChange}
                                data-field="practicePhone"
                                required
                                class={practicePhoneClass}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                                label="Practice Fax"
                                type="tel"
                                value={practiceFax}
                                onchange={handleInputChange}
                                data-field="practiceFax">
                            </lightning-input>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-1 slds-m-top_medium">
                            <h3 class="slds-text-heading_small slds-m-bottom_small">Background Questions</h3>
                            <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                                Please answer all questions truthfully. Any false statements may result in application denial.
                            </p>
                        </div>
                        
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-radio-group
                                label="Have you ever had your medical license suspended, revoked, or restricted?"
                                options={yesNoOptions}
                                value={licenseDiscipline}
                                onchange={handleInputChange}
                                data-field="licenseDiscipline"
                                required
                                class={licenseDisciplineClass}>
                            </lightning-radio-group>
                        </div>
                        
                        <template if:true={showDisciplineDetails}>
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-textarea
                                    label="Please provide details"
                                    value={disciplineDetails}
                                    onchange={handleInputChange}
                                    data-field="disciplineDetails"
                                    required
                                    maxlength="1000"
                                    class={disciplineDetailsClass}>
                                </lightning-textarea>
                            </div>
                        </template>
                        
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-radio-group
                                label="Have you ever been convicted of a felony?"
                                options={yesNoOptions}
                                value={felonyConviction}
                                onchange={handleInputChange}
                                data-field="felonyConviction"
                                required
                                class={felonyConvictionClass}>
                            </lightning-radio-group>
                        </div>
                        
                        <template if:true={showFelonyDetails}>
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-textarea
                                    label="Please provide details"
                                    value={felonyDetails}
                                    onchange={handleInputChange}
                                    data-field="felonyDetails"
                                    required
                                    maxlength="1000"
                                    class={felonyDetailsClass}>
                                </lightning-textarea>
                            </div>
                        </template>
                        
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-radio-group
                                label="Do you have malpractice insurance?"
                                options={yesNoOptions}
                                value={malpracticeInsurance}
                                onchange={handleInputChange}
                                data-field="malpracticeInsurance"
                                required
                                class={malpracticeInsuranceClass}>
                            </lightning-radio-group>
                        </div>
                        
                        <template if:true={showInsuranceDetails}>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input
                                    label="Insurance Carrier"
                                    value={insuranceCarrier}
                                    onchange={handleInputChange}
                                    data-field="insuranceCarrier"
                                    required
                                    class={insuranceCarrierClass}>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input
                                    label="Policy Number"
                                    value={policyNumber}
                                    onchange={handleInputChange}
                                    data-field="policyNumber"
                                    required
                                    class={policyNumberClass}>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input
                                    label="Coverage Amount"
                                    value={coverageAmount}
                                    onchange={handleInputChange}
                                    data-field="coverageAmount"
                                    required
                                    class={coverageAmountClass}>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input
                                    label="Policy Expiration Date"
                                    type="date"
                                    value={policyExpiration}
                                    onchange={handleInputChange}
                                    data-field="policyExpiration"
                                    required
                                    min={todayDate}
                                    class={policyExpirationClass}>
                                </lightning-input>
                            </div>
                        </template>
                        
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-textarea
                                label="Additional Comments or Information"
                                value={additionalComments}
                                onchange={handleInputChange}
                                data-field="additionalComments"
                                maxlength="2000"
                                field-level-help="Optional: Provide any additional information relevant to your application">
                            </lightning-textarea>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Page 5: Review & Submit -->
            <template if:true={isPage5}>
                <div class="form-page">
                    <h2 class="slds-text-heading_medium slds-m-bottom_medium">Review & Submit</h2>
                    <p class="slds-text-body_regular slds-m-bottom_large slds-text-color_weak">
                        Please review all information before submitting your application. You can go back to previous sections to make changes.
                    </p>

                    <lightning-accordion allow-multiple-sections-open>
                        <lightning-accordion-section name="personal" label="Personal Information">
                            <div class="slds-grid slds-wrap slds-gutters_small">
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>Name:</strong> {fullName}
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>Date of Birth:</strong> {formattedDateOfBirth}
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>Gender:</strong> {gender}
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>SSN:</strong> ***-**-{ssnLast4}
                                </div>
                            </div>
                        </lightning-accordion-section>
                        
                        <lightning-accordion-section name="contact" label="Contact Details">
                            <div class="slds-grid slds-wrap slds-gutters_small">
                                <div class="slds-col slds-size_1-of-1">
                                    <strong>Address:</strong> {fullAddress}
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>Primary Phone:</strong> {formattedPrimaryPhone}
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>Email:</strong> {email}
                                </div>
                            </div>
                        </lightning-accordion-section>
                        
                        <lightning-accordion-section name="professional" label="Professional Information">
                            <div class="slds-grid slds-wrap slds-gutters_small">
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>Provider Type:</strong> {providerType}
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>Specialty:</strong> {specialty}
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>License Number:</strong> {licenseNumber}
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>NPI Number:</strong> {npiNumber}
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>Medical School:</strong> {medicalSchool}
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>Years of Experience:</strong> {yearsExperience}
                                </div>
                            </div>
                        </lightning-accordion-section>
                        
                        <lightning-accordion-section name="additional" label="Additional Information">
                            <div class="slds-grid slds-wrap slds-gutters_small">
                                <div class="slds-col slds-size_1-of-1">
                                    <strong>Practice Name:</strong> {practiceName}
                                </div>
                                <div class="slds-col slds-size_1-of-1">
                                    <strong>Practice Address:</strong> {practiceAddress}
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <strong>Malpractice Insurance:</strong> {malpracticeInsurance}
                                </div>
                            </div>
                        </lightning-accordion-section>
                    </lightning-accordion>

                    <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-top_large" role="alert">
                        <h2 class="slds-text-heading_small">Certification and Agreement</h2>
                        <p class="slds-text-body_small">
                            By submitting this application, I certify that all information provided is true and accurate to the best of my knowledge. 
                            I understand that any false statements may result in denial of my application or termination of provider status.
                        </p>
                    </div>

                    <div class="slds-m-top_medium">
                        <lightning-input
                            type="checkbox"
                            label="I agree to the terms and conditions and certify that all information is accurate"
                            checked={agreementAccepted}
                            onchange={handleInputChange}
                            data-field="agreementAccepted"
                            required
                            class={agreementAcceptedClass}>
                        </lightning-input>
                    </div>
                </div>
            </template>

            <!-- Navigation Buttons -->
            <div class="slds-m-top_large slds-p-top_medium slds-border_top">
                <div class="slds-grid slds-grid_align-spread">
                    <div class="slds-col">
                        <template if:false={isFirstPage}>
                            <lightning-button
                                label="Previous"
                                onclick={handlePrevious}
                                variant="neutral"
                                class="slds-m-right_small">
                            </lightning-button>
                        </template>
                        <lightning-button
                            label="Cancel"
                            onclick={handleCancel}
                            variant="neutral">
                        </lightning-button>
                    </div>
                    <div class="slds-col">
                        <template if:false={isLastPage}>
                            <lightning-button
                                label="Next"
                                onclick={handleNext}
                                variant="brand">
                            </lightning-button>
                        </template>
                        <template if:true={isLastPage}>
                            <lightning-button
                                label="Submit Application"
                                onclick={handleSubmit}
                                variant="brand"
                                disabled={submitDisabled}>
                            </lightning-button>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
