<template>
    <div class="slds-card">
        <div class="slds-card__header slds-grid">
            <header class="slds-media slds-media_center slds-has-flexi-truncate">
                <div class="slds-media__body">
                    <h2 class="slds-card__header-title">
                        <span>Application for Approval to Provide Aged Care - New Applicant</span>
                    </h2>
                </div>
            </header>
        </div>
        
        <div class="slds-card__body slds-card__body_inner">
            <!-- Progress Indicator -->
            <lightning-progress-indicator 
                current-step={currentStep} 
                type="path" 
                variant="base">
                <lightning-progress-step label="Key Personnel Declaration" value="step-1"></lightning-progress-step>
                <lightning-progress-step label="Applicant Details" value="step-2"></lightning-progress-step>
                <lightning-progress-step label="Key Personnel Details" value="step-3"></lightning-progress-step>
                <lightning-progress-step label="Suitability Assessment" value="step-4"></lightning-progress-step>
                <lightning-progress-step label="Care Type Specific" value="step-5"></lightning-progress-step>
            </lightning-progress-indicator>

            <!-- Important Information Banner -->
            <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_warning" role="alert">
                <span class="slds-assistive-text">Warning</span>
                <h2>Important Information</h2>
                <p>Before completing this application form, you must understand what it means to be an approved provider. Read the Aged Care Approved Provider Application Guide and ensure you are aware of the responsibilities and obligations.</p>
            </div>

            <!-- Application Form Sections -->
            <lightning-accordion 
                active-section-name={openSections} 
                allow-multiple-sections-open="true"
                onselect={handleAccordionToggle}>

                <!-- Key Personnel Declaration Section -->
                <lightning-accordion-section name="declaration" label="Key Personnel Declaration">
                    <div class="slds-box slds-theme_shade">
                        <h3 class="slds-text-heading_medium slds-m-bottom_medium">Important Information</h3>
                        <p class="slds-m-bottom_medium">Giving false and misleading information is a serious offence. There are offences established by the Commission Act and the Criminal Code Act 1995 (Cth) relating to providing false and misleading information.</p>
                        
                        <div class="slds-form-element slds-m-top_large">
                            <div class="slds-form-element__control">
                                <lightning-checkbox-group 
                                    name="declarationChecks"
                                    label="I/we declare that I/we:"
                                    options={declarationOptions}
                                    value={declarationValues}
                                    onchange={handleDeclarationChange}
                                    required>
                                </lightning-checkbox-group>
                            </div>
                        </div>

                        <div class="slds-grid slds-gutters slds-m-top_large">
                            <div class="slds-col slds-size_1-of-2">
                                <h4 class="slds-text-heading_small">Declaring Officer 1 - Key Personnel</h4>
                                <lightning-input 
                                    label="Name" 
                                    value={officer1Name}
                                    onchange={handleOfficer1NameChange}
                                    required>
                                </lightning-input>
                                <lightning-input 
                                    label="Position" 
                                    value={officer1Position}
                                    onchange={handleOfficer1PositionChange}
                                    required>
                                </lightning-input>
                                <lightning-input 
                                    type="date" 
                                    label="Date" 
                                    value={officer1Date}
                                    onchange={handleOfficer1DateChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <h4 class="slds-text-heading_small">Declaring Officer 2 - Key Personnel</h4>
                                <lightning-input 
                                    label="Name" 
                                    value={officer2Name}
                                    onchange={handleOfficer2NameChange}
                                    required>
                                </lightning-input>
                                <lightning-input 
                                    label="Position" 
                                    value={officer2Position}
                                    onchange={handleOfficer2PositionChange}
                                    required>
                                </lightning-input>
                                <lightning-input 
                                    type="date" 
                                    label="Date" 
                                    value={officer2Date}
                                    onchange={handleOfficer2DateChange}
                                    required>
                                </lightning-input>
                            </div>
                        </div>
                    </div>
                </lightning-accordion-section>

                <!-- About the Applicant Section -->
                <lightning-accordion-section name="applicant" label="About the Applicant">
                    <div class="slds-grid slds-gutters">
                        <div class="slds-col slds-size_1-of-1">
                            <h3 class="slds-text-heading_medium slds-m-bottom_medium">Organisation Details</h3>
                            
                            <lightning-input 
                                label="Applicant's (Company) Legal Name" 
                                value={companyLegalName}
                                onchange={handleCompanyLegalNameChange}
                                required>
                            </lightning-input>
                            
                            <div class="slds-grid slds-gutters slds-m-top_medium">
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-input 
                                        label="Applicant's (Company) ACN, IAN or ICN" 
                                        value={companyACN}
                                        onchange={handleCompanyACNChange}
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-input 
                                        label="Applicant's (Company) ABN" 
                                        value={companyABN}
                                        onchange={handleCompanyABNChange}
                                        required>
                                    </lightning-input>
                                </div>
                            </div>
                            
                            <lightning-input 
                                label="Business Name (if applicable)" 
                                value={businessName}
                                onchange={handleBusinessNameChange}
                                class="slds-m-top_medium">
                            </lightning-input>
                        </div>
                    </div>

                    <!-- Registered Business Address -->
                    <div class="slds-m-top_large">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Registered Business Address</h4>
                        <lightning-input 
                            label="Street number and name (must be the registered physical address of the organisation)" 
                            value={registeredStreet}
                            onchange={handleRegisteredStreetChange}
                            required>
                        </lightning-input>
                        
                        <div class="slds-grid slds-gutters slds-m-top_medium">
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-input 
                                    label="Suburb/Town" 
                                    value={registeredSuburb}
                                    onchange={handleRegisteredSuburbChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-combobox 
                                    label="State/Territory" 
                                    value={registeredState}
                                    options={stateOptions}
                                    onchange={handleRegisteredStateChange}
                                    required>
                                </lightning-combobox>
                            </div>
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-input 
                                    label="Postcode" 
                                    value={registeredPostcode}
                                    onchange={handleRegisteredPostcodeChange}
                                    required>
                                </lightning-input>
                            </div>
                        </div>
                    </div>

                    <!-- Postal Address -->
                    <div class="slds-m-top_large">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Postal Address</h4>
                        <lightning-input 
                            type="checkbox" 
                            label="As above" 
                            checked={postalSameAsRegistered}
                            onchange={handlePostalSameChange}>
                        </lightning-input>
                        
                        <div if:false={postalSameAsRegistered}>
                            <lightning-input 
                                label="Street number and name/PO Box" 
                                value={postalStreet}
                                onchange={handlePostalStreetChange}
                                class="slds-m-top_medium">
                            </lightning-input>
                            
                            <div class="slds-grid slds-gutters slds-m-top_medium">
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-input 
                                        label="Suburb/Town" 
                                        value={postalSuburb}
                                        onchange={handlePostalSuburbChange}>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-combobox 
                                        label="State/Territory" 
                                        value={postalState}
                                        options={stateOptions}
                                        onchange={handlePostalStateChange}>
                                    </lightning-combobox>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-input 
                                        label="Postcode" 
                                        value={postalPostcode}
                                        onchange={handlePostalPostcodeChange}>
                                    </lightning-input>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Person Details -->
                    <div class="slds-m-top_large">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Authorised Contact Person Details</h4>
                        <p class="slds-m-bottom_medium">The contact person(s) listed below must be key personnel and have knowledge of this applications content.</p>
                        
                        <div class="slds-grid slds-gutters">
                            <div class="slds-col slds-size_1-of-2">
                                <h5 class="slds-text-heading_small">Primary Contact</h5>
                                <lightning-input 
                                    label="Full Name" 
                                    value={primaryContactName}
                                    onchange={handlePrimaryContactNameChange}
                                    required>
                                </lightning-input>
                                <lightning-input 
                                    label="Position Held" 
                                    value={primaryContactPosition}
                                    onchange={handlePrimaryContactPositionChange}
                                    required>
                                </lightning-input>
                                <lightning-input 
                                    label="Telephone (incl area code)" 
                                    type="tel"
                                    value={primaryContactPhone}
                                    onchange={handlePrimaryContactPhoneChange}
                                    required>
                                </lightning-input>
                                <lightning-input 
                                    label="Mobile" 
                                    type="tel"
                                    value={primaryContactMobile}
                                    onchange={handlePrimaryContactMobileChange}>
                                </lightning-input>
                                <lightning-input 
                                    label="Email address" 
                                    type="email"
                                    value={primaryContactEmail}
                                    onchange={handlePrimaryContactEmailChange}
                                    required>
                                </lightning-input>
                                <lightning-input 
                                    label="Best day and time to make contact" 
                                    value={primaryContactBestTime}
                                    onchange={handlePrimaryContactBestTimeChange}>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <h5 class="slds-text-heading_small">Alternative Contact</h5>
                                <lightning-input 
                                    label="Full Name" 
                                    value={altContactName}
                                    onchange={handleAltContactNameChange}>
                                </lightning-input>
                                <lightning-input 
                                    label="Position Held" 
                                    value={altContactPosition}
                                    onchange={handleAltContactPositionChange}>
                                </lightning-input>
                                <lightning-input 
                                    label="Telephone (incl area code)" 
                                    type="tel"
                                    value={altContactPhone}
                                    onchange={handleAltContactPhoneChange}>
                                </lightning-input>
                                <lightning-input 
                                    label="Mobile" 
                                    type="tel"
                                    value={altContactMobile}
                                    onchange={handleAltContactMobileChange}>
                                </lightning-input>
                                <lightning-input 
                                    label="Email address" 
                                    type="email"
                                    value={altContactEmail}
                                    onchange={handleAltContactEmailChange}>
                                </lightning-input>
                                <lightning-input 
                                    label="Best day and time to make contact" 
                                    value={altContactBestTime}
                                    onchange={handleAltContactBestTimeChange}>
                                </lightning-input>
                            </div>
                        </div>
                    </div>

                    <!-- Care Type Selection -->
                    <div class="slds-m-top_large">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Care type you are applying for</h4>
                        <p class="slds-m-bottom_medium">Select the type(s) of care for which approval is sought. All applicants must complete Sections 2 and 3 of this application form, regardless of the type of care being applied for.</p>
                        
                        <lightning-checkbox-group 
                            name="careTypes"
                            options={careTypeOptions}
                            value={selectedCareTypes}
                            onchange={handleCareTypeChange}
                            required>
                        </lightning-checkbox-group>
                    </div>

                    <!-- Organisation Type -->
                    <div class="slds-m-top_large">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Organisation Type</h4>
                        <p class="slds-m-bottom_medium">You must provide a response to the two questions below which are used for statistical purposes and do not affect the assessment of this application.</p>
                        
                        <lightning-radio-group 
                            name="orgType"
                            label="What is your organisation type?"
                            options={orgTypeOptions}
                            value={selectedOrgType}
                            onchange={handleOrgTypeChange}
                            required>
                        </lightning-radio-group>

                        <div if:true={showNotForProfitOptions}>
                            <lightning-checkbox-group 
                                name="notForProfitType"
                                label="Not-For-Profit - select one of the following:"
                                options={notForProfitOptions}
                                value={selectedNotForProfitType}
                                onchange={handleNotForProfitTypeChange}>
                            </lightning-checkbox-group>
                        </div>

                        <lightning-radio-group 
                            name="stockExchange"
                            label="Is your organisation or its parent body listed on the Australian Stock Exchange?"
                            options={yesNoOptions}
                            value={isListedOnASX}
                            onchange={handleASXListingChange}
                            required>
                        </lightning-radio-group>
                    </div>
                </lightning-accordion-section>

                <!-- Key Personnel Details Section -->
                <lightning-accordion-section name="keypersonnel" label="Key Personnel Details">
                    <div class="slds-notify slds-notify_alert slds-theme_info" role="alert">
                        <h4>Key Personnel Requirements</h4>
                        <p>Your application will be invalid and returned to you if you do not complete all key personnel fields, have each key personnel sign their individual details, and submit required documentation.</p>
                    </div>

                    <!-- Key Personnel Table -->
                    <div class="slds-m-top_large">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Key Personnel Information</h4>
                        <lightning-datatable
                            key-field="id"
                            data={keyPersonnelData}
                            columns={keyPersonnelColumns}
                            oncellchange={handleKeyPersonnelCellChange}
                            draft-values={keyPersonnelDraftValues}
                            onsave={handleKeyPersonnelSave}
                            oncancel={handleKeyPersonnelCancel}>
                        </lightning-datatable>
                        
                        <lightning-button 
                            label="Add Key Personnel" 
                            onclick={handleAddKeyPersonnel}
                            variant="brand"
                            class="slds-m-top_medium">
                        </lightning-button>
                    </div>

                    <!-- Key Personnel Individual Details -->
                    <div class="slds-m-top_large" if:true={showKeyPersonnelDetails}>
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Key Personnel Individual Details</h4>
                        
                        <div class="slds-grid slds-gutters">
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-combobox 
                                    label="Title" 
                                    value={selectedPersonnelTitle}
                                    options={titleOptions}
                                    onchange={handlePersonnelTitleChange}>
                                </lightning-combobox>
                            </div>
                            <div class="slds-col slds-size_2-of-3">
                                <lightning-input 
                                    label="First and Last Name" 
                                    value={personnelFullName}
                                    onchange={handlePersonnelFullNameChange}
                                    required>
                                </lightning-input>
                            </div>
                        </div>

                        <div class="slds-grid slds-gutters slds-m-top_medium">
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input 
                                    label="Former Name (as applicable)" 
                                    value={personnelFormerName}
                                    onchange={handlePersonnelFormerNameChange}>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input 
                                    label="Preferred Name" 
                                    value={personnelPreferredName}
                                    onchange={handlePersonnelPreferredNameChange}>
                                </lightning-input>
                            </div>
                        </div>

                        <div class="slds-grid slds-gutters slds-m-top_medium">
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input 
                                    type="date"
                                    label="Date of Birth" 
                                    value={personnelDOB}
                                    onchange={handlePersonnelDOBChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input 
                                    label="Position title" 
                                    value={personnelPositionTitle}
                                    onchange={handlePersonnelPositionTitleChange}
                                    required>
                                </lightning-input>
                            </div>
                        </div>

                        <lightning-textarea 
                            label="Principal duties of position" 
                            value={personnelDuties}
                            onchange={handlePersonnelDutiesChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <!-- Qualifications Section -->
                        <div class="slds-m-top_large">
                            <h5 class="slds-text-heading_small slds-m-bottom_medium">Qualifications</h5>
                            <lightning-datatable
                                key-field="id"
                                data={qualificationsData}
                                columns={qualificationsColumns}
                                oncellchange={handleQualificationsCellChange}>
                            </lightning-datatable>
                            <lightning-button 
                                label="Add Qualification" 
                                onclick={handleAddQualification}
                                variant="neutral"
                                class="slds-m-top_small">
                            </lightning-button>
                        </div>

                        <!-- Experience Section -->
                        <div class="slds-m-top_large">
                            <h5 class="slds-text-heading_small slds-m-bottom_medium">Experience</h5>
                            <lightning-datatable
                                key-field="id"
                                data={experienceData}
                                columns={experienceColumns}
                                oncellchange={handleExperienceCellChange}>
                            </lightning-datatable>
                            <lightning-button 
                                label="Add Experience" 
                                onclick={handleAddExperience}
                                variant="neutral"
                                class="slds-m-top_small">
                            </lightning-button>
                        </div>
                    </div>
                </lightning-accordion-section>

                <!-- Suitability Assessment Section -->
                <lightning-accordion-section name="suitability" label="Suitability Assessment">
                    <div class="slds-m-bottom_medium">
                        <h3 class="slds-text-heading_medium">Your suitability to be an approved provider</h3>
                        <p>Section 63D of the Commission Act requires certain matters to be considered when deciding whether an applicant is suitable to provide aged care.</p>
                    </div>

                    <!-- Experience Section -->
                    <div class="slds-m-top_large">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Experience, conduct and compliance as a provider of aged care or other relevant care</h4>
                        
                        <lightning-textarea 
                            label="Describe your organisation's current experience in the delivery of aged care, or if you have no aged care experience, describe your experience delivering other care relevant to the care type you are applying for." 
                            value={organisationExperience}
                            onchange={handleOrganisationExperienceChange}
                            required>
                        </lightning-textarea>

                        <!-- Services Provided Table -->
                        <div class="slds-m-top_medium">
                            <h5 class="slds-text-heading_small slds-m-bottom_small">Services Provided</h5>
                            <lightning-datatable
                                key-field="id"
                                data={servicesProvidedData}
                                columns={servicesProvidedColumns}
                                oncellchange={handleServicesProvidedCellChange}>
                            </lightning-datatable>
                            <lightning-button 
                                label="Add Service" 
                                onclick={handleAddService}
                                variant="neutral"
                                class="slds-m-top_small">
                            </lightning-button>
                        </div>

                        <lightning-textarea 
                            label="Explain how your organisation's board members and/or senior management's experience and expertise is relevant to having oversight and responsibility for decisions about the delivery of aged care on a day-to-day basis" 
                            value={boardExperience}
                            onchange={handleBoardExperienceChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-radio-group 
                            name="deregisteredCompany"
                            label="Have any of your key personnel/senior management owned or co-owned (full or part shareholder), or held a company Director/Secretary role with, any company that has been de-registered by ASIC?"
                            options={yesNoOptions}
                            value={hasDeregisteredCompany}
                            onchange={handleDeregisteredCompanyChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-radio-group>

                        <div if:true={showDeregisteredDetails}>
                            <lightning-textarea 
                                label="Please provide details including an explanation about why the company was de-registered" 
                                value={deregisteredDetails}
                                onchange={handleDeregisteredDetailsChange}
                                required>
                            </lightning-textarea>
                        </div>
                    </div>

                    <!-- Governance Systems -->
                    <div class="slds-m-top_large">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Governance Systems</h4>
                        
                        <lightning-textarea 
                            label="Information management - Detail your current or proposed information management systems" 
                            value={informationManagement}
                            onchange={handleInformationManagementChange}
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Continuous improvement - Detail your current or proposed continuous improvement system" 
                            value={continuousImprovement}
                            onchange={handleContinuousImprovementChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Financial governance - Detail your current or proposed financial governance system" 
                            value={financialGovernance}
                            onchange={handleFinancialGovernanceChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Workforce governance - Detail your current or proposed workforce governance system" 
                            value={workforceGovernance}
                            onchange={handleWorkforceGovernanceChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Risk and incident management - What is your current or proposed risk management and incident management system" 
                            value={riskManagement}
                            onchange={handleRiskManagementChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Clinical governance - What is your current or proposed clinical governance system" 
                            value={clinicalGovernance}
                            onchange={handleClinicalGovernanceChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>
                    </div>

                    <!-- Financial Management -->
                    <div class="slds-m-top_large">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Financial Management</h4>
                        
                        <lightning-textarea 
                            label="Provide a detailed description of the policies and procedures you have in place or will develop to ensure sound financial management" 
                            value={financialManagementPolicies}
                            onchange={handleFinancialManagementPoliciesChange}
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe your financial management strategy and detail how you plan to become and remain financially viable" 
                            value={financialStrategy}
                            onchange={handleFinancialStrategyChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <!-- Financial Staff Table -->
                        <div class="slds-m-top_medium">
                            <h5 class="slds-text-heading_small slds-m-bottom_small">Staff responsible for financial management</h5>
                            <lightning-datatable
                                key-field="id"
                                data={financialStaffData}
                                columns={financialStaffColumns}
                                oncellchange={handleFinancialStaffCellChange}>
                            </lightning-datatable>
                            <lightning-button 
                                label="Add Financial Staff" 
                                onclick={handleAddFinancialStaff}
                                variant="neutral"
                                class="slds-m-top_small">
                            </lightning-button>
                        </div>
                    </div>
                </lightning-accordion-section>

                <!-- Care Type Specific Section -->
                <lightning-accordion-section name="caretype" label="Care Type Specific Requirements">
                    <!-- Residential Care -->
                    <div if:true={showResidentialCare}>
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Residential Care Requirements</h4>
                        
                        <lightning-textarea 
                            label="Describe what systems, policies, or procedures you have/will develop to ensure you comply with the Prudential Standards" 
                            value={prudentialStandards}
                            onchange={handlePrudentialStandardsChange}
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe what reporting procedures and mechanisms you have or will implement to manage refundable deposits" 
                            value={refundableDeposits}
                            onchange={handleRefundableDepositsChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe how you will finance the purchase, construction and/or lease of a residential aged care facility" 
                            value={facilityFinancing}
                            onchange={handleFacilityFinancingChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe the responsibilities of an approved provider of residential care in relation to the use of restrictive practices" 
                            value={restrictivePractices}
                            onchange={handleRestrictivePracticesChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>
                    </div>

                    <!-- Home Care -->
                    <div if:true={showHomeCare}>
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Home Care Requirements</h4>
                        
                        <lightning-textarea 
                            label="Detail the systems, policies, or procedures you have/will develop to deliver home care from referral to delivery" 
                            value={homeCareDelivery}
                            onchange={handleHomeCareDeliveryChange}
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="What tools or methods will you implement to accurately capture care recipient current and future health status" 
                            value={healthStatusCapture}
                            onchange={handleHealthStatusCaptureChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe the system that you will use to operationalise the delivery of care and services to care recipients in their home" 
                            value={homeCareOperationalisation}
                            onchange={handleHomeCareOperationalisationChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Detail the systems for managing medication correctly and safely" 
                            value={medicationManagement}
                            onchange={handleMedicationManagementChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe how you will provide choice and flexibility of care to care recipients in their home care package" 
                            value={careChoiceFlexibility}
                            onchange={handleCareChoiceFlexibilityChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe how you will meet your obligations for portability of the care recipient's home care package" 
                            value={packagePortability}
                            onchange={handlePackagePortabilityChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>
                    </div>

                    <!-- Flexible Care -->
                    <div if:true={showFlexibleCare}>
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Flexible Care Requirements</h4>
                        
                        <lightning-textarea 
                            label="Describe from an experience perspective, how flexible care is to be provided" 
                            value={flexibleCareExperience}
                            onchange={handleFlexibleCareExperienceChange}
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe what policies, procedures, or forms you have or will develop for short-term restorative care" 
                            value={restorativeCare}
                            onchange={handleRestorativeCareChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe the responsibilities in relation to multi-disciplinary teams in the delivery of flexible care" 
                            value={multiDisciplinaryTeams}
                            onchange={handleMultiDisciplinaryTeamsChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>
                    </div>
                </lightning-accordion-section>
            </lightning-accordion>

            <!-- Form Actions -->
            <div class="slds-docked-form-footer">
                <div class="slds-grid slds-grid_align-spread">
                    <lightning-button 
                        label="Save Draft" 
                        onclick={handleSaveDraft}
                        variant="neutral"
                        disabled={isLoading}>
                    </lightning-button>
                    <div class="slds-grid slds-gutters_small">
                        <lightning-button 
                            label="Previous" 
                            onclick={handlePrevious}
                            variant="neutral"
                            disabled={isPreviousDisabled}>
                        </lightning-button>
                        <lightning-button 
                            label="Next" 
                            onclick={handleNext}
                            variant="brand"
                            disabled={isNextDisabled}>
                        </lightning-button>
                        <lightning-button 
                            label="Submit Application" 
                            onclick={handleSubmit}
                            variant="brand"
                            disabled={isSubmitDisabled}
                            class="slds-m-left_small">
                        </lightning-button>
                    </div>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div if:true={isLoading} class="slds-spinner_container">
                <lightning-spinner 
                    alternative-text="Loading" 
                    size="medium">
                </lightning-spinner>
            </div>
        </div>
    </div>
</template>
