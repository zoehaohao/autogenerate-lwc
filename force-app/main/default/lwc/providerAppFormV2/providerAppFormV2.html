<template>
    <div class="slds-card">
        <!-- Header -->
        <div class="slds-card__header slds-border_bottom">
            <h1 class="slds-text-heading_large slds-text-align_center">
                Application for Approval to Provide Aged Care - New Applicant
            </h1>
            <p class="slds-text-body_regular slds-text-align_center slds-m-top_small">
                This application form is approved under Subsection 63B(2) of the Aged Care Quality and Safety Commission Act 2018
            </p>
        </div>

        <!-- Progress Indicator -->
        <div class="slds-card__body slds-p-horizontal_large slds-p-vertical_medium">
            <lightning-progress-indicator 
                current-step={currentPageString}
                type="path"
                variant="base">
                <lightning-progress-step 
                    label="Key Personnel Declaration" 
                    value="1">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="About the Applicant" 
                    value="2">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Key Personnel Details" 
                    value="3">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Suitability Assessment" 
                    value="4">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Care Type Specific" 
                    value="5">
                </lightning-progress-step>
            </lightning-progress-indicator>
        </div>

        <!-- Page 1: Key Personnel Declaration -->
        <div if:true={isPage1} class="slds-card__body slds-p-horizontal_large">
            <h2 class="slds-text-heading_medium slds-m-bottom_medium">Key Personnel Declaration</h2>
            
            <div class="slds-notify slds-notify_alert slds-theme_warning slds-theme_alert-texture slds-m-bottom_medium" role="alert">
                <h3 class="slds-text-heading_small">Important Information</h3>
                <p class="slds-text-body_regular">
                    Only persons who are lawfully authorised to act on behalf of/represent the organisation 
                    (for instance, to enter into contracts) can sign this application form.
                </p>
                <p class="slds-text-body_regular slds-m-top_small">
                    Giving false and misleading information is a serious offence. There are offences established 
                    by the Commission Act and the Criminal Code Act 1995 (Cth) relating to providing false and misleading information.
                </p>
            </div>

            <div class="slds-box slds-theme_shade slds-m-bottom_large">
                <h3 class="slds-text-heading_small slds-m-bottom_medium">Key Personnel Declaration</h3>
                <p class="slds-text-body_regular slds-m-bottom_small">I/we declare that I/we:</p>
                
                <div class="slds-form-element slds-m-bottom_small">
                    <lightning-input 
                        type="checkbox" 
                        label="1. are aware that, under section 63J(1)(c) of the Commission Act, if the Commissioner is satisfied that the application contained information that was false or misleading in a material particular, any approval as an approved provider must be revoked."
                        value={declaration.point1}
                        onchange={handleDeclarationChange}
                        data-field="point1"
                        required>
                    </lightning-input>
                </div>

                <div class="slds-form-element slds-m-bottom_small">
                    <lightning-input 
                        type="checkbox" 
                        label="2. understand that Chapter 2 and section 137.1 of the Criminal Code applies to offences against the Commission Act. Providing false or misleading information in this application is a serious offence."
                        value={declaration.point2}
                        onchange={handleDeclarationChange}
                        data-field="point2"
                        required>
                    </lightning-input>
                </div>

                <div class="slds-form-element slds-m-bottom_small">
                    <lightning-input 
                        type="checkbox" 
                        label="3. have provided true and accurate information in this application form."
                        value={declaration.point3}
                        onchange={handleDeclarationChange}
                        data-field="point3"
                        required>
                    </lightning-input>
                </div>

                <div class="slds-form-element slds-m-bottom_small">
                    <lightning-input 
                        type="checkbox" 
                        label="4. understand that the application form must be signed by persons lawfully authorised to act on behalf of/represent the organisation."
                        value={declaration.point4}
                        onchange={handleDeclarationChange}
                        data-field="point4"
                        required>
                    </lightning-input>
                </div>

                <div class="slds-form-element slds-m-bottom_small">
                    <lightning-input 
                        type="checkbox" 
                        label="5. consent to the Commissioner obtaining information and documents from other persons or organisations to assist in assessing this application."
                        value={declaration.point5}
                        onchange={handleDeclarationChange}
                        data-field="point5"
                        required>
                    </lightning-input>
                </div>
            </div>

            <div class="slds-grid slds-grid_align-spread slds-wrap">
                <div class="slds-col slds-size_1-of-2 slds-p-right_small">
                    <h4 class="slds-text-heading_small slds-m-bottom_small">Declaring Officer 1 – Key Personnel</h4>
                    <lightning-input 
                        label="Name" 
                        value={declaringOfficer1.name}
                        onchange={handleDeclaringOfficer1Change}
                        data-field="name"
                        required>
                    </lightning-input>
                    <lightning-input 
                        label="Position" 
                        value={declaringOfficer1.position}
                        onchange={handleDeclaringOfficer1Change}
                        data-field="position"
                        required>
                    </lightning-input>
                    <lightning-input 
                        label="Date" 
                        type="date"
                        value={declaringOfficer1.date}
                        onchange={handleDeclaringOfficer1Change}
                        data-field="date"
                        required>
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-left_small">
                    <h4 class="slds-text-heading_small slds-m-bottom_small">Declaring Officer 2 – Key Personnel</h4>
                    <lightning-input 
                        label="Name" 
                        value={declaringOfficer2.name}
                        onchange={handleDeclaringOfficer2Change}
                        data-field="name">
                    </lightning-input>
                    <lightning-input 
                        label="Position" 
                        value={declaringOfficer2.position}
                        onchange={handleDeclaringOfficer2Change}
                        data-field="position">
                    </lightning-input>
                    <lightning-input 
                        label="Date" 
                        type="date"
                        value={declaringOfficer2.date}
                        onchange={handleDeclaringOfficer2Change}
                        data-field="date">
                    </lightning-input>
                </div>
            </div>

            <!-- Navigation -->
            <div class="slds-m-top_large slds-text-align_right">
                <lightning-button 
                    label="Cancel" 
                    variant="neutral" 
                    onclick={handleCancel}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button 
                    label="Next" 
                    variant="brand" 
                    onclick={handleNext}>
                </lightning-button>
            </div>
        </div>

        <!-- Page 2: About the Applicant -->
        <div if:true={isPage2} class="slds-card__body slds-p-horizontal_large">
            <h2 class="slds-text-heading_medium slds-m-bottom_medium">1. About the Applicant</h2>

            <div class="slds-section slds-is-open">
                <h3 class="slds-section__title slds-theme_shade">
                    <span class="slds-truncate slds-p-horizontal_small" title="Organisation Details">1.1 Organisation Details</span>
                </h3>
                <div class="slds-section__content">
                    <div class="slds-grid slds-gutters slds-wrap">
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-input 
                                label="Applicant's (Company) Legal Name" 
                                value={applicant.legalName}
                                onchange={handleApplicantChange}
                                data-field="legalName"
                                required>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input 
                                label="Applicant's (Company) ACN, IAN or ICN" 
                                value={applicant.acn}
                                onchange={handleApplicantChange}
                                data-field="acn"
                                required>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <lightning-input 
                                label="Applicant's (Company) ABN" 
                                value={applicant.abn}
                                onchange={handleApplicantChange}
                                data-field="abn"
                                required>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-input 
                                label="Business Name (if applicable)" 
                                value={applicant.businessName}
                                onchange={handleApplicantChange}
                                data-field="businessName">
                            </lightning-input>
                        </div>
                    </div>
                </div>
            </div>

            <div class="slds-section slds-is-open slds-m-top_medium">
                <h3 class="slds-section__title slds-theme_shade">
                    <span class="slds-truncate slds-p-horizontal_small" title="Registered Business Address">1.2 Registered Business Address</span>
                </h3>
                <div class="slds-section__content">
                    <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                        Must be the registered physical address of the organisation
                    </p>
                    <div class="slds-grid slds-gutters slds-wrap">
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-input 
                                label="Street number and name" 
                                value={registeredAddress.street}
                                onchange={handleRegisteredAddressChange}
                                data-field="street"
                                required>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-3">
                            <lightning-input 
                                label="Suburb/Town" 
                                value={registeredAddress.suburb}
                                onchange={handleRegisteredAddressChange}
                                data-field="suburb"
                                required>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-3">
                            <lightning-combobox 
                                label="State/Territory" 
                                value={registeredAddress.state}
                                options={stateOptions}
                                onchange={handleRegisteredAddressChange}
                                data-field="state"
                                required>
                            </lightning-combobox>
                        </div>
                        <div class="slds-col slds-size_1-of-3">
                            <lightning-input 
                                label="Postcode" 
                                value={registeredAddress.postcode}
                                onchange={handleRegisteredAddressChange}
                                data-field="postcode"
                                required>
                            </lightning-input>
                        </div>
                    </div>
                </div>
            </div>

            <div class="slds-section slds-is-open slds-m-top_medium">
                <h3 class="slds-section__title slds-theme_shade">
                    <span class="slds-truncate slds-p-horizontal_small" title="Care Type">1.5 Care Type You Are Applying For</span>
                </h3>
                <div class="slds-section__content">
                    <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                        Select the type(s) of care for which approval is sought.
                    </p>
                    <lightning-checkbox-group 
                        label="Care Types"
                        options={careTypeOptions}
                        value={selectedCareTypes}
                        onchange={handleCareTypeChange}
                        required>
                    </lightning-checkbox-group>
                </div>
            </div>

            <!-- Navigation -->
            <div class="slds-m-top_large slds-text-align_right">
                <lightning-button 
                    label="Previous" 
                    variant="neutral" 
                    onclick={handlePrevious}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button 
                    label="Next" 
                    variant="brand" 
                    onclick={handleNext}>
                </lightning-button>
            </div>
        </div>

        <!-- Page 3: Key Personnel Details -->
        <div if:true={isPage3} class="slds-card__body slds-p-horizontal_large">
            <h2 class="slds-text-heading_medium slds-m-bottom_medium">2. Your Key Personnel</h2>

            <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-bottom_medium" role="alert">
                <h3 class="slds-text-heading_small">Legislation</h3>
                <p class="slds-text-body_regular">
                    Under Part 7A, subsection 63D(2)(c) of the Commission Act, the Commissioner must not approve 
                    a person as a provider of aged care unless the Commissioner is satisfied that each individual 
                    who is one of the key personnel of the person is suitable to be involved in the provision of aged care.
                </p>
            </div>

            <div class="slds-accordion">
                <section class="slds-accordion__section slds-is-open">
                    <div class="slds-accordion__summary">
                        <h3 class="slds-accordion__summary-heading">
                            <span class="slds-accordion__summary-content">Key Personnel 1</span>
                        </h3>
                    </div>
                    <div class="slds-accordion__content">
                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-combobox 
                                    label="Title" 
                                    value={keyPersonnel1.title}
                                    options={titleOptions}
                                    onchange={handleKeyPersonnel1Change}
                                    data-field="title">
                                </lightning-combobox>
                            </div>
                            <div class="slds-col slds-size_2-of-3">
                                <lightning-input 
                                    label="First and Last Name" 
                                    value={keyPersonnel1.name}
                                    onchange={handleKeyPersonnel1Change}
                                    data-field="name"
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input 
                                    label="Former Name (as applicable)" 
                                    value={keyPersonnel1.formerName}
                                    onchange={handleKeyPersonnel1Change}
                                    data-field="formerName">
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input 
                                    label="Preferred Name" 
                                    value={keyPersonnel1.preferredName}
                                    onchange={handleKeyPersonnel1Change}
                                    data-field="preferredName">
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input 
                                    label="Date of Birth" 
                                    type="date"
                                    value={keyPersonnel1.dateOfBirth}
                                    onchange={handleKeyPersonnel1Change}
                                    data-field="dateOfBirth"
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input 
                                    label="Position Title" 
                                    value={keyPersonnel1.position}
                                    onchange={handleKeyPersonnel1Change}
                                    data-field="position"
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input 
                                    label="Contact Email Address" 
                                    type="email"
                                    value={keyPersonnel1.email}
                                    onchange={handleKeyPersonnel1Change}
                                    data-field="email"
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input 
                                    label="Contact Phone Number - Mobile" 
                                    type="tel"
                                    value={keyPersonnel1.mobile}
                                    onchange={handleKeyPersonnel1Change}
                                    data-field="mobile"
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-textarea 
                                    label="Principal Duties of Position" 
                                    value={keyPersonnel1.duties}
                                    onchange={handleKeyPersonnel1Change}
                                    data-field="duties"
                                    required>
                                </lightning-textarea>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Navigation -->
            <div class="slds-m-top_large slds-text-align_right">
                <lightning-button 
                    label="Previous" 
                    variant="neutral" 
                    onclick={handlePrevious}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button 
                    label="Next" 
                    variant="brand" 
                    onclick={handleNext}>
                </lightning-button>
            </div>
        </div>

        <!-- Page 4: Suitability Assessment -->
        <div if:true={isPage4} class="slds-card__body slds-p-horizontal_large">
            <h2 class="slds-text-heading_medium slds-m-bottom_medium">3. Your Suitability to be an Approved Provider</h2>

            <div class="slds-section slds-is-open">
                <h3 class="slds-section__title slds-theme_shade">
                    <span class="slds-truncate slds-p-horizontal_small" title="Experience">3.1 Experience, Conduct and Compliance</span>
                </h3>
                <div class="slds-section__content">
                    <lightning-textarea 
                        label="1) Describe your organisation's current experience in the delivery of aged care, or if you have no aged care experience, describe your experience delivering other care relevant to the care type you are applying for."
                        value={suitability.experience}
                        onchange={handleSuitabilityChange}
                        data-field="experience"
                        required>
                    </lightning-textarea>

                    <div class="slds-m-top_medium">
                        <label class="slds-form-element__label">2) Provide details of the services you provide or have provided:</label>
                        <div class="slds-grid slds-gutters slds-wrap slds-m-top_small">
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-input 
                                    label="Service Delivered" 
                                    value={serviceDetails.service}
                                    onchange={handleServiceDetailsChange}
                                    data-field="service">
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-input 
                                    label="Period of Delivery" 
                                    value={serviceDetails.period}
                                    onchange={handleServiceDetailsChange}
                                    data-field="period">
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-input 
                                    label="Number of Care Recipients" 
                                    type="number"
                                    value={serviceDetails.recipients}
                                    onchange={handleServiceDetailsChange}
                                    data-field="recipients">
                                </lightning-input>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="slds-section slds-is-open slds-m-top_medium">
                <h3 class="slds-section__title slds-theme_shade">
                    <span class="slds-truncate slds-p-horizontal_small" title="Financial Management">3.3 Financial Management</span>
                </h3>
                <div class="slds-section__content">
                    <lightning-textarea 
                        label="1) Provide a detailed description of the policies and procedures you have in place or will develop, implement, and monitor to ensure sound financial management"
                        value={suitability.financialPolicies}
                        onchange={handleSuitabilityChange}
                        data-field="financialPolicies"
                        required>
                    </lightning-textarea>

                    <lightning-textarea 
                        label="a) Describe your financial management strategy and detail how you plan to become and remain financially viable"
                        value={suitability.financialStrategy}
                        onchange={handleSuitabilityChange}
                        data-field="financialStrategy"
                        required
                        class="slds-m-top_small">
                    </lightning-textarea>
                </div>
            </div>

            <!-- Navigation -->
            <div class="slds-m-top_large slds-text-align_right">
                <lightning-button 
                    label="Previous" 
                    variant="neutral" 
                    onclick={handlePrevious}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button 
                    label="Next" 
                    variant="brand" 
                    onclick={handleNext}>
                </lightning-button>
            </div>
        </div>

        <!-- Page 5: Care Type Specific -->
        <div if:true={isPage5} class="slds-card__body slds-p-horizontal_large">
            <h2 class="slds-text-heading_medium slds-m-bottom_medium">4. Your Ability to Meet Care Type Specific Matters</h2>

            <div if:true={showResidentialCare} class="slds-section slds-is-open">
                <h3 class="slds-section__title slds-theme_shade">
                    <span class="slds-truncate slds-p-horizontal_small" title="Residential Care">4.1 Residential Care</span>
                </h3>
                <div class="slds-section__content">
                    <lightning-textarea 
                        label="1) Describe what systems, policies, or procedures you have/will develop, implement, and monitor to ensure you comply with the Prudential Standards"
                        value={careSpecific.residentialPrudential}
                        onchange={handleCareSpecificChange}
                        data-field="residentialPrudential"
                        required>
                    </lightning-textarea>

                    <lightning-textarea 
                        label="2) Describe what reporting procedures and mechanisms you have or will implement to ensure key personnel responsible for executive decisions can effectively manage, monitor, and control the use of refundable deposits"
                        value={careSpecific.residentialReporting}
                        onchange={handleCareSpecificChange}
                        data-field="residentialReporting"
                        required
                        class="slds-m-top_small">
                    </lightning-textarea>
                </div>
            </div>

            <div if:true={showHomeCare} class="slds-section slds-is-open">
                <h3 class="slds-section__title slds-theme_shade">
                    <span class="slds-truncate slds-p-horizontal_small" title="Home Care">4.2 Home Care</span>
                </h3>
                <div class="slds-section__content">
                    <lightning-textarea 
                        label="1) Detail the systems, policies, or procedures you have/will develop, implement and monitor to deliver home care from referral to delivery"
                        value={careSpecific.homeCareSystems}
                        onchange={handleCareSpecificChange}
                        data-field="homeCareSystems"
                        required>
                    </lightning-textarea>

                    <lightning-textarea 
                        label="2) What tools or methods will you implement to accurately capture care recipient current and future health status"
                        value={careSpecific.homeCareTools}
                        onchange={handleCareSpecificChange}
                        data-field="homeCareTools"
                        required
                        class="slds-m-top_small">
                    </lightning-textarea>
                </div>
            </div>

            <div if:true={showFlexibleCare} class="slds-section slds-is-open">
                <h3 class="slds-section__title slds-theme_shade">
                    <span class="slds-truncate slds-p-horizontal_small" title="Flexible Care">4.3 Flexible Care</span>
                </h3>
                <div class="slds-section__content">
                    <lightning-textarea 
                        label="1) Describe from an experience perspective, how flexible care is to be provided"
                        value={careSpecific.flexibleCareExperience}
                        onchange={handleCareSpecificChange}
                        data-field="flexibleCareExperience"
                        required>
                    </lightning-textarea>

                    <lightning-textarea 
                        label="2) Describe what policies, procedures, or forms you have or will develop, implement and monitor to effectively deliver short-term restorative care"
                        value={careSpecific.flexibleCarePolicies}
                        onchange={handleCareSpecificChange}
                        data-field="flexibleCarePolicies"
                        required
                        class="slds-m-top_small">
                    </lightning-textarea>
                </div>
            </div>

            <!-- Navigation -->
            <div class="slds-m-top_large slds-text-align_right">
                <lightning-button 
                    label="Previous" 
                    variant="neutral" 
                    onclick={handlePrevious}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button 
                    label="Submit Application" 
                    variant="brand" 
                    onclick={handleSubmit}>
                </lightning-button>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div if:true={isLoading} class="slds-spinner_container">
            <div role="status" class="slds-spinner slds-spinner_medium">
                <span class="slds-assistive-text">Loading</span>
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
            </div>
        </div>

        <!-- Error Messages -->
        <div if:true={hasErrors} class="slds-notify slds-notify_alert slds-theme_error slds-theme_alert-texture slds-m-top_medium" role="alert">
            <h2 class="slds-text-heading_small">Please correct the following errors:</h2>
            <ul class="slds-list_dotted">
                <template for:each={errorMessages} for:item="error">
                    <li key={error}>{error}</li>
                </template>
            </ul>
        </div>
    </div>
</template>
