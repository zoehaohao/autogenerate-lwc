<template>
    <div class="slds-card">
        <!-- Header -->
        <div class="slds-card__header slds-border_bottom">
            <div class="slds-media slds-media_center">
                <div class="slds-media__body">
                    <h2 class="slds-card__header-title slds-text-heading_medium">
                        Application for Approval to Provide Aged Care - New Applicant
                    </h2>
                </div>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="slds-card__body slds-p-horizontal_large slds-p-top_medium">
            <lightning-progress-indicator 
                current-step={currentPageString}
                type="path"
                variant="base">
                <lightning-progress-step 
                    label="Key Personnel Declaration" 
                    value="1">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Applicant Details" 
                    value="2">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Key Personnel Details" 
                    value="3">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Suitability Assessment" 
                    value="4">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Care Type Specific" 
                    value="5">
                </lightning-progress-step>
            </lightning-progress-indicator>
        </div>

        <!-- Loading Spinner -->
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
        </template>

        <!-- Error Messages -->
        <template if:true={hasErrors}>
            <div class="slds-notify slds-notify_alert slds-theme_error slds-m-around_medium" role="alert">
                <h2 class="slds-text-heading_small">Please correct the following errors:</h2>
                <ul class="slds-list_dotted slds-m-top_small">
                    <template for:each={errorMessages} for:item="error">
                        <li key={error}>{error}</li>
                    </template>
                </ul>
            </div>
        </template>

        <!-- Page 1: Key Personnel Declaration -->
        <template if:true={isPage1}>
            <div class="slds-card__body slds-p-around_large">
                <h3 class="slds-text-heading_medium slds-m-bottom_medium">Key Personnel Declaration</h3>
                
                <div class="slds-notify slds-notify_alert slds-theme_warning slds-m-bottom_large" role="alert">
                    <h2 class="slds-text-heading_small">Important Information</h2>
                    <p class="slds-m-top_small">
                        Giving false and misleading information is a serious offence. There are offences established by the Commission Act and the Criminal Code Act 1995 (Cth) (Criminal Code) relating to providing false and misleading information.
                    </p>
                </div>

                <div class="slds-text-longform slds-m-bottom_large">
                    <p class="slds-m-bottom_medium">
                        Only persons who are lawfully authorised to act on behalf of/represent the organisation (for instance, to enter into contracts) can sign this application form.
                    </p>
                    <p class="slds-m-bottom_medium">
                        I/we declare that I/we:
                    </p>
                </div>

                <div class="slds-form-element slds-m-bottom_medium">
                    <lightning-checkbox-group 
                        name="declarations"
                        label="Key Personnel Declarations (All must be acknowledged)"
                        options={declarationOptions}
                        value={selectedDeclarations}
                        onchange={handleDeclarationChange}
                        required>
                    </lightning-checkbox-group>
                </div>

                <div class="slds-grid slds-grid_align-spread slds-wrap slds-m-top_large">
                    <div class="slds-col slds-size_1-of-2 slds-p-right_medium">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Declaring Officer 1 - Key Personnel</h4>
                        <lightning-input
                            label="Name"
                            type="text"
                            value={officer1Name}
                            onchange={handleOfficer1NameChange}
                            required>
                        </lightning-input>
                        <lightning-input
                            label="Position"
                            type="text"
                            value={officer1Position}
                            onchange={handleOfficer1PositionChange}
                            required
                            class="slds-m-top_small">
                        </lightning-input>
                        <lightning-input
                            label="Date"
                            type="date"
                            value={officer1Date}
                            onchange={handleOfficer1DateChange}
                            required
                            class="slds-m-top_small">
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-left_medium">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Declaring Officer 2 - Key Personnel</h4>
                        <lightning-input
                            label="Name"
                            type="text"
                            value={officer2Name}
                            onchange={handleOfficer2NameChange}>
                        </lightning-input>
                        <lightning-input
                            label="Position"
                            type="text"
                            value={officer2Position}
                            onchange={handleOfficer2PositionChange}
                            class="slds-m-top_small">
                        </lightning-input>
                        <lightning-input
                            label="Date"
                            type="date"
                            value={officer2Date}
                            onchange={handleOfficer2DateChange}
                            class="slds-m-top_small">
                        </lightning-input>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="slds-grid slds-grid_align-spread slds-m-top_x-large">
                    <lightning-button
                        label="Cancel"
                        variant="neutral"
                        onclick={handleCancel}>
                    </lightning-button>
                    <lightning-button
                        label="Next"
                        variant="brand"
                        onclick={handleNext}>
                    </lightning-button>
                </div>
            </div>
        </template>

        <!-- Page 2: Applicant Details -->
        <template if:true={isPage2}>
            <div class="slds-card__body slds-p-around_large">
                <h3 class="slds-text-heading_medium slds-m-bottom_medium">About the Applicant</h3>
                
                <div class="slds-section slds-is-open">
                    <h4 class="slds-section__title slds-text-heading_small">Organisation Details</h4>
                    <div class="slds-section__content">
                        <div class="slds-grid slds-wrap slds-gutters">
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-input
                                    label="Applicant's (Company) Legal Name"
                                    type="text"
                                    value={companyLegalName}
                                    onchange={handleCompanyLegalNameChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input
                                    label="Applicant's (Company) ACN, IAN or ICN"
                                    type="text"
                                    value={companyACN}
                                    onchange={handleCompanyACNChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-input
                                    label="Applicant's (Company) ABN"
                                    type="text"
                                    value={companyABN}
                                    onchange={handleCompanyABNChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-input
                                    label="Business Name (if applicable)"
                                    type="text"
                                    value={businessName}
                                    onchange={handleBusinessNameChange}>
                                </lightning-input>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="slds-section slds-is-open slds-m-top_large">
                    <h4 class="slds-section__title slds-text-heading_small">Registered Business Address</h4>
                    <div class="slds-section__content">
                        <div class="slds-grid slds-wrap slds-gutters">
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-input
                                    label="Street number and name (must be the registered physical address of the organisation)"
                                    type="text"
                                    value={registeredStreetAddress}
                                    onchange={handleRegisteredStreetAddressChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-input
                                    label="Suburb/Town"
                                    type="text"
                                    value={registeredSuburb}
                                    onchange={handleRegisteredSuburbChange}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-combobox
                                    label="State/Territory"
                                    value={registeredState}
                                    options={stateOptions}
                                    onchange={handleRegisteredStateChange}
                                    required>
                                </lightning-combobox>
                            </div>
                            <div class="slds-col slds-size_1-of-3">
                                <lightning-input
                                    label="Postcode"
                                    type="text"
                                    value={registeredPostcode}
                                    onchange={handleRegisteredPostcodeChange}
                                    required>
                                </lightning-input>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="slds-section slds-is-open slds-m-top_large">
                    <h4 class="slds-section__title slds-text-heading_small">Postal Address</h4>
                    <div class="slds-section__content">
                        <div class="slds-form-element slds-m-bottom_medium">
                            <lightning-input
                                type="checkbox"
                                label="Same as registered address"
                                checked={postalSameAsRegistered}
                                onchange={handlePostalSameAsRegisteredChange}>
                            </lightning-input>
                        </div>
                        <template if:false={postalSameAsRegistered}>
                            <div class="slds-grid slds-wrap slds-gutters">
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-input
                                        label="Street number and name/PO Box"
                                        type="text"
                                        value={postalStreetAddress}
                                        onchange={handlePostalStreetAddressChange}>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-input
                                        label="Suburb/Town"
                                        type="text"
                                        value={postalSuburb}
                                        onchange={handlePostalSuburbChange}>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-combobox
                                        label="State/Territory"
                                        value={postalState}
                                        options={stateOptions}
                                        onchange={handlePostalStateChange}>
                                    </lightning-combobox>
                                </div>
                                <div class="slds-col slds-size_1-of-3">
                                    <lightning-input
                                        label="Postcode"
                                        type="text"
                                        value={postalPostcode}
                                        onchange={handlePostalPostcodeChange}>
                                    </lightning-input>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="slds-section slds-is-open slds-m-top_large">
                    <h4 class="slds-section__title slds-text-heading_small">Care Type You Are Applying For</h4>
                    <div class="slds-section__content">
                        <p class="slds-text-body_regular slds-m-bottom_medium">
                            Select the type(s) of care for which approval is sought. All applicants must complete Sections 2 and 3 of this application form, regardless of the type of care being applied for.
                        </p>
                        <lightning-checkbox-group
                            name="careTypes"
                            label="Care Types"
                            options={careTypeOptions}
                            value={selectedCareTypes}
                            onchange={handleCareTypeChange}
                            required>
                        </lightning-checkbox-group>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="slds-grid slds-grid_align-spread slds-m-top_x-large">
                    <lightning-button
                        label="Previous"
                        variant="neutral"
                        onclick={handlePrevious}>
                    </lightning-button>
                    <lightning-button
                        label="Next"
                        variant="brand"
                        onclick={handleNext}>
                    </lightning-button>
                </div>
            </div>
        </template>

        <!-- Page 3: Key Personnel Details -->
        <template if:true={isPage3}>
            <div class="slds-card__body slds-p-around_large">
                <h3 class="slds-text-heading_medium slds-m-bottom_medium">Your Key Personnel</h3>
                
                <div class="slds-notify slds-notify_alert slds-theme_info slds-m-bottom_large" role="alert">
                    <h2 class="slds-text-heading_small">Key Personnel Requirements</h2>
                    <p class="slds-m-top_small">
                        Under Part 7A, subsection 63D(2)(c) of the Commission Act, the Commissioner must not approve a person as a provider of aged care unless the Commissioner is satisfied that each individual who is one of the key personnel of the person is suitable to be involved in the provision of aged care.
                    </p>
                </div>

                <div class="slds-text-longform slds-m-bottom_large">
                    <p class="slds-m-bottom_medium">Key personnel of your organisation include (but may not be limited to):</p>
                    <ul class="slds-list_dotted">
                        <li>Persons who may have authority, responsibilityfor and/or significant influence over decision making (planning, directing or controlling) and the day to day operations of the organisation.</li>
                        <li>Any persons who are, or are likely to be, responsible for the nursing services either provided or to be provided by an aged care service and who holds a recognised nursing qualification.</li>
                        <li>Any person who are, or are likely to be, responsible for the day-to-day operations of the aged care service.</li>
                        <li>Directors, shareholders, or secretaries of the company registered with the Australian Securities and Investment Commission.</li>
                        <li>Persons listed as responsible persons with the Australian Charities and Not-for-Profit Commission.</li>
                    </ul>
                </div>

                <template for:each={keyPersonnelList} for:item="personnel" for:index="index">
                    <div key={personnel.id} class="slds-card slds-m-bottom_large">
                        <div class="slds-card__header">
                            <h4 class="slds-text-heading_small">Key Personnel {personnel.number}</h4>
                        </div>
                        <div class="slds-card__body slds-p-around_medium">
                            <div class="slds-grid slds-wrap slds-gutters">
                                <div class="slds-col slds-size_1-of-4">
                                    <lightning-combobox
                                        label="Title"
                                        value={personnel.title}
                                        options={titleOptions}
                                        data-id={personnel.id}
                                        data-field="title"
                                        onchange={handleKeyPersonnelChange}>
                                    </lightning-combobox>
                                </div>
                                <div class="slds-col slds-size_3-of-4">
                                    <lightning-input
                                        label="First and Last Name"
                                        type="text"
                                        value={personnel.fullName}
                                        data-id={personnel.id}
                                        data-field="fullName"
                                        onchange={handleKeyPersonnelChange}
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-input
                                        label="Former Name (as applicable)"
                                        type="text"
                                        value={personnel.formerName}
                                        data-id={personnel.id}
                                        data-field="formerName"
                                        onchange={handleKeyPersonnelChange}>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-input
                                        label="Preferred Name"
                                        type="text"
                                        value={personnel.preferredName}
                                        data-id={personnel.id}
                                        data-field="preferredName"
                                        onchange={handleKeyPersonnelChange}>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-input
                                        label="Date of Birth"
                                        type="date"
                                        value={personnel.dateOfBirth}
                                        data-id={personnel.id}
                                        data-field="dateOfBirth"
                                        onchange={handleKeyPersonnelChange}
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-input
                                        label="Position Title"
                                        type="text"
                                        value={personnel.positionTitle}
                                        data-id={personnel.id}
                                        data-field="positionTitle"
                                        onchange={handleKeyPersonnelChange}
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-input
                                        label="Contact Email Address"
                                        type="email"
                                        value={personnel.email}
                                        data-id={personnel.id}
                                        data-field="email"
                                        onchange={handleKeyPersonnelChange}
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-input
                                        label="Contact Phone Number - Mobile"
                                        type="tel"
                                        value={personnel.mobile}
                                        data-id={personnel.id}
                                        data-field="mobile"
                                        onchange={handleKeyPersonnelChange}
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-textarea
                                        label="Principal Duties of Position"
                                        value={personnel.principalDuties}
                                        data-id={personnel.id}
                                        data-field="principalDuties"
                                        onchange={handleKeyPersonnelChange}
                                        required>
                                    </lightning-textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <div class="slds-text-align_center slds-m-bottom_large">
                    <lightning-button
                        label="Add Key Personnel"
                        variant="neutral"
                        onclick={handleAddKeyPersonnel}>
                    </lightning-button>
                </div>

                <!-- Navigation Buttons -->
                <div class="slds-grid slds-grid_align-spread slds-m-top_x-large">
                    <lightning-button
                        label="Previous"
                        variant="neutral"
                        onclick={handlePrevious}>
                    </lightning-button>
                    <lightning-button
                        label="Next"
                        variant="brand"
                        onclick={handleNext}>
                    </lightning-button>
                </div>
            </div>
        </template>

        <!-- Page 4: Suitability Assessment -->
        <template if:true={isPage4}>
            <div class="slds-card__body slds-p-around_large">
                <h3 class="slds-text-heading_medium slds-m-bottom_medium">Your Suitability to be an Approved Provider</h3>
                
                <div class="slds-section slds-is-open">
                    <h4 class="slds-section__title slds-text-heading_small">Experience, Conduct and Compliance</h4>
                    <div class="slds-section__content">
                        <lightning-textarea
                            label="Describe your organisation's current experience in the delivery of aged care, or if you have no aged care experience, describe your experience delivering other care relevant to the care type you are applying for"
                            value={experienceDescription}
                            onchange={handleExperienceDescriptionChange}
                            required>
                        </lightning-textarea>
                        
                        <div class="slds-m-top_medium">
                            <h5 class="slds-text-heading_small slds-m-bottom_small">Services Provided</h5>
                            <template for:each={servicesProvided} for:item="service" for:index="index">
                                <div key={service.id} class="slds-grid slds-wrap slds-gutters slds-m-bottom_medium">
                                    <div class="slds-col slds-size_1-of-3">
                                        <lightning-input
                                            label="Service Delivered"
                                            type="text"
                                            value={service.serviceType}
                                            data-id={service.id}
                                            data-field="serviceType"
                                            onchange={handleServiceChange}>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-3">
                                        <lightning-input
                                            label="Period of Delivery"
                                            type="text"
                                            value={service.period}
                                            data-id={service.id}
                                            data-field="period"
                                            onchange={handleServiceChange}>
                                        </lightning-input>
                                    </div>
                                    <div class="slds-col slds-size_1-of-3">
                                        <lightning-input
                                            label="Number of Care Recipients"
                                            type="number"
                                            value={service.recipientCount}
                                            data-id={service.id}
                                            data-field="recipientCount"
                                            onchange={handleServiceChange}>
                                        </lightning-input>
                                    </div>
                                </div>
                            </template>
                            <lightning-button
                                label="Add Service"
                                variant="neutral"
                                onclick={handleAddService}>
                            </lightning-button>
                        </div>
                    </div>
                </div>

                <div class="slds-section slds-is-open slds-m-top_large">
                    <h4 class="slds-section__title slds-text-heading_small">Financial Management</h4>
                    <div class="slds-section__content">
                        <lightning-textarea
                            label="Provide a detailed description of the policies and procedures you have in place or will develop, implement, and monitor to ensure sound financial management"
                            value={financialManagementDescription}
                            onchange={handleFinancialManagementDescriptionChange}
                            required>
                        </lightning-textarea>
                        
                        <lightning-textarea
                            label="Describe your financial management strategy and detail how you plan to become and remain financially viable"
                            value={financialStrategy}
                            onchange={handleFinancialStrategyChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>
                    </div>
                </div>

                <div class="slds-section slds-is-open slds-m-top_large">
                    <h4 class="slds-section__title slds-text-heading_small">Governance Systems</h4>
                    <div class="slds-section__content">
                        <lightning-textarea
                            label="Detail your current or proposed information management systems, including electronic and off-line systems"
                            value={informationManagementSystems}
                            onchange={handleInformationManagementSystemsChange}
                            required>
                        </lightning-textarea>
                        
                        <lightning-textarea
                            label="Detail your current or proposed continuous improvement system"
                            value={continuousImprovementSystem}
                            onchange={handleContinuousImprovementSystemChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>
                        
                        <lightning-textarea
                            label="What is your current or proposed risk management and incident management system, and how is it or will it be applied in practice?"
                            value={riskManagementSystem}
                            onchange={handleRiskManagementSystemChange}
                            required
                            class="slds-m-top_medium">
                        </lightning-textarea>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="slds-grid slds-grid_align-spread slds-m-top_x-large">
                    <lightning-button
                        label="Previous"
                        variant="neutral"
                        onclick={handlePrevious}>
                    </lightning-button>
                    <lightning-button
                        label="Next"
                        variant="brand"
                        onclick={handleNext}>
                    </lightning-button>
                </div>
            </div>
        </template>

        <!-- Page 5: Care Type Specific -->
        <template if:true={isPage5}>
            <div class="slds-card__body slds-p-around_large">
                <h3 class="slds-text-heading_medium slds-m-bottom_medium">Care Type Specific Requirements</h3>
                
                <!-- Residential Care Section -->
                <template if:true={showResidentialCare}>
                    <div class="slds-section slds-is-open">
                        <h4 class="slds-section__title slds-text-heading_small">Residential Care</h4>
                        <div class="slds-section__content">
                            <lightning-textarea
                                label="Describe what systems, policies, or procedures you have/will develop, implement, and monitor to ensure you comply with the Prudential Standards"
                                value={residentialPrudentialStandards}
                                onchange={handleResidentialPrudentialStandardsChange}
                                required>
                            </lightning-textarea>
                            
                            <lightning-textarea
                                label="Describe how you will finance the purchase, construction and/or lease of a residential aged care facility"
                                value={residentialFinancing}
                                onchange={handleResidentialFinancingChange}
                                required
                                class="slds-m-top_medium">
                            </lightning-textarea>
                            
                            <lightning-textarea
                                label="Describe the responsibilities of an approved provider of residential care under section 54-1(1)(f) of the Aged Care Act and explain the steps you will take to ensure compliance"
                                value={residentialRestrictivePractices}
                                onchange={handleResidentialRestrictivePracticesChange}
                                required
                                class="slds-m-top_medium">
                            </lightning-textarea>
                        </div>
                    </div>
                </template>

                <!-- Home Care Section -->
                <template if:true={showHomeCare}>
                    <div class="slds-section slds-is-open slds-m-top_large">
                        <h4 class="slds-section__title slds-text-heading_small">Home Care</h4>
                        <div class="slds-section__content">
                            <lightning-textarea
                                label="Detail the systems, policies, or procedures you have/will develop, implement and monitor to deliver home care from referral to delivery"
                                value={homeCareDeliverySystem}
                                onchange={handleHomeCareDeliverySystemChange}
                                required>
                            </lightning-textarea>
                            
                            <lightning-textarea
                                label="What tools or methods will you implement to accurately capture care recipient current and future health status?"
                                value={homeCareHealthTracking}
                                onchange={handleHomeCareHealthTrackingChange}
                                required
                                class="slds-m-top_medium">
                            </lightning-textarea>
                            
                            <lightning-textarea
                                label="Detail the systems, policies, or procedures you have/will develop to manage medication correctly and safely"
                                value={homeCareMedicationManagement}
                                onchange={handleHomeCareMedicationManagementChange}
                                required
                                class="slds-m-top_medium">
                            </lightning-textarea>
                            
                            <lightning-textarea
                                label="Describe how you will provide choice and flexibility of care to care recipients in their home care package"
                                value={homeCareChoiceFlexibility}
                                onchange={handleHomeCareChoiceFlexibilityChange}
                                required
                                class="slds-m-top_medium">
                            </lightning-textarea>
                        </div>
                    </div>
                </template>

                <!-- Flexible Care Section -->
                <template if:true={showFlexibleCare}>
                    <div class="slds-section slds-is-open slds-m-top_large">
                        <h4 class="slds-section__title slds-text-heading_small">Flexible Care</h4>
                        <div class="slds-section__content">
                            <lightning-textarea
                                label="Describe from an experience perspective, how flexible care is to be provided"
                                value={flexibleCareDescription}
                onchange={handleFlexibleCareDescriptionChange}
                                required>
                            </lightning-textarea>
                            
                            <lightning-textarea
                                label="Describe what policies, procedures, or forms you have or will develop to effectively deliver short-term restorative care"
                                value={flexibleCareRestorativePolicies}
                                onchange={handleFlexibleCareRestorativePoliciesChange}
                                required
                                class="slds-m-top_medium">
                            </lightning-textarea>
                            
                            <lightning-textarea
                                label="Describe the responsibilities of an approved provider in relation to multi-disciplinary teams in the delivery of flexible care"
                                value={flexibleCareMultidisciplinaryTeams}
                                onchange={handleFlexibleCareMultidisciplinaryTeamsChange}
                                required
                                class="slds-m-top_medium">
                            </lightning-textarea>
                        </div>
                    </div>
                </template>

                <!-- Final Declarations -->
                <div class="slds-section slds-is-open slds-m-top_large">
                    <h4 class="slds-section__title slds-text-heading_small">Final Declarations</h4>
                    <div class="slds-section__content">
                        <div class="slds-form-element">
                            <lightning-input
                                type="checkbox"
                                label="I declare that all information provided in this application is true and accurate"
                                checked={finalDeclarationAccuracy}
                                onchange={handleFinalDeclarationAccuracyChange}
                                required>
                            </lightning-input>
                        </div>
                        <div class="slds-form-element slds-m-top_small">
                            <lightning-input
                                type="checkbox"
                                label="I understand the responsibilities and obligations of approved providers under the Aged Care Act"
                                checked={finalDeclarationResponsibilities}
                                onchange={handleFinalDeclarationResponsibilitiesChange}
                                required>
                            </lightning-input>
                        </div>
                        <div class="slds-form-element slds-m-top_small">
                            <lightning-input
                                type="checkbox"
                                label="I consent to the Commissioner obtaining information from other persons or organisations to assess this application"
                                checked={finalDeclarationConsent}
                                onchange={handleFinalDeclarationConsentChange}
                                required>
                            </lightning-input>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="slds-grid slds-grid_align-spread slds-m-top_x-large">
                    <lightning-button
                        label="Previous"
                        variant="neutral"
                        onclick={handlePrevious}>
                    </lightning-button>
                    <lightning-button
                        label="Submit Application"
                        variant="brand"
                        onclick={handleSubmit}
                        disabled={isSubmitting}>
                    </lightning-button>
                </div>
            </div>
        </template>

        <!-- Success Message -->
        <template if:true={showSuccessMessage}>
            <div class="slds-card__body slds-p-around_large slds-text-align_center">
                <div class="slds-notify slds-notify_alert slds-theme_success" role="alert">
                    <h2 class="slds-text-heading_medium">Application Submitted Successfully</h2>
                    <p class="slds-m-top_small">
                        Your application for approval to provide aged care has been submitted. 
                        You will receive a confirmation email shortly with your application reference number.
                    </p>
                </div>
            </div>
        </template>
    </div>
</template>
