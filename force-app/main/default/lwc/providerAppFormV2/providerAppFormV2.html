<template>
    <div class="slds-card">
        <!-- Header -->
        <div class="slds-card__header slds-border_bottom">
            <h1 class="slds-text-heading_large slds-text-align_center">
                APPLICATION FOR APPROVAL TO PROVIDE AGED CARE - NEW APPLICANT
            </h1>
            <p class="slds-text-body_regular slds-text-align_center slds-m-top_small">
                Before completing this application form, you must understand what it means to be an approved provider.
            </p>
        </div>

        <!-- Progress Indicator -->
        <div class="slds-m-around_medium">
            <lightning-progress-indicator 
                current-step={currentPageString}
                type="path"
                variant="base">
                <lightning-progress-step 
                    label="Applicant Details" 
                    value="1">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Key Personnel" 
                    value="2">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Suitability Assessment" 
                    value="3">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Care Type Specific" 
                    value="4">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Review & Submit" 
                    value="5">
                </lightning-progress-step>
            </lightning-progress-indicator>
        </div>

        <!-- Loading Spinner -->
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
        </template>

        <!-- Error Messages -->
        <template if:true={hasErrors}>
            <div class="slds-notify slds-notify_alert slds-theme_error slds-m-around_medium" role="alert">
                <h2 class="slds-text-heading_small">Please correct the following errors:</h2>
                <ul class="slds-list_dotted slds-m-top_small">
                    <template for:each={errorMessages} for:item="error">
                        <li key={error}>{error}</li>
                    </template>
                </ul>
            </div>
        </template>

        <!-- Page 1: Applicant Details -->
        <template if:true={isPage1}>
            <div class="slds-card__body slds-p-around_medium">
                <h2 class="slds-text-heading_medium slds-m-bottom_medium">Section 1: About the Applicant</h2>
                
                <!-- Important Information -->
                <div class="slds-notify slds-notify_alert slds-theme_info slds-m-bottom_medium" role="alert">
                    <h3 class="slds-text-heading_small">Important Information</h3>
                    <p class="slds-text-body_regular">
                        This application form must be completed by one of the applicant's governing persons with appropriate knowledge of the organisation and must contain accurate, clear and complete information.
                    </p>
                </div>

                <!-- Organisation Details -->
                <div class="slds-section slds-is-open">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate" title="Organisation Details">Organisation Details</span>
                    </h3>
                    <div class="slds-section__content">
                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <lightning-input
                                    label="Applicant's (Company) Legal Name"
                                    value={formData.companyLegalName}
                                    onchange={handleInputChange}
                                    data-field="companyLegalName"
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <lightning-input
                                    label="Business Name (if applicable)"
                                    value={formData.businessName}
                                    onchange={handleInputChange}
                                    data-field="businessName">
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                                <lightning-input
                                    label="Applicant's (Company) ACN, IAN or ICN"
                                    value={formData.companyACN}
                                    onchange={handleInputChange}
                                    data-field="companyACN"
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                                <lightning-input
                                    label="Applicant's (Company) ABN"
                                    value={formData.companyABN}
                                    onchange={handleInputChange}
                                    data-field="companyABN"
                                    required>
                                </lightning-input>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Registered Business Address -->
                <div class="slds-section slds-is-open slds-m-top_medium">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate" title="Registered Business Address">Registered Business Address</span>
                    </h3>
                    <div class="slds-section__content">
                        <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                            Street number and name (must be the registered physical address of the organisation)
                        </p>
                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-input
                                    label="Street Address"
                                    value={formData.registeredStreetAddress}
                                    onchange={handleInputChange}
                                    data-field="registeredStreetAddress"
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                                <lightning-input
                                    label="Suburb/Town"
                                    value={formData.registeredSuburb}
                                    onchange={handleInputChange}
                                    data-field="registeredSuburb"
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                                <lightning-combobox
                                    label="State/Territory"
                                    value={formData.registeredState}
                                    options={stateOptions}
                                    onchange={handleInputChange}
                                    data-field="registeredState"
                                    required>
                                </lightning-combobox>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                                <lightning-input
                                    label="Postcode"
                                    value={formData.registeredPostcode}
                                    onchange={handleInputChange}
                                    data-field="registeredPostcode"
                                    type="number"
                                    required>
                                </lightning-input>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Postal Address -->
                <div class="slds-section slds-is-open slds-m-top_medium">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate" title="Postal Address">Postal Address</span>
                    </h3>
                    <div class="slds-section__content">
                        <div class="slds-m-bottom_small">
                            <lightning-input
                                type="checkbox"
                                label="Same as registered address"
                                checked={formData.postalSameAsRegistered}
                                onchange={handleInputChange}
                                data-field="postalSameAsRegistered">
                            </lightning-input>
                        </div>
                        <template if:false={formData.postalSameAsRegistered}>
                            <div class="slds-grid slds-gutters slds-wrap">
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-input
                                        label="Street Address/PO Box"
                                        value={formData.postalStreetAddress}
                                        onchange={handleInputChange}
                                        data-field="postalStreetAddress">
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                                    <lightning-input
                                        label="Suburb/Town"
                                        value={formData.postalSuburb}
                                        onchange={handleInputChange}
                                        data-field="postalSuburb">
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                                    <lightning-combobox
                                        label="State/Territory"
                                        value={formData.postalState}
                                        options={stateOptions}
                                        onchange={handleInputChange}
                                        data-field="postalState">
                                    </lightning-combobox>
                                </div>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                                    <lightning-input
                                        label="Postcode"
                                        value={formData.postalPostcode}
                                        onchange={handleInputChange}
                                        data-field="postalPostcode"
                                        type="number">
                                    </lightning-input>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Care Type Selection -->
                <div class="slds-section slds-is-open slds-m-top_medium">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate" title="Care Type">Care type you are applying for</span>
                    </h3>
                    <div class="slds-section__content">
                        <p class="slds-text-body_regular slds-m-bottom_small">
                            Select the type(s) of care for which approval is sought. All applicants must complete Sections 2 and 3 of this application form, regardless of the type of care being applied for.
                        </p>
                        <lightning-checkbox-group
                            label="Care Types"
                            options={careTypeOptions}
                            value={formData.careTypes}
                            onchange={handleInputChange}
                            data-field="careTypes"
                            required>
                        </lightning-checkbox-group>
                    </div>
                </div>

                <!-- Organisation Type -->
                <div class="slds-section slds-is-open slds-m-top_medium">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate" title="Organisation Type">Organisation Type</span>
                    </h3>
                    <div class="slds-section__content">
                        <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                            You must provide a response to the two questions below which are used for statistical purposes and do not affect the assessment of this application.
                        </p>
                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <lightning-radio-group
                                    label="What is your organisation type?"
                                    options={organisationTypeOptions}
                                    value={formData.organisationType}
                                    onchange={handleInputChange}
                                    data-field="organisationType"
                                    required>
                                </lightning-radio-group>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <lightning-radio-group
                                    label="Is your organisation or its parent body listed on the Australian Stock Exchange?"
                                    options={yesNoOptions}
                                    value={formData.listedOnASX}
                                    onchange={handleInputChange}
                                    data-field="listedOnASX"
                                    required>
                                </lightning-radio-group>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="slds-card__footer slds-text-align_right">
                <lightning-button
                    label="Cancel"
                    variant="neutral"
                    onclick={handleCancel}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button
                    label="Next"
                    variant="brand"
                    onclick={handleNext}>
                </lightning-button>
            </div>
        </template>

        <!-- Page 2: Key Personnel -->
        <template if:true={isPage2}>
            <div class="slds-card__body slds-p-around_medium">
                <h2 class="slds-text-heading_medium slds-m-bottom_medium">Section 2: Your Key Personnel</h2>
                
                <!-- Legislation Information -->
                <div class="slds-notify slds-notify_alert slds-theme_warning slds-m-bottom_medium" role="alert">
                    <h3 class="slds-text-heading_small">Legislation</h3>
                    <p class="slds-text-body_regular">
                        Under Part 7A, subsection 63D(2)(c) of the Commission Act, the Commissioner must not approve a person as a provider of aged care unless the Commissioner is satisfied that each individual who is one of the key personnel of the person is suitable to be involved in the provision of aged care.
                    </p>
                </div>

                <!-- Key Personnel Definition -->
                <div class="slds-box slds-theme_shade slds-m-bottom_medium">
                    <h3 class="slds-text-heading_small slds-m-bottom_small">Key personnel of your organisation include (but may not be limited to):</h3>
                    <ul class="slds-list_dotted">
                        <li>Persons who may have authority, responsibility for and/or significant influence over decision making (planning, directing or controlling) and the day to day operations of the organisation.</li>
                        <li>Any persons who are, or are likely to be, responsible for the nursing services either provided or to be provided by an aged care service and who holds a recognised nursing qualification.</li>
                        <li>Any person who are, or are likely to be, responsible for the day-to-day operations of the aged care service.</li>
                        <li>Directors, shareholders, or secretaries ofthe company registered with the Australian Securities and Investment Commission.</li>
                        <li>Persons listed as responsible persons with the Australian Charities and Not-for-Profit Commission.</li>
                        <li>Individuals in a management company employed or contracted to your organisation.</li>
                        <li>Contractors, consultants, or volunteers to the company who may have direct control and/or influence over decision making.</li>
                    </ul>
                </div>

                <!-- Key Personnel 1 -->
                <div class="slds-accordion">
                    <section class="slds-accordion__section slds-is-open">
                        <div class="slds-accordion__summary">
                            <h3 class="slds-accordion__summary-heading">
                                <span class="slds-accordion__summary-content">Key Personnel 1</span>
                            </h3>
                        </div>
                        <div class="slds-accordion__content">
                            <div class="slds-grid slds-gutters slds-wrap">
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-6">
                                    <lightning-combobox
                                        label="Title"
                                        value={formData.kp1Title}
                                        options={titleOptions}
                                        onchange={handleInputChange}
                                        data-field="kp1Title">
                                    </lightning-combobox>
                                </div>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_5-of-6">
                                    <lightning-input
                                        label="First and Last Name"
                                        value={formData.kp1Name}
                                        onchange={handleInputChange}
                                        data-field="kp1Name"
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                    <lightning-input
                                        label="Former Name (as applicable)"
                                        value={formData.kp1FormerName}
                                        onchange={handleInputChange}
                                        data-field="kp1FormerName">
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                    <lightning-input
                                        label="Preferred Name"
                                        value={formData.kp1PreferredName}
                                        onchange={handleInputChange}
                                        data-field="kp1PreferredName">
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                    <lightning-input
                                        label="Date of Birth"
                                        type="date"
                                        value={formData.kp1DateOfBirth}
                                        onchange={handleInputChange}
                                        data-field="kp1DateOfBirth"
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                    <lightning-input
                                        label="Position Title"
                                        value={formData.kp1Position}
                                        onchange={handleInputChange}
                                        data-field="kp1Position"
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                    <lightning-input
                                        label="Contact Email Address"
                                        type="email"
                                        value={formData.kp1Email}
                                        onchange={handleInputChange}
                                        data-field="kp1Email"
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                    <lightning-input
                                        label="Contact Phone Number - Mobile"
                                        type="tel"
                                        value={formData.kp1Mobile}
                                        onchange={handleInputChange}
                                        data-field="kp1Mobile"
                                        required>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-textarea
                                        label="Principal duties of position"
                                        value={formData.kp1Duties}
                                        onchange={handleInputChange}
                                        data-field="kp1Duties"
                                        required>
                                    </lightning-textarea>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Add More Key Personnel Button -->
                <div class="slds-m-top_medium slds-text-align_center">
                    <lightning-button
                        label="Add Another Key Personnel"
                        variant="neutral"
                        onclick={handleAddKeyPersonnel}>
                    </lightning-button>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="slds-card__footer slds-text-align_right">
                <lightning-button
                    label="Previous"
                    variant="neutral"
                    onclick={handlePrevious}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button
                    label="Next"
                    variant="brand"
                    onclick={handleNext}>
                </lightning-button>
            </div>
        </template>

        <!-- Page 3: Suitability Assessment -->
        <template if:true={isPage3}>
            <div class="slds-card__body slds-p-around_medium">
                <h2 class="slds-text-heading_medium slds-m-bottom_medium">Section 3: Your Suitability to be an Approved Provider</h2>
                
                <!-- Experience Section -->
                <div class="slds-section slds-is-open">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate" title="Experience">Experience, conduct and compliance as a provider of aged care or other relevant care</span>
                    </h3>
                    <div class="slds-section__content">
                        <div class="slds-m-bottom_medium">
                            <lightning-textarea
                                label="Describe your organisation's current experience in the delivery of aged care, or if you have no aged care experience, describe your experience delivering other care relevant to the care type you are applying for."
                                value={formData.experienceDescription}
                                onchange={handleInputChange}
                                data-field="experienceDescription"
                                required>
                            </lightning-textarea>
                            <div class="slds-text-body_small slds-text-color_weak slds-m-top_small">
                                <p>Things for you to consider when writing your response:</p>
                                <ul class="slds-list_dotted">
                                    <li>Relevant care may include (but is not limited to) the delivery of care under the CHSP, National Disability Insurance Scheme (NDIS), sub-contract or private fee for service care.</li>
                                    <li>Your response must directly reflect the experience of the organisation applying and not that of a parent company or franchise organisation.</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Services Table -->
                        <h4 class="slds-text-heading_small slds-m-bottom_small">Provide details of the services you provide or have provided</h4>
                        <div class="slds-scrollable_x">
                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                <thead>
                                    <tr class="slds-line-height_reset">
                                        <th class="" scope="col">
                                            <div class="slds-truncate" title="Service delivered">Service delivered</div>
                                        </th>
                                        <th class="" scope="col">
                                            <div class="slds-truncate" title="Period of delivery">Period of delivery</div>
                                        </th>
                                        <th class="" scope="col">
                                            <div class="slds-truncate" title="Number of care recipients">Number of care recipients</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={formData.services} for:item="service" for:index="index">
                                        <tr key={service.id} class="slds-hint-parent">
                                            <td>
                                                <lightning-input
                                                    value={service.name}
                                                    onchange={handleServiceChange}
                                                    data-field="name"
                                                    data-index={index}
                                                    variant="label-hidden">
                                                </lightning-input>
                                            </td>
                                            <td>
                                                <lightning-input
                                                    value={service.period}
                                                    onchange={handleServiceChange}
                                                    data-field="period"
                                                    data-index={index}
                                                    variant="label-hidden">
                                                </lightning-input>
                                            </td>
                                            <td>
                                                <lightning-input
                                                    type="number"
                                                    value={service.recipients}
                                                    onchange={handleServiceChange}
                                                    data-field="recipients"
                                                    data-index={index}
                                                    variant="label-hidden">
                                                </lightning-input>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                        <lightning-button
                            label="Add Service"
                            variant="neutral"
                            onclick={handleAddService}
                            class="slds-m-top_small">
                        </lightning-button>
                    </div>
                </div>

                <!-- Governance Systems -->
                <div class="slds-section slds-is-open slds-m-top_medium">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate" title="Governance">Governance Systems</span>
                    </h3>
                    <div class="slds-section__content">
                        <div class="slds-notify slds-notify_alert slds-theme_info slds-m-bottom_medium" role="alert">
                            <h4 class="slds-text-heading_small">Important Information</h4>
                            <p class="slds-text-body_regular">
                                There have been changes to the legislated requirements for approved providers in relation to their governance. You should be aware of these requirements and how they would affect the way your organisation would be required to operate if your application is approved.
                            </p>
                        </div>

                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-textarea
                                    label="Detail your current or proposed information management systems, including electronic and off-line systems."
                                    value={formData.informationManagement}
                                    onchange={handleInputChange}
                                    data-field="informationManagement"
                                    required>
                                </lightning-textarea>
                            </div>
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-textarea
                                    label="Detail your current or proposed continuous improvement system."
                                    value={formData.continuousImprovement}
                                    onchange={handleInputChange}
                                    data-field="continuousImprovement"
                                    required>
                                </lightning-textarea>
                            </div>
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-textarea
                                    label="Detail your current or proposed financial governance system, including electronic or off-line systems."
                                    value={formData.financialGovernance}
                                    onchange={handleInputChange}
                                    data-field="financialGovernance"
                                    required>
                                </lightning-textarea>
                            </div>
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-textarea
                                    label="Detail your current or proposed workforce governance system to develop and support your aged care workforce."
                                    value={formData.workforceGovernance}
                                    onchange={handleInputChange}
                                    data-field="workforceGovernance"
                                    required>
                                </lightning-textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Financial Management -->
                <div class="slds-section slds-is-open slds-m-top_medium">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate" title="Financial Management">Financial Management</span>
                    </h3>
                    <div class="slds-section__content">
                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-textarea
                                    label="Provide a detailed description of the policies and procedures you have in place or will develop, implement, and monitor to ensure sound financial management in accordance with the Aged Care Act and associated Principles."
                                    value={formData.financialPolicies}
                                    onchange={handleInputChange}
                                    data-field="financialPolicies"
                                    required>
                                </lightning-textarea>
                            </div>
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-textarea
                                    label="Describe your financial management strategy and detail how you plan to become and remain financially viable."
                                    value={formData.financialStrategy}
                                    onchange={handleInputChange}
                                    data-field="financialStrategy"
                                    required>
                                </lightning-textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="slds-card__footer slds-text-align_right">
                <lightning-button
                    label="Previous"
                    variant="neutral"
                    onclick={handlePrevious}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button
                    label="Next"
                    variant="brand"
                    onclick={handleNext}>
                </lightning-button>
            </div>
        </template>

        <!-- Page 4: Care Type Specific -->
        <template if:true={isPage4}>
            <div class="slds-card__body slds-p-around_medium">
                <h2 class="slds-text-heading_medium slds-m-bottom_medium">Section 4: Your Ability to Meet Care Type Specific Matters</h2>
                
                <div class="slds-notify slds-notify_alert slds-theme_info slds-m-bottom_medium" role="alert">
                    <p class="slds-text-body_regular">
                        When seeking approval to provide a certain type of care, the applicant must demonstrate how it will meet the requirements that relate to the delivery of that type of care. Only complete the questions that relate to the care type(s) you are applying for.
                    </p>
                </div><!-- Residential Care Section -->
                <template if:true={showResidentialCare}>
                    <div class="slds-section slds-is-open">
                        <h3 class="slds-section__title slds-theme_shade">
                            <span class="slds-truncate" title="Residential Care">4.1 Residential Care</span>
                        </h3>
                        <div class="slds-section__content">
                            <div class="slds-grid slds-gutters slds-wrap">
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-textarea
                                        label="Describe what systems, policies, or procedures you have/will develop, implement, and monitor to ensure you comply with the Prudential Standards as described in Part 5 of the Fees and Payments Principles 2014 (No.2)."
                                        value={formData.residentialPrudentialStandards}
                                        onchange={handleInputChange}
                                        data-field="residentialPrudentialStandards"
                                        required>
                                    </lightning-textarea>
                                </div>
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-textarea
                                        label="Describe what reporting procedures and mechanisms you have or will implement to ensure key personnel responsible for executive decisions can effectively manage, monitor, and control the use of refundable deposits."
                                        value={formData.residentialReporting}
                                        onchange={handleInputChange}
                                        data-field="residentialReporting"
                                        required>
                                    </lightning-textarea>
                                </div>
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-textarea
                                        label="Describe how you will finance the purchase, construction and/or lease of a residential aged care facility and describe the associated risks."
                                        value={formData.residentialFinancing}
                                        onchange={handleInputChange}
                                        data-field="residentialFinancing"
                                        required>
                                    </lightning-textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Home Care Section -->
                <template if:true={showHomeCare}>
                    <div class="slds-section slds-is-open">
                        <h3 class="slds-section__title slds-theme_shade">
                            <span class="slds-truncate" title="Home Care">4.2 Home Care</span>
                        </h3>
                        <div class="slds-section__content">
                            <div class="slds-notify slds-notify_alert slds-theme_warning slds-m-bottom_medium" role="alert">
                                <h4 class="slds-text-heading_small">Important Information</h4>
                                <p class="slds-text-body_regular">
                                    When an organisation is approved to provide home care, the approval is effective from the date of the approval and it can start receiving referrals and delivering home care packages within a short period of time.
                                </p>
                            </div>
                            <div class="slds-grid slds-gutters slds-wrap">
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-textarea
                                        label="Detail the systems, policies, or procedures you have/will develop, implement and monitor to deliver home care from referral to delivery."
                                        value={formData.homeCareDelivery}
                                        onchange={handleInputChange}
                                        data-field="homeCareDelivery"
                                        required>
                                    </lightning-textarea>
                                </div>
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-textarea
                                        label="What tools or methods will you implement to accurately capture care recipient current and future health status?"
                                        value={formData.homeCareHealthStatus}
                                        onchange={handleInputChange}
                                        data-field="homeCareHealthStatus"
                                        required>
                                    </lightning-textarea>
                                </div>
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-textarea
                                        label="Describe the system that you will use to operationalise the delivery of care and services to care recipients in their home on a day-to-day basis."
                                        value={formData.homeCareDailyOperations}
                                        onchange={handleInputChange}
                                        data-field="homeCareDailyOperations"
                                        required>
                                    </lightning-textarea>
                                </div>
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-textarea
                                        label="Detail the systems, policies, or procedures you have/will develop, implement, and monitor to manage medication correctly and safely."
                                        value={formData.homeCareMedication}
                                        onchange={handleInputChange}
                                        data-field="homeCareMedication"
                                        required>
                                    </lightning-textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Flexible Care Section -->
                <template if:true={showFlexibleCare}>
                    <div class="slds-section slds-is-open">
                        <h3 class="slds-section__title slds-theme_shade">
                            <span class="slds-truncate" title="Flexible Care">4.3 Flexible Care</span>
                        </h3>
                        <div class="slds-section__content">
                            <div class="slds-grid slds-gutters slds-wrap">
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-textarea
                                        label="Describe from an experience perspective, how is flexible care to be provided: Restorative care that would meet the objectives of delivering flexible care in the form of short-term restorative care; and/or Other kinds of flexible care."
                                        value={formData.flexibleCareExperience}
                                        onchange={handleInputChange}
                                        data-field="flexibleCareExperience"
                                        required>
                                    </lightning-textarea>
                                </div>
                                <div class="slds-col slds-size_1-of-1">
                                    <lightning-textarea
                                        label="Describe what policies, procedures, or forms you have or will develop, implement and monitor to effectively deliver short-term restorative care."
                                        value={formData.flexibleCarePolicies}
                                        onchange={handleInputChange}
                                        data-field="flexibleCarePolicies"
                                        required>
                                    </lightning-textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Navigation Buttons -->
            <div class="slds-card__footer slds-text-align_right">
                <lightning-button
                    label="Previous"
                    variant="neutral"
                    onclick={handlePrevious}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button
                    label="Next"
                    variant="brand"
                    onclick={handleNext}>
                </lightning-button>
            </div>
        </template>

        <!-- Page 5: Review & Submit -->
        <template if:true={isPage5}>
            <div class="slds-card__body slds-p-around_medium">
                <h2 class="slds-text-heading_medium slds-m-bottom_medium">Section 5: Review & Submit</h2>
                
                <!-- Key Personnel Declaration -->
                <div class="slds-section slds-is-open">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate" title="Declaration">Key Personnel Declaration</span>
                    </h3>
                    <div class="slds-section__content">
                        <div class="slds-notify slds-notify_alert slds-theme_error slds-m-bottom_medium" role="alert">
                            <h4 class="slds-text-heading_small">Important Information</h4>
                            <p class="slds-text-body_regular">
                                Giving false and misleading information is a serious offence. There are offences established by the Commission Act and the Criminal Code Act 1995 (Cth) (Criminal Code) relating to providing false and misleading information.
                            </p>
                        </div>

                        <div class="slds-box slds-theme_shade slds-m-bottom_medium">
                            <h4 class="slds-text-heading_small slds-m-bottom_small">I/we declare that I/we:</h4>
                            <div class="slds-form-element">
                                <div class="slds-form-element__control">
                                    <template for:each={declarationItems} for:item="item">
                                        <div key={item.id} class="slds-checkbox slds-m-bottom_small">
                                            <input type="checkbox" 
                                                   id={item.id} 
                                                   data-declaration={item.id}
                                                   onchange={handleDeclarationChange}
                                                   checked={item.checked} />
                                            <label class="slds-checkbox__label" for={item.id}>
                                                <span class="slds-checkbox_faux"></span>
                                                <span class="slds-form-element__label">{item.text}</span>
                                            </label>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- Declaring Officers -->
                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <h4 class="slds-text-heading_small slds-m-bottom_small">Declaring Officer 1  Key Personnel</h4>
                                <lightning-input
                                    label="Name"
                                    value={formData.declaringOfficer1Name}
                                    onchange={handleInputChange}
                                    data-field="declaringOfficer1Name"
                                    required>
                                </lightning-input>
                                <lightning-input
                                    label="Position"
                                    value={formData.declaringOfficer1Position}
                                    onchange={handleInputChange}
                                    data-field="declaringOfficer1Position"
                                    required>
                                </lightning-input>
                                <lightning-input
                                    label="Date"
                                    type="date"
                                    value={formData.declaringOfficer1Date}
                                    onchange={handleInputChange}
                                    data-field="declaringOfficer1Date"
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <h4 class="slds-text-heading_small slds-m-bottom_small">Declaring Officer 2  Key Personnel</h4>
                                <lightning-input
                                    label="Name"
                                    value={formData.declaringOfficer2Name}
                                    onchange={handleInputChange}
                                    data-field="declaringOfficer2Name">
                                </lightning-input>
                                <lightning-input
                                    label="Position"
                                    value={formData.declaringOfficer2Position}
                                    onchange={handleInputChange}
                                    data-field="declaringOfficer2Position">
                                </lightning-input>
                                <lightning-input
                                    label="Date"
                                    type="date"
                                    value={formData.declaringOfficer2Date}
                                    onchange={handleInputChange}
                                    data-field="declaringOfficer2Date">
                                </lightning-input>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Application Summary -->
                <div class="slds-section slds-is-open slds-m-top_medium">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate" title="Summary">Application Summary</span>
                    </h3>
                    <div class="slds-section__content">
                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <dl class="slds-list_horizontal slds-wrap">
                                    <dt class="slds-item_label slds-text-color_weak slds-truncate">Organisation Name:</dt>
                                    <dd class="slds-item_detail slds-truncate">{formData.companyLegalName}</dd>
                                    <dt class="slds-item_label slds-text-color_weak slds-truncate">ABN:</dt>
                                    <dd class="slds-item_detail slds-truncate">{formData.companyABN}</dd>
                                    <dt class="slds-item_label slds-text-color_weak slds-truncate">Care Types:</dt>
                                    <dd class="slds-item_detail slds-truncate">{careTypesDisplay}</dd>
                                </dl>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <dl class="slds-list_horizontal slds-wrap">
                                    <dt class="slds-item_label slds-text-color_weak slds-truncate">Organisation Type:</dt>
                                    <dd class="slds-item_detail slds-truncate">{formData.organisationType}</dd>
                                    <dt class="slds-item_label slds-text-color_weak slds-truncate">Key Personnel Count:</dt>
                                    <dd class="slds-item_detail slds-truncate">{keyPersonnelCount}</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="slds-card__footer slds-text-align_right">
                <lightning-button
                    label="Previous"
                    variant="neutral"
                    onclick={handlePrevious}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button
                    label="Submit Application"
                    variant="brand"
                    onclick={handleSubmit}
                    disabled={submitDisabled}>
                </lightning-button>
            </div>
        </template>
    </div>
</template>
