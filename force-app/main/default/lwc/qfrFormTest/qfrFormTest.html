<template>
    <div class="slds-card">
        <!-- Progress Indicator -->
        <div class="slds-card__header">
            <lightning-progress-indicator 
                current-step={currentPageString}
                type="path"
                variant="base">
                <lightning-progress-step 
                    label="Application Details" 
                    value="1">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Organization Information" 
                    value="2">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Key Personnel" 
                    value="3">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Suitability Assessment" 
                    value="4">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Care Type Specific" 
                    value="5">
                </lightning-progress-step>
                <lightning-progress-step 
                    label="Review & Submit" 
                    value="6">
                </lightning-progress-step>
            </lightning-progress-indicator>
        </div>

        <div class="slds-card__body slds-card__body_inner">
            <!-- Page 1: Application Details -->
            <div if:true={isPage1}>
                <h2 class="slds-text-heading_large slds-m-bottom_medium">APPLICATION FOR APPROVAL TO PROVIDE AGED CARE - NEW APPLICANT</h2>
                
                <div class="slds-notify slds-notify_alert slds-theme_warning slds-theme_alert-texture slds-m-bottom_large" role="alert">
                    <h3 class="slds-text-heading_small">Important Information</h3>
                    <p class="slds-text-body_regular">Before completing this application form, you must understand what it means to be an approved provider. Read the Aged Care Approved Provider Application Guide and ensure you are aware of the responsibilities and obligations of an approved provider prescribed in the Aged Care Act 1997 and the associated Principles.</p>
                </div>

                <div class="slds-section slds-is-open slds-m-bottom_large">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate slds-p-horizontal_small">Purpose of this Application Form</span>
                    </h3>
                    <div class="slds-section__content slds-p-around_medium">
                        <p class="slds-text-body_regular slds-m-bottom_small">This application form is approved under section 63B(2) of the Aged Care Quality and Safety Commission Act 2018 and must be used by organizations that want to apply for approval to provide residential care, home care and flexible care.</p>
                    </div>
                </div>

                <div class="slds-form-element slds-m-bottom_medium">
                    <label class="slds-form-element__label" for="care-type">
                        <abbr class="slds-required" title="required">*</abbr>
                        Care type you are applying for
                    </label>
                    <div class="slds-form-element__control">
                        <lightning-checkbox-group 
                            name="careType"
                            label=""
                            options={careTypeOptions}
                            value={selectedCareTypes}
                            onchange={handleCareTypeChange}
                            required>
                        </lightning-checkbox-group>
                    </div>
                    <div class="slds-form-element__help">Select the type(s) of care for which approval is sought. All applicants must complete all sections regardless of the type of care being applied for.</div>
                </div>

                <div class="slds-form-element slds-m-bottom_medium">
                    <label class="slds-form-element__label">
                        <abbr class="slds-required" title="required">*</abbr>
                        Organization Type
                    </label>
                    <div class="slds-form-element__control">
                        <lightning-radio-group 
                            name="orgType"
                            label=""
                            options={organizationTypeOptions}
                            value={organizationType}
                            onchange={handleOrgTypeChange}
                            type="radio"
                            required>
                        </lightning-radio-group>
                    </div>
                    <div class="slds-form-element__help">This information is used for statistical purposes and does not affect the assessment of this application.</div>
                </div>

                <div if:true={showNotForProfitOptions} class="slds-form-element slds-m-bottom_medium">
                    <label class="slds-form-element__label">Not-For-Profit Type</label>
                    <div class="slds-form-element__control">
                        <lightning-radio-group 
                            name="nfpType"
                            label=""
                            options={notForProfitOptions}
                            value={notForProfitType}
                            onchange={handleNFPTypeChange}
                            type="radio">
                        </lightning-radio-group>
                    </div>
                </div>

                <div class="slds-form-element slds-m-bottom_medium">
                    <label class="slds-form-element__label">Is your organization or its parent body listed on the Australian Stock Exchange?</label>
                    <div class="slds-form-element__control">
                        <lightning-radio-group 
                            name="stockExchange"
                            label=""
                            options={yesNoOptions}
                            value={stockExchangeListed}
                            onchange={handleStockExchangeChange}
                            type="radio">
                        </lightning-radio-group>
                    </div>
                </div>
            </div>

            <!-- Page 2: Organization Information -->
            <div if:true={isPage2}>
                <h2 class="slds-text-heading_large slds-m-bottom_medium">Organization Details</h2>

                <div class="slds-grid slds-gutters slds-wrap">
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                        <lightning-input 
                            label="Applicant's (Company) Legal Name"
                            type="text"
                            value={companyLegalName}
                            onchange={handleInputChange}
                            data-field="companyLegalName"
                            required>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                        <lightning-input 
                            label="ACN/IAN/ICN"
                            type="text"
                            value={companyNumber}
                            onchange={handleInputChange}
                            data-field="companyNumber"
                            required>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                        <lightning-input 
                            label="ABN"
                            type="text"
                            value={abn}
                            onchange={handleInputChange}
                            data-field="abn"
                            required>
                        </lightning-input>
                    </div>
                </div>

                <div class="slds-form-element slds-m-top_medium">
                    <lightning-input 
                        label="Business Name (if applicable)"
                        type="text"
                        value={businessName}
                        onchange={handleInputChange}
                        data-field="businessName">
                    </lightning-input>
                </div>

                <h3 class="slds-text-heading_medium slds-m-top_large slds-m-bottom_medium">Registered Business Address</h3>
                <div class="slds-text-body_small slds-m-bottom_small">Must be the registered physical address of the organization</div>

                <div class="slds-grid slds-gutters slds-wrap">
                    <div class="slds-col slds-size_1-of-1">
                        <lightning-input 
                            label="Street Number and Name"
                            type="text"
                            value={registeredStreetAddress}
                            onchange={handleInputChange}
                            data-field="registeredStreetAddress"
                            required>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3">
                        <lightning-input 
                            label="Suburb/Town"
                            type="text"
                            value={registeredSuburb}
                            onchange={handleInputChange}
                            data-field="registeredSuburb"
                            required>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3">
                        <lightning-combobox 
                            label="State/Territory"
                            value={registeredState}
                            placeholder="Select State/Territory"
                            options={stateOptions}
                            onchange={handleStateChange}
                            data-field="registeredState"
                            required>
                        </lightning-combobox>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3">
                        <lightning-input 
                            label="Postcode"
                            type="text"
                            value={registeredPostcode}
                            onchange={handleInputChange}
                            data-field="registeredPostcode"
                            required>
                        </lightning-input>
                    </div>
                </div>

                <h3 class="slds-text-heading_medium slds-m-top_large slds-m-bottom_medium">Postal Address</h3>
                
                <div class="slds-form-element slds-m-bottom_medium">
                    <div class="slds-form-element__control">
                        <lightning-input 
                            type="checkbox"
                            label="Same as registered address"
                            checked={postalSameAsRegistered}
                            onchange={handlePostalSameChange}>
                        </lightning-input>
                    </div>
                </div>

                <div if:false={postalSameAsRegistered}>
                    <div class="slds-grid slds-gutters slds-wrap">
                        <div class="slds-col slds-size_1-of-1">
                            <lightning-input 
                                label="Street Number and Name/PO Box"
                                type="text"
                                value={postalStreetAddress}
                                onchange={handleInputChange}
                                data-field="postalStreetAddress">
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3">
                            <lightning-input 
                                label="Suburb/Town"
                                type="text"
                                value={postalSuburb}
                                onchange={handleInputChange}
                                data-field="postalSuburb">
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3">
                            <lightning-combobox 
                                label="State/Territory"
                                value={postalState}
                                placeholder="Select State/Territory"
                                options={stateOptions}
                                onchange={handleStateChange}
                                data-field="postalState">
                            </lightning-combobox>
                        </div>
                        <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3">
                            <lightning-input 
                                label="Postcode"
                                type="text"
                                value={postalPostcode}
                                onchange={handleInputChange}
                                data-field="postalPostcode">
                            </lightning-input>
                        </div>
                    </div>
                </div>

                <h3 class="slds-text-heading_medium slds-m-top_large slds-m-bottom_medium">Authorized Contact Person Details</h3>
                <div class="slds-text-body_small slds-m-bottom_medium">The contact person(s) listed below must be key personnel and have knowledge of this application's content.</div>

                <h4 class="slds-text-heading_small slds-m-bottom_small">Primary Contact</h4>
                <div class="slds-grid slds-gutters slds-wrap">
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                        <lightning-input 
                            label="Full Name"
                            type="text"
                            value={primaryContactName}
                            onchange={handleInputChange}
                            data-field="primaryContactName"
                            required>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                        <lightning-input 
                            label="Position Held"
                            type="text"
                            value={primaryContactPosition}
                            onchange={handleInputChange}
                            data-field="primaryContactPosition"
                            required>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3">
                        <lightning-input 
                            label="Telephone (incl area code)"
                            type="tel"
                            value={primaryContactPhone}
                            onchange={handleInputChange}
                            data-field="primaryContactPhone"
                            required>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3">
                        <lightning-input 
                            label="Mobile"
                            type="tel"
                            value={primaryContactMobile}
                            onchange={handleInputChange}
                            data-field="primaryContactMobile">
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3">
                        <lightning-input 
                            label="Best day and time to make contact"
                            type="text"
                            value={primaryContactBestTime}
                            onchange={handleInputChange}
                            data-field="primaryContactBestTime">
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-1">
                        <lightning-input 
                            label="Email Address"
                            type="email"
                            value={primaryContactEmail}
                            onchange={handleInputChange}
                            data-field="primaryContactEmail"
                            required>
                        </lightning-input>
                    </div>
                </div>
            </div>

            <!-- Page 3: Key Personnel -->
            <div if:true={isPage3}>
                <h2 class="slds-text-heading_large slds-m-bottom_medium">Key Personnel</h2>
                
                <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-bottom_large" role="alert">
                    <h3 class="slds-text-heading_small">Key Personnel Requirements</h3>
                    <p class="slds-text-body_regular">Key personnel include persons who have authority, responsibility for and/or significant influence over decision making and day-to-day operations. This includes Governing Persons, Executive Management, Directors, Board Members, and those responsible for nursing services.</p>
                </div>

                <div class="slds-form-element slds-m-bottom_medium">
                    <lightning-input 
                        label="How many key personnel do you have?"
                        type="number"
                        value={keyPersonnelCount}
                        onchange={handleKeyPersonnelCountChange}
                        min="1"
                        max="10"
                        required>
                    </lightning-input>
                </div>

                <template for:each={keyPersonnelList} for:item="person" for:index="index">
                    <div key={person.id} class="slds-box slds-theme_shade slds-m-bottom_medium">
                        <h4 class="slds-text-heading_small slds-m-bottom_medium">Key Personnel {person.number}</h4>
                        
                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-6">
                                <lightning-combobox 
                                    label="Title"
                                    value={person.title}
                                    placeholder="Select Title"
                                    options={titleOptions}
                                    onchange={handlePersonnelChange}
                                    data-field="title"
                                    data-index={index}>
                                </lightning-combobox>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-large-size_5-of-6">
                                <lightning-input 
                                    label="First and Last Name"
                                    type="text"
                                    value={person.fullName}
                                    onchange={handlePersonnelChange}
                                    data-field="fullName"
                                    data-index={index}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                                <lightning-input 
                                    label="Former Name (if applicable)"
                                    type="text"
                                    value={person.formerName}
                                    onchange={handlePersonnelChange}
                                    data-field="formerName"
                                    data-index={index}>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                                <lightning-input 
                                    label="Preferred Name"
                                    type="text"
                                    value={person.preferredName}
                                    onchange={handlePersonnelChange}
                                    data-field="preferredName"
                                    data-index={index}>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                                <lightning-input 
                                    label="Date of Birth"
                                    type="date"
                                    value={person.dateOfBirth}
                                    onchange={handlePersonnelChange}
                                    data-field="dateOfBirth"
                                    data-index={index}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                                <lightning-input 
                                    label="Position Title"
                                    type="text"
                                    value={person.positionTitle}
                                    onchange={handlePersonnelChange}
                                    data-field="positionTitle"
                                    data-index={index}
                                    required>
                                </lightning-input>
                            </div>
                            <div class="slds-col slds-size_1-of-1">
                                <lightning-textarea 
                                    label="Principal Duties of Position"
                                    value={person.principalDuties}
                                    onchange={handlePersonnelChange}
                                    data-field="principalDuties"
                                    data-index={index}
                                    required>
                                </lightning-textarea>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Page 4: Suitability Assessment -->
            <div if:true={isPage4}>
                <h2 class="slds-text-heading_large slds-m-bottom_medium">Suitability Assessment</h2>

                <div class="slds-section slds-is-open slds-m-bottom_large">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate slds-p-horizontal_small">Experience in Providing Care</span>
                    </h3>
                    <div class="slds-section__content slds-p-around_medium">
                        <lightning-textarea 
                            label="Describe your organization's current experience in the delivery of aged care, or if you have no aged care experience, describe your experience delivering other care relevant to the care type you are applying for"
                            value={careExperience}
                            onchange={handleInputChange}
                            data-field="careExperience"
                            required>
                        </lightning-textarea>
                    </div>
                </div>

                <div class="slds-section slds-is-open slds-m-bottom_large">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate slds-p-horizontal_small">Governance Systems</span>
                    </h3>
                    <div class="slds-section__content slds-p-around_medium">
                        <div class="slds-form-element slds-m-bottom_medium">
                            <label class="slds-form-element__label">Do you currently have a board?</label>
                            <div class="slds-form-element__control">
                                <lightning-radio-group 
                                    name="hasBoard"
                                    label=""
                                    options={yesNoOptions}
                                    value={hasBoard}
                                    onchange={handleHasBoardChange}
                                    type="radio"
                                    required>
                                </lightning-radio-group>
                            </div>
                        </div>

                        <lightning-textarea 
                            label="Describe the methodology the board and/or senior management will implement to guide, oversee, and deliver quality aged care"
                            value={governanceMethodology}
                            onchange={handleInputChange}
                            data-field="governanceMethodology"
                            required>
                        </lightning-textarea>
                    </div>
                </div>

                <div class="slds-section slds-is-open slds-m-bottom_large">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate slds-p-horizontal_small">Financial Management</span>
                    </h3>
                    <div class="slds-section__content slds-p-around_medium">
                        <lightning-textarea 
                            label="Provide a detailed description of the policies and procedures you have in place or will develop to ensure sound financial management"
                            value={financialManagement}
                            onchange={handleInputChange}
                            data-field="financialManagement"
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe your financial management strategy and detail how you plan to become and remain financially viable"
                            value={financialStrategy}
                            onchange={handleInputChange}
                            data-field="financialStrategy"
                            required>
                        </lightning-textarea>
                    </div>
                </div>

                <div class="slds-section slds-is-open slds-m-bottom_large">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate slds-p-horizontal_small">Quality of Care Responsibilities</span>
                    </h3>
                    <div class="slds-section__content slds-p-around_medium">
                        <lightning-textarea 
                            label="Describe the responsibilities set out under section 54-1 of the Aged Care Act and how you will embed these into the delivery of care and services"
                            value={qualityCareResponsibilities}
                            onchange={handleInputChange}
                            data-field="qualityCareResponsibilities"
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe how you will develop, implement, and maintain the care and services specified in the Quality of Care Principles"
                            value={qualityCarePrinciples}
                            onchange={handleInputChange}
                            data-field="qualityCarePrinciples"
                            required>
                        </lightning-textarea>
                    </div>
                </div>
            </div>

            <!-- Page 5: Care Type Specific -->
            <div if:true={isPage5}>
                <h2 class="slds-text-heading_large slds-m-bottom_medium">Care Type Specific Requirements</h2>

                <!-- Residential Care Section -->
                <div if:true={showResidentialCare} class="slds-section slds-is-open slds-m-bottom_large">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate slds-p-horizontal_small">Residential Care</span>
                    </h3>
                    <div class="slds-section__content slds-p-around_medium">
                        <lightning-textarea 
                            label="Describe what systems, policies, or procedures you have/will develop to ensure you comply with the Prudential Standards"
                            value={residentialPrudentialStandards}
                            onchange={handleInputChange}
                            data-field="residentialPrudentialStandards"
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe how you will finance the purchase, construction and/or lease of a residential aged care facility"
                            value={residentialFinancing}
                            onchange={handleInputChange}
                            data-field="residentialFinancing"
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe the responsibilities regarding restrictive practices and explain the steps you will take to ensure compliance"
                            value={restrictivePractices}
                            onchange={handleInputChange}
                            data-field="restrictivePractices"
                            required>
                        </lightning-textarea>
                    </div>
                </div>

                <!-- Home Care Section -->
                <div if:true={showHomeCare} class="slds-section slds-is-open slds-m-bottom_large">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate slds-p-horizontal_small">Home Care</span>
                    </h3>
                    <div class="slds-section__content slds-p-around_medium">
                        <lightning-textarea 
                            label="Detail the systems, policies, or procedures you have/will develop to deliver home care from referral to delivery"
                            value={homeCareDelivery}
                            onchange={handleInputChange}
                            data-field="homeCareDelivery"
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="What tools or methods will you implement to accurately capture care recipient current and future health status?"
                            value={homeCareHealthTracking}
                            onchange={handleInputChange}
                            data-field="homeCareHealthTracking"
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Detail the systems for managing medication correctly and safely"
                            value={homeCareMedication}
                            onchange={handleInputChange}
                            data-field="homeCareMedication"
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe how you will provide choice and flexibility of care to care recipients"
                            value={homeCareFlexibility}
                            onchange={handleInputChange}
                            data-field="homeCareFlexibility"
                            required>
                        </lightning-textarea>
                    </div>
                </div>

                <!-- Flexible Care Section -->
                <div if:true={showFlexibleCare} class="slds-section slds-is-open slds-m-bottom_large">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate slds-p-horizontal_small">Flexible Care</span>
                    </h3>
                    <div class="slds-section__content slds-p-around_medium">
                        <div class="slds-form-element slds-m-bottom_medium">
                            <label class="slds-form-element__label">Flexible Care Setting</label>
                            <div class="slds-form-element__control">
                                <lightning-radio-group 
                                    name="flexibleCareSetting"
                                    label=""
                                    options={flexibleCareSettingOptions}
                                    value={flexibleCareSetting}
                                    onchange={handleFlexibleCareSettingChange}
                                    type="radio"
                                    required>
                                </lightning-radio-group>
                            </div>
                        </div>

                        <lightning-textarea 
                            label="Describe from an experience perspective, how flexible care is to be provided"
                            value={flexibleCareExperience}
                            onchange={handleInputChange}
                            data-field="flexibleCareExperience"
                            required>
                        </lightning-textarea>

                        <lightning-textarea 
                            label="Describe what policies, procedures, or forms you have or will develop to effectively deliver short-term restorative care"
                            value={flexibleCareRestorativeCare}
                            onchange={handleInputChange}
                            data-field="flexibleCareRestorativeCare"
                            required>
                        </lightning-textarea>
                    </div>
                </div>
            </div>

            <!-- Page 6: Review & Submit -->
            <div if:true={isPage6}>
                <h2 class="slds-text-heading_large slds-m-bottom_medium">Review & Submit Application</h2>

                <div class="slds-notify slds-notify_alert slds-theme_info slds-theme_alert-texture slds-m-bottom_large" role="alert">
                    <h3 class="slds-text-heading_small">Before You Submit</h3>
                    <ul class="slds-list_dotted slds-m-top_small">
                        <li>Check that you have answered all parts of all questions</li>
                        <li>Check that the information provided is accurate, clear and complete</li>
                        <li>Ensure all required attachments are included</li>
                        <li>Verify that key personnel declarations are signed and dated</li>
                    </ul>
                </div>

                <div class="slds-section slds-is-open slds-m-bottom_large">
                    <h3 class="slds-section__title slds-theme_shade">
                        <span class="slds-truncate slds-p-horizontal_small">Application Summary</span>
                    </h3>
                    <div class="slds-section__content slds-p-around_medium"><div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Organization Name:</label>
                                    <div class="slds-form-element__static">{companyLegalName}</div>
                                </div>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Care Types Applied For:</label>
                                    <div class="slds-form-element__static">{selectedCareTypesDisplay}</div>
                                </div>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Organization Type:</label>
                                    <div class="slds-form-element__static">{organizationType}</div>
                                </div>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Key Personnel Count:</label>
                                    <div class="slds-form-element__static">{keyPersonnelCount}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="slds-form-element slds-m-bottom_large">
                    <div class="slds-form-element__control">
                        <lightning-input 
                            type="checkbox"
                            label="I confirm that all information provided is accurate and complete"
                            checked={confirmationChecked}
                            onchange={handleConfirmationChange}
                            required>
                        </lightning-input>
                    </div>
                </div>

                <div class="slds-form-element slds-m-bottom_large">
                    <div class="slds-form-element__control">
                        <lightning-input 
                            type="checkbox"
                            label="I understand that providing false or misleading information is a serious offence"
                            checked={understandingChecked}
                            onchange={handleUnderstandingChange}
                            required>
                        </lightning-input>
                    </div>
                </div>
            </div>

            <!-- Error Messages -->
            <div if:true={hasErrors} class="slds-notify slds-notify_alert slds-theme_error slds-theme_alert-texture slds-m-bottom_medium" role="alert">
                <h3 class="slds-text-heading_small">Please correct the following errors:</h3>
                <ul class="slds-list_dotted slds-m-top_small">
                    <template for:each={errorMessages} for:item="error">
                        <li key={error}>{error}</li>
                    </template>
                </ul>
            </div>

            <!-- Loading Spinner -->
            <div if:true={isLoading} class="slds-is-relative slds-m-vertical_large">
                <lightning-spinner alternative-text="Processing..." size="medium"></lightning-spinner>
            </div>
        </div>

        <!-- Navigation Footer -->
        <div class="slds-card__footer">
            <div class="slds-grid slds-grid_align-spread">
                <div class="slds-col">
                    <lightning-button 
                        if:false={isFirstPage}
                        label="Previous"
                        variant="neutral"
                        onclick={handlePrevious}
                        disabled={isLoading}>
                    </lightning-button>
                </div>
                <div class="slds-col">
                    <div class="slds-grid slds-grid_align-end slds-gutters_small">
                        <div class="slds-col">
                            <lightning-button 
                                label="Cancel"
                                variant="neutral"
                                onclick={handleCancel}
                                disabled={isLoading}>
                            </lightning-button>
                        </div>
                        <div class="slds-col">
                            <lightning-button 
                                if:false={isLastPage}
                                label="Next"
                                variant="brand"
                                onclick={handleNext}
                                disabled={isLoading}>
                            </lightning-button>
                            <lightning-button 
                                if:true={isLastPage}
                                label="Submit Application"
                                variant="brand"
                                onclick={handleSubmit}
                                disabled={submitDisabled}>
                            </lightning-button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
